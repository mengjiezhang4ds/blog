<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>基于R语言caret包的上海市钉螺分布预测 | Hugo XMag</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">

  </head>

  <body class="page">
    <nav class="header">
      <div class="banner">
<a href="/" class="text">
&Hfr;&Ufr;&Gfr;&Ofr; &Xfr;&Mfr;&Afr;&Gfr;
</a>
</div>

      <div class="head-meta">
      
        <span><a href="/">&larr; Back to Home</a></span>
        <span class="date">2023-04-01</span>
        
        
        
          
        
        
        
        <span><a href="https://github.com/yihui/hugo-xmag/edit/master/exampleSite/content/post/2023-08-11-SDM-SH/index.Rmd">Edit this page &rarr;</a></span>
        
        
      
      </div>
    </nav>

<div class="container">
<article>
<div class="article-meta">

  <div class="categories">
  
    <a href="/categories/r">R</a>
  
  </div>

  <h1><span class="title">基于R语言caret包的上海市钉螺分布预测</span></h1>

  
  <h3 class="author">学R不思则罔
</h3>
  

  
  <p>Tags: <a href="/tags/tidyverse">tidyverse</a>; <a href="/tags/caret">caret</a>; <a href="/tags/sdm">SDM</a>
  </p>
  
  

</div>


<nav id="TableOfContents">
  <ul>
    <li><a href="#1准备工作">1.准备工作</a>
      <ul>
        <li><a href="#11加载扩展包">1.1加载扩展包</a></li>
        <li><a href="#12设定字体">1.2设定字体</a></li>
        <li><a href="#13导入数据">1.3导入数据</a></li>
        <li><a href="#14-数据概览">1.4 数据概览</a></li>
      </ul>
    </li>
    <li><a href="#2切分数据">2.切分数据</a></li>
    <li><a href="#3建立模型">3.建立模型</a>
      <ul>
        <li><a href="#31svm">3.1SVM</a></li>
        <li><a href="#32-rf">3.2 RF</a></li>
        <li><a href="#33-gbm">3.3 GBM</a></li>
        <li><a href="#34-glm">3.4 GLM</a></li>
        <li><a href="#35-nb">3.5 NB</a></li>
        <li><a href="#36-knn">3.6 KNN</a></li>
        <li><a href="#37-c50">3.7 C5.0</a></li>
        <li><a href="#38-adaboostm1">3.8 AdaBoost.M1</a></li>
        <li><a href="#39-xgb">3.9 XGB</a></li>
      </ul>
    </li>
    <li><a href="#4-结果汇总">4. 结果汇总</a>
      <ul>
        <li><a href="#41--最优模型变量重要性">4.1  最优模型变量重要性</a></li>
        <li><a href="#42-提升曲线">4.2 提升曲线</a></li>
        <li><a href="#43-ks曲线">4.3 ks曲线</a></li>
        <li><a href="#44-roc曲线">4.4 roc曲线</a></li>
        <li><a href="#45-precision-recall-curve">4.5 Precision recall curve</a></li>
        <li><a href="#46-gain-curve">4.6 Gain curve</a></li>
        <li><a href="#47-概率分布图">4.7 概率分布图</a></li>
      </ul>
    </li>
  </ul>
</nav>


<main>
<script src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/kePrint/kePrint.js"></script>
<link href="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/kePrint/kePrint.js"></script>
<link href="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/kePrint/kePrint.js"></script>
<link href="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/kePrint/kePrint.js"></script>
<link href="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/kePrint/kePrint.js"></script>
<link href="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/kePrint/kePrint.js"></script>
<link href="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/kePrint/kePrint.js"></script>
<link href="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/kePrint/kePrint.js"></script>
<link href="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/kePrint/kePrint.js"></script>
<link href="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/kePrint/kePrint.js"></script>
<link href="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/kePrint/kePrint.js"></script>
<link href="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/kePrint/kePrint.js"></script>
<link href="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/kePrint/kePrint.js"></script>
<link href="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/kePrint/kePrint.js"></script>
<link href="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/kePrint/kePrint.js"></script>
<link href="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/kePrint/kePrint.js"></script>
<link href="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/kePrint/kePrint.js"></script>
<link href="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/kePrint/kePrint.js"></script>
<link href="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/kePrint/kePrint.js"></script>
<link href="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/kePrint/kePrint.js"></script>
<link href="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/kePrint/kePrint.js"></script>
<link href="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/kePrint/kePrint.js"></script>
<link href="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/kePrint/kePrint.js"></script>
<link href="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/kePrint/kePrint.js"></script>
<link href="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/kePrint/kePrint.js"></script>
<link href="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/kePrint/kePrint.js"></script>
<link href="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/kePrint/kePrint.js"></script>
<link href="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/kePrint/kePrint.js"></script>
<link href="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/lightable/lightable.css" rel="stylesheet" />
<script src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/kePrint/kePrint.js"></script>
<link href="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/lightable/lightable.css" rel="stylesheet" />
<h2 id="1准备工作">1.准备工作</h2>
<h3 id="11加载扩展包">1.1加载扩展包</h3>
<pre><code class="language-r"># 数据操作
library(tidyverse)
library(readxl)
library(purrr)
library(raster)
library(terra)
library(rayshader)
library(sf)
library(mapchina)
library(dismo)
# rmarkdown
library(knitr)
library(kableExtra)
# 建模
library(yardstick)
library(pdp)
library(gbm)
library(xgboost)
library(caret)
library(creditmodel)
# 绘图
library(ggcor)
library(tmap)
library(cartomisc)
library(plotly)
library(gridExtra)
# 设定Java内存
# options(java.parameters = &quot;-Xmx1000m&quot;)
</code></pre>
<h3 id="12设定字体">1.2设定字体</h3>
<pre><code class="language-r">library(extrafont)
library(showtext)
showtext_auto(enable = TRUE)
font_add(&quot;RMN&quot;, &quot;./font/Times New Roman.ttf&quot;)
font_add(&quot;KaiTi&quot;, &quot;./font/KaiTi.ttf&quot;)
</code></pre>
<h3 id="13导入数据">1.3导入数据</h3>
<h4 id="131-生成上海地图数据">1.3.1 生成上海地图数据</h4>
<pre><code class="language-r">sh_sf &lt;- mapchina::china %&gt;%
  dplyr::filter(Name_Province == &quot;上海市&quot;) %&gt;%
  group_by(Name_Province) %&gt;%
  dplyr::summarise(geometry = st_union(geometry)) %&gt;%
  ungroup()

sh_county_sf &lt;- mapchina::china %&gt;%
  dplyr::filter(Name_Province == &quot;上海市&quot;)

p1 &lt;- tm_shape(sh_county_sf) +
  tm_borders()
p2 &lt;- tm_shape(sh_sf) +
  tm_borders()
# tmap::tmap_arrange(p1,p2)
</code></pre>
<h4 id="132-导入环境栅格数据">1.3.2 导入环境栅格数据</h4>
<pre><code class="language-r">ef_raster &lt;- list.files(path = &quot;./data&quot;, pattern = &quot;asc$&quot;, full.names = T) %&gt;%
  stack()
ef_terra &lt;- list.files(path = &quot;./data&quot;, pattern = &quot;asc$&quot;, full.names = T) %&gt;%
  rast()
</code></pre>
<pre><code class="language-r">subset(ef_terra, c(&quot;ndvi20161&quot;, &quot;ndvi20162&quot;, &quot;ndvi20163&quot;, &quot;ndvi20164&quot;)) %&gt;%
  rasterVis::levelplot()
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;" />
<pre><code class="language-r"># 定义函数并行绘图
map_tmap &lt;- function(value, raster) {
  raster %&gt;%
    subset(value) %&gt;%
    tm_shape() +
    tm_raster() +
    tm_shape(sh_county_sf) +
    tm_borders() +
    tm_layout(
      legend.title.size = .7,
      legend.text.size = 0.5,
      legend.outside = F,
      legend.width = 0.5
    )
}

# 执行并行绘图
ef_tmap &lt;- names(ef_raster) %&gt;%
  as_tibble() %&gt;%
  mutate(raster = list(ef_terra)) %&gt;%
  group_by(value) %&gt;%
  mutate(plot = map2(value, raster, map_tmap))

# 18副图排4列
do.call(tmap_arrange, c(ef_tmap$plot, ncol = 4))
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;" />
<p>其实这里就可以看出来上海市部分环境变量之间的差异非常不显著，毕竟面积大小限制在那里，自然环境多样性较低。这种影响体现在后续建模上有变量方差小，变化小，重要性低，变量<code>landcover</code>就是个例子</p>
<ul>
<li>上海环境数据</li>
</ul>
<pre><code class="language-r">env_df &lt;- ef_raster %&gt;%
  as.data.frame(xy = T)
kableExtra::kable(head(na.omit(env_df)))
</code></pre>
<table>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> x </th>
   <th style="text-align:right;"> y </th>
   <th style="text-align:right;"> aat0 </th>
   <th style="text-align:right;"> aat10 </th>
   <th style="text-align:right;"> aridity </th>
   <th style="text-align:right;"> dem </th>
   <th style="text-align:right;"> dst_waterway </th>
   <th style="text-align:right;"> hfp </th>
   <th style="text-align:right;"> hii </th>
   <th style="text-align:right;"> im </th>
   <th style="text-align:right;"> landcover </th>
   <th style="text-align:right;"> landform </th>
   <th style="text-align:right;"> ndvi20161 </th>
   <th style="text-align:right;"> ndvi20162 </th>
   <th style="text-align:right;"> ndvi20163 </th>
   <th style="text-align:right;"> ndvi20164 </th>
   <th style="text-align:right;"> night_time_lights </th>
   <th style="text-align:right;"> pa </th>
   <th style="text-align:right;"> slope </th>
   <th style="text-align:right;"> tadem </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 80780 </td>
   <td style="text-align:right;"> 121.2542 </td>
   <td style="text-align:right;"> 31.835 </td>
   <td style="text-align:right;"> 54169.06 </td>
   <td style="text-align:right;"> 48595 </td>
   <td style="text-align:right;"> 882 </td>
   <td style="text-align:right;"> 3.818729 </td>
   <td style="text-align:right;"> 0.2429989 </td>
   <td style="text-align:right;"> 34 </td>
   <td style="text-align:right;"> 22 </td>
   <td style="text-align:right;"> 3045.937 </td>
   <td style="text-align:right;"> 11.91932 </td>
   <td style="text-align:right;"> 11 </td>
   <td style="text-align:right;"> 0.7527465 </td>
   <td style="text-align:right;"> 0.8009197 </td>
   <td style="text-align:right;"> 0.7760156 </td>
   <td style="text-align:right;"> 0.4311277 </td>
   <td style="text-align:right;"> 0.6530336 </td>
   <td style="text-align:right;"> 10786.32 </td>
   <td style="text-align:right;"> 0.0065331 </td>
   <td style="text-align:right;"> 148 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 80781 </td>
   <td style="text-align:right;"> 121.2550 </td>
   <td style="text-align:right;"> 31.835 </td>
   <td style="text-align:right;"> 54170.17 </td>
   <td style="text-align:right;"> 48595 </td>
   <td style="text-align:right;"> 882 </td>
   <td style="text-align:right;"> 3.763675 </td>
   <td style="text-align:right;"> 0.2062404 </td>
   <td style="text-align:right;"> 34 </td>
   <td style="text-align:right;"> 22 </td>
   <td style="text-align:right;"> 3046.431 </td>
   <td style="text-align:right;"> 12.18322 </td>
   <td style="text-align:right;"> 11 </td>
   <td style="text-align:right;"> 0.7547723 </td>
   <td style="text-align:right;"> 0.8054522 </td>
   <td style="text-align:right;"> 0.7794802 </td>
   <td style="text-align:right;"> 0.4284502 </td>
   <td style="text-align:right;"> 0.6530336 </td>
   <td style="text-align:right;"> 10786.67 </td>
   <td style="text-align:right;"> 0.0353408 </td>
   <td style="text-align:right;"> 148 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 80782 </td>
   <td style="text-align:right;"> 121.2558 </td>
   <td style="text-align:right;"> 31.835 </td>
   <td style="text-align:right;"> 54171.27 </td>
   <td style="text-align:right;"> 48595 </td>
   <td style="text-align:right;"> 882 </td>
   <td style="text-align:right;"> 3.708621 </td>
   <td style="text-align:right;"> 0.1885153 </td>
   <td style="text-align:right;"> 34 </td>
   <td style="text-align:right;"> 22 </td>
   <td style="text-align:right;"> 3046.924 </td>
   <td style="text-align:right;"> 12.44711 </td>
   <td style="text-align:right;"> 11 </td>
   <td style="text-align:right;"> 0.7567980 </td>
   <td style="text-align:right;"> 0.8099846 </td>
   <td style="text-align:right;"> 0.7829449 </td>
   <td style="text-align:right;"> 0.4257726 </td>
   <td style="text-align:right;"> 0.6573089 </td>
   <td style="text-align:right;"> 10787.02 </td>
   <td style="text-align:right;"> 0.0386075 </td>
   <td style="text-align:right;"> 148 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 80783 </td>
   <td style="text-align:right;"> 121.2567 </td>
   <td style="text-align:right;"> 31.835 </td>
   <td style="text-align:right;"> 54172.00 </td>
   <td style="text-align:right;"> 48595 </td>
   <td style="text-align:right;"> 882 </td>
   <td style="text-align:right;"> 3.698650 </td>
   <td style="text-align:right;"> 0.1859790 </td>
   <td style="text-align:right;"> 34 </td>
   <td style="text-align:right;"> 22 </td>
   <td style="text-align:right;"> 3047.417 </td>
   <td style="text-align:right;"> 12.71101 </td>
   <td style="text-align:right;"> 11 </td>
   <td style="text-align:right;"> 0.7588238 </td>
   <td style="text-align:right;"> 0.8145171 </td>
   <td style="text-align:right;"> 0.7864096 </td>
   <td style="text-align:right;"> 0.4230951 </td>
   <td style="text-align:right;"> 0.6760752 </td>
   <td style="text-align:right;"> 10787.37 </td>
   <td style="text-align:right;"> 0.1776575 </td>
   <td style="text-align:right;"> 148 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 80784 </td>
   <td style="text-align:right;"> 121.2575 </td>
   <td style="text-align:right;"> 31.835 </td>
   <td style="text-align:right;"> 54172.00 </td>
   <td style="text-align:right;"> 48595 </td>
   <td style="text-align:right;"> 882 </td>
   <td style="text-align:right;"> 3.697019 </td>
   <td style="text-align:right;"> 0.1859790 </td>
   <td style="text-align:right;"> 34 </td>
   <td style="text-align:right;"> 22 </td>
   <td style="text-align:right;"> 3047.911 </td>
   <td style="text-align:right;"> 12.97491 </td>
   <td style="text-align:right;"> 11 </td>
   <td style="text-align:right;"> 0.7571884 </td>
   <td style="text-align:right;"> 0.8149572 </td>
   <td style="text-align:right;"> 0.7856975 </td>
   <td style="text-align:right;"> 0.4230389 </td>
   <td style="text-align:right;"> 0.6803572 </td>
   <td style="text-align:right;"> 10787.71 </td>
   <td style="text-align:right;"> 0.8430415 </td>
   <td style="text-align:right;"> 148 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 80785 </td>
   <td style="text-align:right;"> 121.2583 </td>
   <td style="text-align:right;"> 31.835 </td>
   <td style="text-align:right;"> 54172.00 </td>
   <td style="text-align:right;"> 48595 </td>
   <td style="text-align:right;"> 882 </td>
   <td style="text-align:right;"> 3.695387 </td>
   <td style="text-align:right;"> 0.1859790 </td>
   <td style="text-align:right;"> 34 </td>
   <td style="text-align:right;"> 22 </td>
   <td style="text-align:right;"> 3048.404 </td>
   <td style="text-align:right;"> 13.23881 </td>
   <td style="text-align:right;"> 11 </td>
   <td style="text-align:right;"> 0.7543440 </td>
   <td style="text-align:right;"> 0.8140461 </td>
   <td style="text-align:right;"> 0.7836061 </td>
   <td style="text-align:right;"> 0.4238482 </td>
   <td style="text-align:right;"> 0.6803572 </td>
   <td style="text-align:right;"> 10788.06 </td>
   <td style="text-align:right;"> 0.9790576 </td>
   <td style="text-align:right;"> 148 </td>
  </tr>
</tbody>
</table>
<h4 id="133-导入存在点数据">1.3.3 导入存在点数据</h4>
<ul>
<li>同时提取环境数据</li>
</ul>
<pre><code class="language-r"># 添加注释是因为改用terra包重写以加快速度
presence_df &lt;- read_excel(&quot;./data/14—17上海某入侵物种调查.xlsx&quot;) %&gt;%
  # sf::st_as_sf(coords = c(&quot;x&quot;, &quot;y&quot;), crs = 4326) %&gt;%
  # raster::extract(x = ef_raster,y = .,df = T) %&gt;%
  dplyr::select(x, y) %&gt;%
  terra::extract(x = ef_terra, y = ., df = T) %&gt;%
  bind_cols(read_excel(&quot;./data/14—17上海某入侵物种调查.xlsx&quot;)) %&gt;%
  # dplyr::select(-ID) %&gt;%
  mutate(class = 1)
</code></pre>
<ul>
<li>随机生成不存在点数据</li>
</ul>
<p>在上海市仅存在阳性点的区按照<code>1:10</code>比例使用随机抽样方法生成不存在点，并且同样提取环境数据</p>
<blockquote>
<p>[!Note]<br>
<s>曾经尝试按照<code>1:3</code>比例使用随机抽样方法生成<code>270</code>个不存在点，效果好所以放弃</s></p>
</blockquote>
<pre><code class="language-r">county_names &lt;- read_excel(&quot;./data/14—17上海某入侵物种调查.xlsx&quot;) %&gt;%
  dplyr::select(didian) %&gt;%
  mutate(county = str_sub(didian, 5, 7)) %&gt;%
  pull(county) %&gt;%
  table() %&gt;%
  as.data.frame() %&gt;%
  setNames(c(&quot;county&quot;, &quot;freq&quot;)) %&gt;%
  as_tibble()

absence_pts &lt;- sh_county_sf %&gt;%
  dplyr::filter(Name_County %in% county_names$county) %&gt;%
  group_by(Name_County) %&gt;%
  summarise(geometry = st_union(geometry)) %&gt;%
  ungroup() %&gt;%
  group_by(Name_County) %&gt;%
  nest() %&gt;%
  left_join(county_names, by = c(&quot;Name_County&quot; = &quot;county&quot;)) %&gt;%
  mutate(sample_pts = map2(.x = data, .y = freq, .f = function(x, y) {
    st_sample(x = x, size = 10 * y) %&gt;%
      st_coordinates() %&gt;%
      as.data.frame() %&gt;%
      rename(x = X, y = Y)
  })) %&gt;%
  dplyr::select(-data) %&gt;%
  ungroup() %&gt;%
  unnest(sample_pts) %&gt;%
  dplyr::select(x, y)

absence_df &lt;- absence_pts %&gt;%
  terra::extract(x = ef_terra, y = ., df = T) %&gt;%
  bind_cols(absence_pts) %&gt;%
  mutate(class = 0)
</code></pre>
<ul>
<li>合并数据</li>
</ul>
<pre><code class="language-r">data_obs &lt;- absence_df %&gt;%
  bind_rows(presence_df) %&gt;%
  dplyr::select(-x, -y, -didian) %&gt;%
  mutate(class = paste0(&quot;X&quot;, class)) %&gt;%
  mutate(across(.cols = class, .fns = as.factor)) %&gt;%
  na.omit() %&gt;%
  dplyr::select(-ID)
kableExtra::kable(head(na.omit(data_obs)))
</code></pre>
<table>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> aat0 </th>
   <th style="text-align:right;"> aat10 </th>
   <th style="text-align:right;"> aridity </th>
   <th style="text-align:right;"> dem </th>
   <th style="text-align:right;"> dst_waterway </th>
   <th style="text-align:right;"> hfp </th>
   <th style="text-align:right;"> hii </th>
   <th style="text-align:right;"> im </th>
   <th style="text-align:right;"> landcover </th>
   <th style="text-align:right;"> landform </th>
   <th style="text-align:right;"> ndvi20161 </th>
   <th style="text-align:right;"> ndvi20162 </th>
   <th style="text-align:right;"> ndvi20163 </th>
   <th style="text-align:right;"> ndvi20164 </th>
   <th style="text-align:right;"> night_time_lights </th>
   <th style="text-align:right;"> pa </th>
   <th style="text-align:right;"> slope </th>
   <th style="text-align:right;"> tadem </th>
   <th style="text-align:left;"> class </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 56969.23 </td>
   <td style="text-align:right;"> 50272.00 </td>
   <td style="text-align:right;"> 848.6270 </td>
   <td style="text-align:right;"> 3.285788 </td>
   <td style="text-align:right;"> 0.1591941 </td>
   <td style="text-align:right;"> 40.00000 </td>
   <td style="text-align:right;"> 26.00000 </td>
   <td style="text-align:right;"> 4357.966 </td>
   <td style="text-align:right;"> 11.00000 </td>
   <td style="text-align:right;"> 11 </td>
   <td style="text-align:right;"> 0.4716095 </td>
   <td style="text-align:right;"> 0.7535464 </td>
   <td style="text-align:right;"> 0.7962473 </td>
   <td style="text-align:right;"> 0.3757187 </td>
   <td style="text-align:right;"> 2.316915 </td>
   <td style="text-align:right;"> 12232.88 </td>
   <td style="text-align:right;"> 0.0485061 </td>
   <td style="text-align:right;"> 156.0000 </td>
   <td style="text-align:left;"> X0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 56990.74 </td>
   <td style="text-align:right;"> 50301.00 </td>
   <td style="text-align:right;"> 859.3091 </td>
   <td style="text-align:right;"> 6.241808 </td>
   <td style="text-align:right;"> 0.4389469 </td>
   <td style="text-align:right;"> 48.66079 </td>
   <td style="text-align:right;"> 35.01265 </td>
   <td style="text-align:right;"> 4158.062 </td>
   <td style="text-align:right;"> 12.72016 </td>
   <td style="text-align:right;"> 11 </td>
   <td style="text-align:right;"> 0.5321335 </td>
   <td style="text-align:right;"> 0.6402435 </td>
   <td style="text-align:right;"> 0.6625317 </td>
   <td style="text-align:right;"> 0.4416339 </td>
   <td style="text-align:right;"> 3.795737 </td>
   <td style="text-align:right;"> 12053.76 </td>
   <td style="text-align:right;"> 0.4710122 </td>
   <td style="text-align:right;"> 156.0000 </td>
   <td style="text-align:left;"> X0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 4 </td>
   <td style="text-align:right;"> 57344.96 </td>
   <td style="text-align:right;"> 50388.41 </td>
   <td style="text-align:right;"> 874.4128 </td>
   <td style="text-align:right;"> 5.370913 </td>
   <td style="text-align:right;"> 0.4259507 </td>
   <td style="text-align:right;"> 40.00000 </td>
   <td style="text-align:right;"> 26.00000 </td>
   <td style="text-align:right;"> 4029.103 </td>
   <td style="text-align:right;"> 13.17483 </td>
   <td style="text-align:right;"> 11 </td>
   <td style="text-align:right;"> 0.4440503 </td>
   <td style="text-align:right;"> 0.6081095 </td>
   <td style="text-align:right;"> 0.6602809 </td>
   <td style="text-align:right;"> 0.3735611 </td>
   <td style="text-align:right;"> 2.117563 </td>
   <td style="text-align:right;"> 11878.25 </td>
   <td style="text-align:right;"> 0.5580584 </td>
   <td style="text-align:right;"> 157.0000 </td>
   <td style="text-align:left;"> X0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 5 </td>
   <td style="text-align:right;"> 56814.00 </td>
   <td style="text-align:right;"> 50149.00 </td>
   <td style="text-align:right;"> 880.0638 </td>
   <td style="text-align:right;"> 5.224210 </td>
   <td style="text-align:right;"> 0.3693755 </td>
   <td style="text-align:right;"> 59.56630 </td>
   <td style="text-align:right;"> 39.00000 </td>
   <td style="text-align:right;"> 3768.323 </td>
   <td style="text-align:right;"> 27.86970 </td>
   <td style="text-align:right;"> 11 </td>
   <td style="text-align:right;"> 0.4205610 </td>
   <td style="text-align:right;"> 0.5874468 </td>
   <td style="text-align:right;"> 0.5017363 </td>
   <td style="text-align:right;"> 0.3151449 </td>
   <td style="text-align:right;"> 9.210016 </td>
   <td style="text-align:right;"> 11666.59 </td>
   <td style="text-align:right;"> 0.8404452 </td>
   <td style="text-align:right;"> 156.0000 </td>
   <td style="text-align:left;"> X0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 6 </td>
   <td style="text-align:right;"> 56968.00 </td>
   <td style="text-align:right;"> 50272.00 </td>
   <td style="text-align:right;"> 845.4159 </td>
   <td style="text-align:right;"> 4.332935 </td>
   <td style="text-align:right;"> 1.0540981 </td>
   <td style="text-align:right;"> 40.00000 </td>
   <td style="text-align:right;"> 26.00000 </td>
   <td style="text-align:right;"> 4423.404 </td>
   <td style="text-align:right;"> 25.00116 </td>
   <td style="text-align:right;"> 11 </td>
   <td style="text-align:right;"> 0.4114930 </td>
   <td style="text-align:right;"> 0.7043860 </td>
   <td style="text-align:right;"> 0.7194383 </td>
   <td style="text-align:right;"> 0.3136024 </td>
   <td style="text-align:right;"> 4.711874 </td>
   <td style="text-align:right;"> 12294.81 </td>
   <td style="text-align:right;"> 0.7995603 </td>
   <td style="text-align:right;"> 156.0000 </td>
   <td style="text-align:left;"> X0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 7 </td>
   <td style="text-align:right;"> 57005.49 </td>
   <td style="text-align:right;"> 50301.49 </td>
   <td style="text-align:right;"> 859.2466 </td>
   <td style="text-align:right;"> 5.838018 </td>
   <td style="text-align:right;"> 0.6171991 </td>
   <td style="text-align:right;"> 49.18788 </td>
   <td style="text-align:right;"> 32.93911 </td>
   <td style="text-align:right;"> 4164.836 </td>
   <td style="text-align:right;"> 16.60622 </td>
   <td style="text-align:right;"> 11 </td>
   <td style="text-align:right;"> 0.4209920 </td>
   <td style="text-align:right;"> 0.5660487 </td>
   <td style="text-align:right;"> 0.5951257 </td>
   <td style="text-align:right;"> 0.3179027 </td>
   <td style="text-align:right;"> 2.112005 </td>
   <td style="text-align:right;"> 12061.50 </td>
   <td style="text-align:right;"> 0.4066345 </td>
   <td style="text-align:right;"> 156.0163 </td>
   <td style="text-align:left;"> X0 </td>
  </tr>
</tbody>
</table>
<pre><code class="language-r">ggplot(data = sh_county_sf) +
  geom_sf(fill = NA) +
  geom_sf(
    data = absence_df %&gt;%
      bind_rows(presence_df) %&gt;%
      mutate(class = ifelse(class == 0, &quot;absence&quot;, &quot;presence&quot;)) %&gt;%
      st_as_sf(coords = c(&quot;x&quot;, &quot;y&quot;), crs = 4326),
    aes(color = class)
  ) +
  theme_light() +
  labs(color = &quot;&quot;) +
  theme(legend.position = &quot;bottom&quot;)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;" />
<h3 id="14-数据概览">1.4 数据概览</h3>
<h4 id="141-数据摘要">1.4.1 数据摘要</h4>
<pre><code class="language-r">skimr::skim(data_obs)
</code></pre>
<table style='width: auto;'
      class='table table-condensed'>
<caption><span id="tab:unnamed-chunk-12"></span>Table 1: Data summary</caption>
<tbody>
  <tr>
   <td style="text-align:left;"> Name </td>
   <td style="text-align:left;"> data_obs </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Number of rows </td>
   <td style="text-align:left;"> 969 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Number of columns </td>
   <td style="text-align:left;"> 19 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> _______________________ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Column type frequency: </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> factor </td>
   <td style="text-align:left;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> numeric </td>
   <td style="text-align:left;"> 18 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ________________________ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Group variables </td>
   <td style="text-align:left;"> None </td>
  </tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table>
 <thead>
  <tr>
   <th style="text-align:left;"> skim_variable </th>
   <th style="text-align:right;"> n_missing </th>
   <th style="text-align:right;"> complete_rate </th>
   <th style="text-align:left;"> ordered </th>
   <th style="text-align:right;"> n_unique </th>
   <th style="text-align:left;"> top_counts </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> class </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> FALSE </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:left;"> X0: 879, X1: 90 </td>
  </tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
 <thead>
  <tr>
   <th style="text-align:left;"> skim_variable </th>
   <th style="text-align:right;"> n_missing </th>
   <th style="text-align:right;"> complete_rate </th>
   <th style="text-align:right;"> mean </th>
   <th style="text-align:right;"> sd </th>
   <th style="text-align:right;"> p0 </th>
   <th style="text-align:right;"> p25 </th>
   <th style="text-align:right;"> p50 </th>
   <th style="text-align:right;"> p75 </th>
   <th style="text-align:right;"> p100 </th>
   <th style="text-align:left;"> hist </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> aat0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 56708.24 </td>
   <td style="text-align:right;"> 200.84 </td>
   <td style="text-align:right;"> 55828.22 </td>
   <td style="text-align:right;"> 56602.00 </td>
   <td style="text-align:right;"> 56680.73 </td>
   <td style="text-align:right;"> 56877.00 </td>
   <td style="text-align:right;"> 57450.68 </td>
   <td style="text-align:left;"> ▁▁▇▅▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> aat10 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 50116.86 </td>
   <td style="text-align:right;"> 116.73 </td>
   <td style="text-align:right;"> 49631.00 </td>
   <td style="text-align:right;"> 50056.69 </td>
   <td style="text-align:right;"> 50090.00 </td>
   <td style="text-align:right;"> 50228.78 </td>
   <td style="text-align:right;"> 50390.62 </td>
   <td style="text-align:left;"> ▁▁▇▇▅ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> aridity </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 858.99 </td>
   <td style="text-align:right;"> 20.23 </td>
   <td style="text-align:right;"> 825.93 </td>
   <td style="text-align:right;"> 840.68 </td>
   <td style="text-align:right;"> 857.07 </td>
   <td style="text-align:right;"> 876.18 </td>
   <td style="text-align:right;"> 897.48 </td>
   <td style="text-align:left;"> ▇▇▇▆▆ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> dem </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 4.63 </td>
   <td style="text-align:right;"> 1.46 </td>
   <td style="text-align:right;"> -1.09 </td>
   <td style="text-align:right;"> 3.82 </td>
   <td style="text-align:right;"> 4.54 </td>
   <td style="text-align:right;"> 5.28 </td>
   <td style="text-align:right;"> 22.95 </td>
   <td style="text-align:left;"> ▂▇▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> dst_waterway </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.55 </td>
   <td style="text-align:right;"> 0.56 </td>
   <td style="text-align:right;"> 0.01 </td>
   <td style="text-align:right;"> 0.13 </td>
   <td style="text-align:right;"> 0.35 </td>
   <td style="text-align:right;"> 0.75 </td>
   <td style="text-align:right;"> 3.71 </td>
   <td style="text-align:left;"> ▇▂▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> hfp </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 46.32 </td>
   <td style="text-align:right;"> 10.17 </td>
   <td style="text-align:right;"> 25.37 </td>
   <td style="text-align:right;"> 40.00 </td>
   <td style="text-align:right;"> 42.89 </td>
   <td style="text-align:right;"> 50.16 </td>
   <td style="text-align:right;"> 83.52 </td>
   <td style="text-align:left;"> ▁▇▂▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> hii </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 30.05 </td>
   <td style="text-align:right;"> 6.75 </td>
   <td style="text-align:right;"> 14.28 </td>
   <td style="text-align:right;"> 26.00 </td>
   <td style="text-align:right;"> 27.39 </td>
   <td style="text-align:right;"> 32.60 </td>
   <td style="text-align:right;"> 54.00 </td>
   <td style="text-align:left;"> ▁▇▂▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> im </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 4136.58 </td>
   <td style="text-align:right;"> 398.55 </td>
   <td style="text-align:right;"> 3326.28 </td>
   <td style="text-align:right;"> 3798.22 </td>
   <td style="text-align:right;"> 4131.10 </td>
   <td style="text-align:right;"> 4509.82 </td>
   <td style="text-align:right;"> 4815.27 </td>
   <td style="text-align:left;"> ▅▆▇▆▇ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> landcover </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 28.20 </td>
   <td style="text-align:right;"> 13.87 </td>
   <td style="text-align:right;"> 11.00 </td>
   <td style="text-align:right;"> 15.08 </td>
   <td style="text-align:right;"> 25.77 </td>
   <td style="text-align:right;"> 39.99 </td>
   <td style="text-align:right;"> 51.94 </td>
   <td style="text-align:left;"> ▇▅▃▂▅ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> landform </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 11.02 </td>
   <td style="text-align:right;"> 0.39 </td>
   <td style="text-align:right;"> 11.00 </td>
   <td style="text-align:right;"> 11.00 </td>
   <td style="text-align:right;"> 11.00 </td>
   <td style="text-align:right;"> 11.00 </td>
   <td style="text-align:right;"> 20.48 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ndvi20161 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.47 </td>
   <td style="text-align:right;"> 0.08 </td>
   <td style="text-align:right;"> 0.14 </td>
   <td style="text-align:right;"> 0.41 </td>
   <td style="text-align:right;"> 0.47 </td>
   <td style="text-align:right;"> 0.53 </td>
   <td style="text-align:right;"> 0.73 </td>
   <td style="text-align:left;"> ▁▂▇▆▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ndvi20162 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.63 </td>
   <td style="text-align:right;"> 0.14 </td>
   <td style="text-align:right;"> 0.28 </td>
   <td style="text-align:right;"> 0.55 </td>
   <td style="text-align:right;"> 0.67 </td>
   <td style="text-align:right;"> 0.74 </td>
   <td style="text-align:right;"> 0.86 </td>
   <td style="text-align:left;"> ▂▃▅▇▅ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ndvi20163 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.60 </td>
   <td style="text-align:right;"> 0.13 </td>
   <td style="text-align:right;"> 0.19 </td>
   <td style="text-align:right;"> 0.51 </td>
   <td style="text-align:right;"> 0.63 </td>
   <td style="text-align:right;"> 0.70 </td>
   <td style="text-align:right;"> 0.86 </td>
   <td style="text-align:left;"> ▁▃▃▇▃ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ndvi20164 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.33 </td>
   <td style="text-align:right;"> 0.06 </td>
   <td style="text-align:right;"> 0.07 </td>
   <td style="text-align:right;"> 0.30 </td>
   <td style="text-align:right;"> 0.34 </td>
   <td style="text-align:right;"> 0.38 </td>
   <td style="text-align:right;"> 0.53 </td>
   <td style="text-align:left;"> ▁▂▇▇▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> night_time_lights </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 10.57 </td>
   <td style="text-align:right;"> 10.59 </td>
   <td style="text-align:right;"> 1.08 </td>
   <td style="text-align:right;"> 2.33 </td>
   <td style="text-align:right;"> 5.90 </td>
   <td style="text-align:right;"> 15.84 </td>
   <td style="text-align:right;"> 52.81 </td>
   <td style="text-align:left;"> ▇▂▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> pa </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 12000.45 </td>
   <td style="text-align:right;"> 372.66 </td>
   <td style="text-align:right;"> 11217.78 </td>
   <td style="text-align:right;"> 11681.31 </td>
   <td style="text-align:right;"> 11991.32 </td>
   <td style="text-align:right;"> 12358.29 </td>
   <td style="text-align:right;"> 12629.10 </td>
   <td style="text-align:left;"> ▃▇▇▆▇ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> slope </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.51 </td>
   <td style="text-align:right;"> 0.44 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.24 </td>
   <td style="text-align:right;"> 0.48 </td>
   <td style="text-align:right;"> 0.74 </td>
   <td style="text-align:right;"> 8.28 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> tadem </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 155.33 </td>
   <td style="text-align:right;"> 0.59 </td>
   <td style="text-align:right;"> 153.00 </td>
   <td style="text-align:right;"> 155.00 </td>
   <td style="text-align:right;"> 155.00 </td>
   <td style="text-align:right;"> 156.00 </td>
   <td style="text-align:right;"> 157.00 </td>
   <td style="text-align:left;"> ▁▁▇▅▁ </td>
  </tr>
</tbody>
</table>
<h4 id="142-相关系数图">1.4.2 相关系数图</h4>
<pre><code class="language-r">data_obs %&gt;%
  dplyr::select_if(is.numeric) %&gt;%
  as.matrix() %&gt;%
  quickcor(cor.test = TRUE) +
  geom_square(data = get_data(type = &quot;lower&quot;, show.diag = FALSE)) +
  geom_number(aes(num = r), size = 2.5, data = get_data(type = &quot;upper&quot;, show.diag = FALSE)) +
  geom_abline(intercept = 19, slope = -1, size = 0.8) +
  scale_fill_gradientn(colours = c(&quot;#77C034&quot;, &quot;white&quot;, &quot;#C388FE&quot;))
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-13-1.png" width="672" style="display: block; margin: auto;" />
<p>部分变量的相关性非常强</p>
<h4 id="143-变量直方图">1.4.3 变量直方图</h4>
<pre><code class="language-r">data_obs %&gt;%
  dplyr::select_if(is.numeric) %&gt;%
  pivot_longer(everything(),
    names_to = &quot;vars&quot;,
    values_to = &quot;value&quot;
  ) %&gt;%
  ggplot(aes(value, fill = vars)) +
  geom_histogram(aes(value, fill = vars)) +
  facet_wrap(~vars, scales = &quot;free&quot;, nrow = 3) +
  scale_y_continuous(name = &quot;frequency&quot;) +
  scale_x_continuous(name = &quot;Continuous variables&quot;) +
  labs(title = &quot;Histogram of different variables&quot;) +
  guides(fill = &quot;none&quot;) +
  scale_fill_viridis_d() +
  theme_bw() +
  theme(
    plot.title = element_text(size = 10, hjust = 0.5, face = &quot;bold&quot;),
    text = element_text(size = 8, face = &quot;bold&quot;, hjust = 0.5),
    axis.title.y = element_text(face = &quot;bold&quot;, hjust = 0.5),
    axis.text.x = element_text(size = 6, face = &quot;bold&quot;, angle = 30, hjust = 0.5, vjust = 0.5)
  )
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-14-1.png" width="672" style="display: block; margin: auto;" />
<h2 id="2切分数据">2.切分数据</h2>
<ul>
<li>分层抽样(样本非平衡)</li>
</ul>
<pre><code class="language-r">set.seed(1111)
train.index &lt;- createDataPartition(data_obs$class, p = .7, list = FALSE)
train &lt;- data_obs[train.index, ]
test &lt;- data_obs[-train.index, ]

whole_prop &lt;- data_obs %&gt;%
  group_by(class) %&gt;%
  summarise(count = n()) %&gt;%
  mutate(prop = count / sum(count)) %&gt;%
  mutate(dataset = &quot;whole_dataset&quot;) %&gt;%
  dplyr::select(dataset, everything())

train_prop &lt;- train %&gt;%
  group_by(class) %&gt;%
  summarise(count = n()) %&gt;%
  mutate(prop = count / sum(count)) %&gt;%
  mutate(dataset = &quot;train_dataset&quot;) %&gt;%
  dplyr::select(dataset, everything())

test_prop &lt;- test %&gt;%
  group_by(class) %&gt;%
  summarise(count = n()) %&gt;%
  mutate(prop = count / sum(count)) %&gt;%
  mutate(dataset = &quot;test_dataset&quot;) %&gt;%
  dplyr::select(dataset, everything())

whole_prop %&gt;%
  bind_rows(train_prop) %&gt;%
  bind_rows(test_prop) %&gt;%
  mutate(across(prop, .fns = function(x) {
    return(round(x, 2))
  })) %&gt;%
  kable()
</code></pre>
<table>
 <thead>
  <tr>
   <th style="text-align:left;"> dataset </th>
   <th style="text-align:left;"> class </th>
   <th style="text-align:right;"> count </th>
   <th style="text-align:right;"> prop </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> whole_dataset </td>
   <td style="text-align:left;"> X0 </td>
   <td style="text-align:right;"> 879 </td>
   <td style="text-align:right;"> 0.91 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> whole_dataset </td>
   <td style="text-align:left;"> X1 </td>
   <td style="text-align:right;"> 90 </td>
   <td style="text-align:right;"> 0.09 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> train_dataset </td>
   <td style="text-align:left;"> X0 </td>
   <td style="text-align:right;"> 616 </td>
   <td style="text-align:right;"> 0.91 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> train_dataset </td>
   <td style="text-align:left;"> X1 </td>
   <td style="text-align:right;"> 63 </td>
   <td style="text-align:right;"> 0.09 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> test_dataset </td>
   <td style="text-align:left;"> X0 </td>
   <td style="text-align:right;"> 263 </td>
   <td style="text-align:right;"> 0.91 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> test_dataset </td>
   <td style="text-align:left;"> X1 </td>
   <td style="text-align:right;"> 27 </td>
   <td style="text-align:right;"> 0.09 </td>
  </tr>
</tbody>
</table>
<h2 id="3建立模型">3.建立模型</h2>
<h3 id="31svm">3.1SVM</h3>
<ul>
<li>10折交叉验证，3次重复</li>
</ul>
<pre><code class="language-r">train_control &lt;- trainControl(
  method = &quot;repeatedcv&quot;, number = 10,
  repeats = 3, savePredictions = TRUE,
  classProbs = TRUE
)
# metric=&quot;ROC&quot;/metric=&quot;Kappa&quot;
svm_model &lt;- train(class ~ .,
  data = train, metric = &quot;Kappa&quot;,
  method = &quot;svmRadial&quot;, trControl = train_control,
  preProcess = c(&quot;center&quot;, &quot;scale&quot;), tuneLength = 10
)
svm_model
</code></pre>
<pre><code>#&gt; Support Vector Machines with Radial Basis Function Kernel 
#&gt; 
#&gt; 679 samples
#&gt;  18 predictor
#&gt;   2 classes: 'X0', 'X1' 
#&gt; 
#&gt; Pre-processing: centered (18), scaled (18) 
#&gt; Resampling: Cross-Validated (10 fold, repeated 3 times) 
#&gt; Summary of sample sizes: 612, 611, 611, 612, 611, 612, ... 
#&gt; Resampling results across tuning parameters:
#&gt; 
#&gt;   C       Accuracy   Kappa      
#&gt;     0.25  0.9220187  0.328749831
#&gt;     0.50  0.9225455  0.321042728
#&gt;     1.00  0.9210530  0.322979828
#&gt;     2.00  0.9220263  0.325626361
#&gt;     4.00  0.9186160  0.311626047
#&gt;     8.00  0.9239939  0.369362058
#&gt;    16.00  0.9215354  0.363646688
#&gt;    32.00  0.9146507  0.267146233
#&gt;    64.00  0.9048380  0.112705936
#&gt;   128.00  0.8929922  0.004721265
#&gt; 
#&gt; Tuning parameter 'sigma' was held constant at a value of 0.06250791
#&gt; Kappa was used to select the optimal model using the largest value.
#&gt; The final values used for the model were sigma = 0.06250791 and C = 8.
</code></pre>
<ul>
<li>输出<code>Kappa</code>达到最大的模型参数</li>
</ul>
<pre><code class="language-r">svm_model$bestTune %&gt;%
  kable()
</code></pre>
<table>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> sigma </th>
   <th style="text-align:right;"> C </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 6 </td>
   <td style="text-align:right;"> 0.0625079 </td>
   <td style="text-align:right;"> 8 </td>
  </tr>
</tbody>
</table>
<ul>
<li>输出模型评价指标</li>
</ul>
<blockquote>
<p>[!info]<br>
输出<code>acc</code>、<code>kappa</code>、<code>ROC</code>、<code>ppv</code>等指标</p>
</blockquote>
<pre><code class="language-r">metric_table &lt;- function(model) {
  temp_df &lt;- model$pred %&gt;%
    as_tibble() %&gt;%
    dplyr::select(pred, obs, X0, X1, Resample) %&gt;%
    nest(data = c(pred, obs, X0, X1)) %&gt;%
    mutate(
      acc = map(data, ~ accuracy_vec(.x$obs, .x$pred)),
      kappa = map(data, ~ kap_vec(.x$obs, .x$pred)),
      # ,options = list(smooth = TRUE)
      ROC = map(data, ~ roc_auc_vec(.x$obs, .x$X0)),
      ppv = map(data, ~ ppv_vec(.x$obs, .x$pred))
    ) %&gt;%
    unnest(c(acc, kappa, ROC, ppv)) %&gt;%
    dplyr::select(-data)
  return(temp_df)
}
</code></pre>
<ul>
<li>自定义cell_spec以强调指标最大值</li>
</ul>
<pre><code class="language-r">beautify_metric_table &lt;- function(table) {
  temp_df &lt;- table

  # 美化函数
  my_cell_spec1 &lt;- function(x) {
    cell_spec(x,
      &quot;html&quot;,
      color = ifelse(x == max(x),
        &quot;red&quot;,
        &quot;black&quot;
      ),
      italic = ifelse(x == max(x),
        TRUE,
        FALSE
      ),
      bold = ifelse(x == max(x),
        TRUE,
        FALSE
      ),
      background = ifelse(x == max(x),
        &quot;grey&quot;,
        &quot;white&quot;
      ),
      font_size = ifelse(x == max(x),
        20,
        15
      )
    )
  }

  # 美化表格
  final_df &lt;- temp_df %&gt;%
    mutate(across(where(is.numeric), .fns = function(x) round(x, 2))) %&gt;%
    mutate(across(.cols = where(is.numeric), my_cell_spec1)) %&gt;%
    kable(&quot;html&quot;, escape = FALSE) %&gt;%
    kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;)) %&gt;%
    kableExtra::kable_classic()

  return(final_df)
}
metric_table(svm_model) %&gt;%
  beautify_metric_table(table = .)
</code></pre>
<table class="table table-striped table-hover lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;"> Resample </th>
   <th style="text-align:left;"> acc </th>
   <th style="text-align:left;"> kappa </th>
   <th style="text-align:left;"> ROC </th>
   <th style="text-align:left;"> ppv </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Fold01.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.36</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.88</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold02.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.34</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold03.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.23</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.81</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold04.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.37</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold05.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.18</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.88</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold06.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.29</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.84</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold07.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.44</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold08.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.32</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.86</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold09.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.39</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.86</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold10.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.2</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.81</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold01.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.43</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold02.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.39</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.86</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold03.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.2</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold04.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.37</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold05.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.34</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold06.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.89</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.79</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold07.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.88</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.18</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.88</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold08.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.18</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.85</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold09.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.49</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.85</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold10.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.83</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold01.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.24</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold02.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.25</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.79</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold03.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.2</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.6</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold04.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.43</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold05.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.89</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.14</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.82</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold06.Rep3 </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.94</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.53</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.81</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold07.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.2</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.87</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold08.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.43</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.86</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold09.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.21</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold10.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.3</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
</tbody>
</table>
<ul>
<li>混淆矩阵</li>
</ul>
<p>10折交叉验证并且重复三次的结果如下(因为是平均所以会有非整数)</p>
<pre><code class="language-r">confusionMatrix.train(svm_model)
</code></pre>
<pre><code>#&gt; Cross-Validated (10 fold, repeated 3 times) Confusion Matrix 
#&gt; 
#&gt; (entries are percentual average cell counts across resamples)
#&gt;  
#&gt;           Reference
#&gt; Prediction   X0   X1
#&gt;         X0 89.7  6.6
#&gt;         X1  1.0  2.7
#&gt;                             
#&gt;  Accuracy (average) : 0.9239
</code></pre>
<ul>
<li>最优参数预测的混淆矩阵.</li>
</ul>
<pre><code class="language-r">confusionMatrix(data = predict(svm_model, train), reference = train$class)
</code></pre>
<pre><code>#&gt; Confusion Matrix and Statistics
#&gt; 
#&gt;           Reference
#&gt; Prediction  X0  X1
#&gt;         X0 614  38
#&gt;         X1   2  25
#&gt;                                           
#&gt;                Accuracy : 0.9411          
#&gt;                  95% CI : (0.9206, 0.9576)
#&gt;     No Information Rate : 0.9072          
#&gt;     P-Value [Acc &gt; NIR] : 0.0008265       
#&gt;                                           
#&gt;                   Kappa : 0.5294          
#&gt;                                           
#&gt;  Mcnemar's Test P-Value : 3.13e-08        
#&gt;                                           
#&gt;             Sensitivity : 0.9968          
#&gt;             Specificity : 0.3968          
#&gt;          Pos Pred Value : 0.9417          
#&gt;          Neg Pred Value : 0.9259          
#&gt;              Prevalence : 0.9072          
#&gt;          Detection Rate : 0.9043          
#&gt;    Detection Prevalence : 0.9602          
#&gt;       Balanced Accuracy : 0.6968          
#&gt;                                           
#&gt;        'Positive' Class : X0              
#&gt; 
</code></pre>
<ul>
<li>变量重要性</li>
</ul>
<blockquote>
<p>[!Note]<br>
按照降序排列前若干个重要变量</p>
</blockquote>
<pre><code class="language-r">kable_var &lt;- function(model, num) {
  temp_df &lt;- caret::varImp(model) %&gt;%
    .$importance %&gt;%
    dplyr::select(last_col()) %&gt;%
    rownames_to_column(&quot;variables&quot;) %&gt;%
    setNames(c(&quot;variables&quot;, &quot;importance&quot;)) %&gt;%
    arrange(desc(importance)) %&gt;%
    rownames_to_column(&quot;id&quot;)

  importance_threshold &lt;- temp_df %&gt;%
    dplyr::filter(id == num) %&gt;%
    pull(importance)

  # 辅助列上色
  # 美化函数
  my_cell_spec2 &lt;- function(x) {
    cell_spec(x,
      &quot;html&quot;,
      color = ifelse(x &gt;= importance_threshold,
        &quot;red&quot;,
        &quot;black&quot;
      ),
      italic = ifelse(x &gt;= importance_threshold,
        TRUE,
        FALSE
      ),
      bold = ifelse(x &gt;= importance_threshold,
        TRUE,
        FALSE
      ),
      background = ifelse(x &gt;= importance_threshold,
        &quot;grey&quot;,
        &quot;white&quot;
      ),
      font_size = ifelse(x &gt;= importance_threshold,
        20,
        15
      )
    )
  }

  final_df &lt;- temp_df %&gt;%
    mutate(across(where(is.numeric), .fns = function(x) round(x, 4))) %&gt;%
    mutate(across(.cols = where(is.numeric), my_cell_spec2)) %&gt;%
    dplyr::select(-id) %&gt;%
    kable(&quot;html&quot;, align = &quot;cr&quot;, escape = FALSE) %&gt;%
    kable_styling() %&gt;%
    kableExtra::kable_classic()

  return(final_df)
}
kable_var(svm_model, 6)
</code></pre>
<table class="table lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> variables </th>
   <th style="text-align:right;"> importance </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> ndvi20162 </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">100</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> night_time_lights </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">91.7989</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20164 </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">91.1196</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20161 </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">88.106</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20163 </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">75.298</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> aridity </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">72.3214</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> im </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">71.9014</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> pa </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">70.7898</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> dst_waterway </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">49.2126</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> hfp </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">35.5277</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> hii </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">27.3451</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> landcover </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">25.2393</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> dem </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">16.5071</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> slope </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">11.5544</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> tadem </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">8.1702</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> aat10 </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">5.7185</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> aat0 </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">1.2722</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> landform </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0</span> </td>
  </tr>
</tbody>
</table>
<p>这里按照降序绘制前若干个重要变量</p>
<pre><code class="language-r">ggplot_var &lt;- function(model, num) {
  caret::varImp(model) %&gt;%
    .$importance %&gt;%
    dplyr::select(last_col()) %&gt;%
    rownames_to_column(&quot;variables&quot;) %&gt;%
    setNames(c(&quot;variables&quot;, &quot;importance&quot;)) %&gt;%
    arrange(desc(importance)) %&gt;%
    rowid_to_column(&quot;rowid&quot;) %&gt;%
    mutate(group = case_when(
      rowid &gt; num ~ &quot;B&quot;,
      TRUE ~ &quot;A&quot;
    )) %&gt;%
    ggplot(aes(x = reorder(variables, importance), importance, fill = group)) +
    geom_col(alpha = 0.7, bins = 30) +
    scale_x_discrete(name = &quot;variables&quot;) +
    scale_y_continuous(name = &quot;importance&quot;) +
    labs(title = &quot;variable importance plot&quot;) +
    guides(fill = &quot;none&quot;) +
    ggsci::scale_fill_lancet() +
    theme_bw() +
    coord_flip() +
    theme(
      plot.title = element_text(size = 14, hjust = 0.5, face = &quot;bold&quot;),
      text = element_text(size = 10, hjust = 0.5),
      axis.title.y = element_text(face = &quot;bold&quot;, hjust = 0.5),
      axis.text.x = element_text(size = 8, hjust = 0.5, vjust = 0.5),
      axis.text.y = element_text(size = 8, hjust = 0.5, vjust = 0.5)
    )
}
ggplot_var(svm_model, 6)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-23-1.png" width="672" style="display: block; margin: auto;" />
<p>排名前六的变量分别是<code>im</code>、<code>pa</code>、<code>aridity</code>、<code>ndvi20162</code>、<code>ndvi20163</code>、<code>ndvi20163</code></p>
<ul>
<li>partial dependence plots</li>
</ul>
<blockquote>
<p>[!info]<br>
二维图形</p>
</blockquote>
<pre><code class="language-r"># 定义函数绘制pdp
# 参数分别是模型、前X重要变量以为绘图时图片排列列数
pdp_2d_one_predictor &lt;- function(model, num, ncol) {
  # 定义函数提取前若干重要变量
  names_var &lt;- function(model, num) {
    des_var &lt;- caret::varImp(model) %&gt;%
      .$importance %&gt;%
      dplyr::select(last_col()) %&gt;%
      rownames_to_column(&quot;variables&quot;) %&gt;%
      setNames(c(&quot;variables&quot;, &quot;importance&quot;)) %&gt;%
      arrange(desc(importance)) %&gt;%
      rowid_to_column(&quot;rowid&quot;) %&gt;%
      head(num) %&gt;%
      pull(variables)
    return(des_var)
  }

  # 重要变量名称
  single_var &lt;- names_var(model, num)

  # p &lt;- list()
  # for (i in single_var) {
  #   temp_var &lt;- i
  #   p[[i]] &lt;- model %&gt;%
  #     partial(pred.var = temp_var,parallel = T) %&gt;%
  #     autoplot(smooth = TRUE, ylab = paste0(&quot;f(&quot;,temp_var,&quot;)&quot;)) +
  #     theme_bw()+
  #     scale_x_continuous(n.breaks = 8)+
  #     theme(plot.title = element_text(size = 14,hjust = 0.5, face = &quot;bold&quot;),
  #           text = element_text(size = 10,hjust = 0.5),
  #           axis.title.y = element_text(face = &quot;bold&quot;,hjust = 0.5),
  #           axis.title.x = element_text(face = &quot;bold&quot;,hjust = 0.5,vjust = 0.5))
  # }
  # do.call(grid.arrange, c(p, ncol = ncol))

  # 定义pdp函数以搭配绘图
  my_partial &lt;- function(value, model) {
    model %&gt;%
      partial(pred.var = value, parallel = T) %&gt;%
      autoplot(smooth = TRUE, ylab = paste0(&quot;f(&quot;, value, &quot;)&quot;)) +
      theme_bw() +
      scale_x_continuous(n.breaks = 8) +
      theme(
        plot.title = element_text(size = 14, hjust = 0.5, face = &quot;bold&quot;),
        text = element_text(size = 10, hjust = 0.5),
        axis.title.y = element_text(face = &quot;bold&quot;, hjust = 0.5),
        axis.title.x = element_text(face = &quot;bold&quot;, hjust = 0.5, vjust = 0.5)
      )
  }

  # 执行pdp绘图函数
  pdp_data &lt;- single_var %&gt;%
    as_tibble() %&gt;%
    mutate(model = list(model)) %&gt;%
    group_by(value) %&gt;%
    mutate(plot = map2(value, model, my_partial))

  # 组合图形
  do.call(grid.arrange, c(pdp_data$plot, ncol = ncol))
}
pdp_2d_one_predictor(model = svm_model, num = 6, ncol = 2)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-24-1.png" width="672" style="display: block; margin: auto;" />
<blockquote>
<p>In the above plot, please do not get confused with Y-axis. It does not show the predicted value instead how the value is changing with the change in the given predictor variable in our case Petal.Width in first plot.</p>
</blockquote>
<blockquote>
<p>In the plot if there are more variation for any given predictor variable that means the value of that variable affects the model quite alot but if the line is constant near zero it shows that variable has no affect on the model.</p>
</blockquote>
<blockquote>
<p>Single variables shows how there value affect the model, on y-axis having a negative value means for that particular value of predictor variable it is less likely to predict the correct class on that observation and having a positive value means it has positive impact on predicting the correct class. Same applies to two variable plots, color represent the intensity of affect on model.</p>
</blockquote>
<blockquote>
<p>[!info]<br>
联合变量二维平面图形</p>
</blockquote>
<p>这里最开始是准备用<code>foreach</code>包并行计算的，但是其实数据量不大，所以并行计算多个模型即可，因为我们选择的是前六个重要的变量，组合起来是15个，所以并行计算输出<code>pdp</code>还是很有必要的！这里主要采用的是<s>lapply</s>purrr::map2，因为后者和ggplot2结合起来真的很方便！</p>
<pre><code class="language-r">pdp_2d_two_predictor &lt;- function(model, num, ncol) {
  # 定义函数提取前若干重要变量
  names_var &lt;- function(model, num) {
    des_var &lt;- caret::varImp(model) %&gt;%
      .$importance %&gt;%
      dplyr::select(last_col()) %&gt;%
      rownames_to_column(&quot;variables&quot;) %&gt;%
      setNames(c(&quot;variables&quot;, &quot;importance&quot;)) %&gt;%
      arrange(desc(importance)) %&gt;%
      rowid_to_column(&quot;rowid&quot;) %&gt;%
      head(num) %&gt;%
      pull(variables)
    return(des_var)
  }

  # 所有排列组合情况
  comb_var &lt;- names_var(model, num = num) %&gt;%
    combn(., 2)

  # 开启多线程
  # library(parallel)
  # no_cores &lt;- detectCores() - 1
  # library(foreach)
  # library(doParallel)
  # cl &lt;- makeCluster(no_cores)
  # registerDoParallel(cl)

  # 绘图
  # p &lt;- list()
  # for (i in 1:ncol(comb_var)) {
  #   temp_var &lt;- comb_var[,i]
  #   p[[i]] &lt;- model %&gt;%
  #     partial(pred.var = temp_var,
  #             parallel = T,
  #             chull = TRUE,
  #             contour = TRUE,
  #             contour.color = &quot;red&quot;) %&gt;%
  #     autoplot(smooth = TRUE) +
  #     theme_light() +
  #     scale_x_continuous(n.breaks = 5)+
  #     theme(plot.title = element_text(size = 14,hjust = 0.5, face = &quot;bold&quot;),
  #           text = element_text(size = 8,hjust = 0.5),
  #           axis.title.y = element_text(face = &quot;bold&quot;,hjust = 0.5),
  #           axis.title.x = element_text(face = &quot;bold&quot;,hjust = 0.5,vjust = 0.5),
  #           legend.position = &quot;none&quot;)
  # }

  # 关闭多线程
  # stopCluster(cl)

  # 组合图形
  # do.call(grid.arrange,c(p, ncol = ncol))

  # 组合情况转为数据框
  comb_df &lt;- comb_var %&gt;%
    t() %&gt;%
    as_tibble()

  # 针对map2函数设计pdp函数
  my_partial &lt;- function(V1, V2) {
    model %&gt;%
      partial(
        pred.var = c(V1, V2),
        parallel = T,
        chull = TRUE,
        contour = TRUE,
        contour.color = &quot;red&quot;
      ) %&gt;%
      autoplot(smooth = TRUE) +
      theme_light() +
      scale_x_continuous(n.breaks = 5) +
      theme(
        plot.title = element_text(size = 14, hjust = 0.5, face = &quot;bold&quot;),
        text = element_text(size = 8, hjust = 0.5),
        axis.title.y = element_text(face = &quot;bold&quot;, hjust = 0.5),
        axis.title.x = element_text(face = &quot;bold&quot;, hjust = 0.5, vjust = 0.5),
        legend.position = &quot;none&quot;
      )
  }

  # 执行pdp计算
  pdp_data &lt;- comb_df %&gt;%
    group_by(V1, V2) %&gt;%
    mutate(plot = map2(V1, V2, my_partial))

  # 组合图形
  do.call(grid.arrange, c(pdp_data$plot, ncol = ncol))
}

# 清除所有多线程任务
# unregister_dopar &lt;- function() {
#   env &lt;- foreach:::.foreachGlobals
#   rm(list=ls(name=env), pos=env)
# }

# pdp_2d_two_predictor(model = svm_model,num = 6,ncol = 3)
</code></pre>
<p>颜色越浅，数值越大。</p>
<blockquote>
<p>[!info]<br>
联合变量三维立体图形</p>
</blockquote>
<p>由于三维立体图形无法使用静态图呈现，若全部使用<code>rgl</code>呈现则占用过多篇幅因此仅仅选择性展示<code>im</code>以及<code>ndvi20162</code>，因为这两个变量的<em>预测概率</em>分布范围更广，信息量大。</p>
<pre><code class="language-r"># 定义函数提取前若干重要变量
# names_var &lt;- function(model,num){
#   des_var &lt;- caret::varImp(model) %&gt;%
#     .$importance %&gt;%
#     rownames_to_column(&quot;variables&quot;) %&gt;%
#     dplyr::select(variables,importance = X1) %&gt;%
#     setNames(c(&quot;variables&quot;,&quot;importance&quot;)) %&gt;%
#     arrange(desc(importance)) %&gt;%
#     rowid_to_column(&quot;rowid&quot;) %&gt;%
#     head(num) %&gt;%
#     pull(variables)
#   return(des_var)
# }
#
# # 所有排列组合情况
# comb_var &lt;- names_var(svm_model,num = 6) %&gt;%
#   combn(., 2)
# temp_var &lt;- comb_var[,3]
#
# gg_3D &lt;- svm_model %&gt;%
#   partial(pred.var = temp_var,
#           # parallel = T,
#           chull = TRUE,
#           contour = TRUE,
#           contour.color = &quot;red&quot;) %&gt;%
#   autoplot(smooth = TRUE) +
#   theme_light() +
#   scale_x_continuous(n.breaks = 5)+
#   theme(plot.title = element_text(size = 14,hjust = 0.5, face = &quot;bold&quot;),
#         text = element_text(size = 12,hjust = 0.5),
#         axis.title.y = element_text(face = &quot;bold&quot;,hjust = 0.5),
#         axis.title.x = element_text(face = &quot;bold&quot;,hjust = 0.5,vjust = 0.5))
</code></pre>
<ul>
<li>静态图</li>
</ul>
<pre><code class="language-r"># par(mfrow = c(1, 2))
# plot_gg(gg_3D, width = 5, height = 4, scale = 300, raytrace = FALSE, preview = TRUE)
# plot_gg(gg_3D, width = 5, height = 4, scale = 300, multicore = TRUE, windowsize = c(1000, 800))
# render_camera(fov = 70, zoom = 0.5, theta = 130, phi = 35)
# Sys.sleep(2)
# render_snapshot(clear = TRUE)
</code></pre>
<ul>
<li>动态图</li>
</ul>
<pre><code class="language-r"># plot_gg(gg_3D, width = 5, height = 4, scale = 300, multicore = TRUE, windowsize = c(1000, 800))
</code></pre>
<ul>
<li>预测测试集</li>
</ul>
<p><em>caret</em>的指标合集函数<code>metric_set</code>存在问题，只好中途跳出来再进去</p>
<pre><code class="language-r">metrics_set &lt;- function(data) {
  metric_row_df &lt;- data %&gt;%
    summarise(
      acc = accuracy_vec(obs, pred),
      kap = kap_vec(obs, pred),
      ppv = ppv_vec(obs, pred),
      precision = precision_vec(obs, pred),
      recall = recall_vec(obs, pred),
      f_meas = f_meas_vec(obs, pred),
      sensitivity = sensitivity_vec(obs, pred),
      detection_prevalence = detection_prevalence_vec(obs, pred),
      j_index = j_index_vec(obs, pred),
      npv = npv_vec(obs, pred),
      specificity = specificity_vec(obs, pred),
      roc = roc_auc_vec(obs, X0),
      mn_log_loss = mn_log_loss_vec(obs, X0),
      pr_auc = pr_auc_vec(obs, X0)
    ) %&gt;%
    mutate(tss = specificity + sensitivity - 1)

  metric_col_df &lt;- metric_row_df %&gt;%
    t() %&gt;%
    as.data.frame() %&gt;%
    rownames_to_column(&quot;metric&quot;) %&gt;%
    setNames(c(&quot;metric&quot;, &quot;value&quot;))

  return(metric_col_df)
}
</code></pre>
<blockquote>
<p>[!info]<br>
使用一套预测指标对模型在测试集上的表现进行评估，其中有的是针对二分类预测结果，有的是针对概率预测结果，有的指标是越大越好，有的反之，具体如上表所示。</p>
</blockquote>
<pre><code class="language-r">extractProb(list(svm_model), testX = test) %&gt;%
  metrics_set(data = .) %&gt;%
  kable(&quot;html&quot;, align = &quot;cr&quot;, escape = FALSE) %&gt;%
  kable_styling() %&gt;%
  kableExtra::kable_classic()
</code></pre>
<table class="table lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> metric </th>
   <th style="text-align:right;"> value </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> acc </td>
   <td style="text-align:right;"> 0.9410898 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> kap </td>
   <td style="text-align:right;"> 0.5293547 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ppv </td>
   <td style="text-align:right;"> 0.9417178 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> precision </td>
   <td style="text-align:right;"> 0.9417178 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> recall </td>
   <td style="text-align:right;"> 0.9967532 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> f_meas </td>
   <td style="text-align:right;"> 0.9684543 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> sensitivity </td>
   <td style="text-align:right;"> 0.9967532 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> detection_prevalence </td>
   <td style="text-align:right;"> 0.9602356 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> j_index </td>
   <td style="text-align:right;"> 0.3935786 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> npv </td>
   <td style="text-align:right;"> 0.9259259 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> specificity </td>
   <td style="text-align:right;"> 0.3968254 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> roc </td>
   <td style="text-align:right;"> 0.9913162 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> mn_log_loss </td>
   <td style="text-align:right;"> 0.1459309 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> pr_auc </td>
   <td style="text-align:right;"> 0.9991377 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> tss </td>
   <td style="text-align:right;"> 0.3935786 </td>
  </tr>
</tbody>
</table>
<ul>
<li>预测上海市</li>
</ul>
<pre><code class="language-r"># 速度确实快但是少了很多样本
# extractProb(list(svm_model), testX = env_df)
# extractProb(list(svm_model), testX = env_df)
</code></pre>
<p>这个地方存疑</p>
<pre><code class="language-r"># svm_pred_bin &lt;- predict(svm_model, newdata = env_df,type = &quot;prob&quot;)
#
# svm_pred_prob &lt;- predict(svm_model, newdata = env_df,type = &quot;raw&quot;)
#
# svm_pred_df &lt;- env_df %&gt;%
#   na.omit() %&gt;%
#   bind_cols(svm_pred_bin) %&gt;%
#   bind_cols(tibble(pred = svm_pred_prob))

# 定义函数整合输出概率值与分类值
pred_df &lt;- function(model) {
  env_df %&gt;%
    na.omit() %&gt;%
    bind_cols(model %&gt;%
      predict(
        object = .,
        newdata = env_df,
        type = &quot;prob&quot;
      )) %&gt;%
    bind_cols(tibble(pred = model %&gt;%
      predict(
        object = .,
        newdata = env_df,
        type = &quot;raw&quot;
      )))
}

# 定义函数以整合输出多个栅格数据
pred_layer &lt;- function(pred_df_res, model, model.name) {
  # 添加多步判断语句-----主要为后续建模预测结果整合的傻瓜化输出考虑
  if (length(colnames(pred_df_res)) &gt;= 5) {
    print(&quot;数据中变量个数符合要求&quot;)
  } else {
    stop(&quot;数据中变量个数不符合要求&quot;)
  }

  if (length(as.character.factor(unique(pred_df_res$pred))) == 2) {
    print(&quot;数据中分类变量是二值型&quot;)
  } else {
    stop(&quot;数据中分类变量不是二值型&quot;)
  }

  if (length(unique(pred_df_res$pred)) == 2) {
    print(&quot;数据中二分类变量种类符合要求&quot;)
  } else {
    stop(&quot;数据中二分类变量种类符合要求&quot;)
  }

  if (min(pred_df_res$X1) &gt;= 0 &amp; max(pred_df_res$X1) &lt;= 1) {
    print(&quot;数据中预测概率值变量范围符合要求&quot;)
  } else {
    stop(&quot;数据中预测概率值变量范围不符合要求&quot;)
  }

  if (is.character(model.name)) {
    print(&quot;模型名称符合要求&quot;)
  } else {
    stop(&quot;你需要提供一个字符串作为栅格数据图层名称！&quot;)
  }


  # 二分类数据转换
  temp_pred_bin_layer &lt;-
    pred_df_res %&gt;%
    dplyr::select(x, y, z = pred) %&gt;%
    # 从原来因子型转换为数值型
    mutate(z = ifelse(z == &quot;X0&quot;, 0, 1)) %&gt;%
    data.matrix() %&gt;%
    rasterFromXYZ()

  # 重命名
  names(temp_pred_bin_layer) &lt;- paste0(model.name, &quot;_bin&quot;)

  # 指定crs
  crs(temp_pred_bin_layer) &lt;- &quot;+proj=longlat +datum=WGS84 +no_defs +type=crs&quot;

  if (dir.exists(&quot;./data/pred/caret&quot;)) {
    print(&quot;Path `./data/pred/caret` already exist!&quot;)
  } else {
    dir.create(&quot;./data/pred/caret&quot;)
    print(&quot;Path `./data/pred/caret` newly create!&quot;)
  }

  # 保存图层
  temp_pred_bin_layer %&gt;%
    writeRaster(paste0(&quot;./data/pred/caret/&quot;, names(temp_pred_bin_layer), &quot;.tif&quot;),
      overwrite = TRUE
    )

  # 概率值数据转换
  temp_pred_prob_layer &lt;-
    pred_df_res %&gt;%
    dplyr::select(x, y, z = X1) %&gt;%
    data.matrix() %&gt;%
    rasterFromXYZ()

  # 重命名
  names(temp_pred_prob_layer) &lt;- paste0(model.name, &quot;_prob&quot;)

  # 指定crs
  crs(temp_pred_prob_layer) &lt;- &quot;+proj=longlat +datum=WGS84 +no_defs +type=crs&quot;

  # 保存图层
  temp_pred_prob_layer %&gt;%
    writeRaster(paste0(&quot;./data/pred/caret/&quot;, names(temp_pred_prob_layer), &quot;.tif&quot;),
      overwrite = TRUE
    )

  # 叠加数据并且输出
  res &lt;- temp_pred_bin_layer %&gt;%
    stack(temp_pred_prob_layer)
  return(res)
}

sh_pred_layer &lt;- pred_df(model = svm_model) %&gt;%
  pred_layer(
    pred_df_res = .,
    model = svm_model,
    model.name = &quot;svm&quot;
  )
</code></pre>
<pre><code>#&gt; [1] &quot;数据中变量个数符合要求&quot;
#&gt; [1] &quot;数据中分类变量是二值型&quot;
#&gt; [1] &quot;数据中二分类变量种类符合要求&quot;
#&gt; [1] &quot;数据中预测概率值变量范围符合要求&quot;
#&gt; [1] &quot;模型名称符合要求&quot;
#&gt; [1] &quot;Path `./data/pred/caret` already exist!&quot;
</code></pre>
<pre><code class="language-r">sh_pred_layer
</code></pre>
<pre><code>#&gt; class      : RasterStack 
#&gt; dimensions : 1362, 1260, 1716120, 2  (nrow, ncol, ncell, nlayers)
#&gt; resolution : 0.0008333333, 0.0008333333  (x, y)
#&gt; extent     : 120.8529, 121.9029, 30.70042, 31.83542  (xmin, xmax, ymin, ymax)
#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs 
#&gt; names      :     svm_bin,    svm_prob 
#&gt; min values : 0.000000000, 0.001465402 
#&gt; max values :   1.0000000,   0.9400695
</code></pre>
<p>结果是符合我们要求的</p>
<ul>
<li>上海市结果可视化</li>
</ul>
<p>主要使用<code>tmap</code>、<code>plotly</code>、<s><code>ggplot2</code></s>(速度太慢)等扩展包展示</p>
<pre><code class="language-r"># 定义函数分开展示二分类和概率值两个栅格图层
sh_tmap &lt;- function(data) {
  # 前期全部是二分类基础上叠加的概率值栅格数据
  names(data) &lt;- c(&quot;binary&quot;, &quot;probility&quot;)
  temp_layer &lt;- subset(data, 2)

  sh_county_sf &lt;- mapchina::china %&gt;%
    dplyr::filter(Name_Province == &quot;上海市&quot;)

  t2 &lt;- tm_shape(sh_county_sf) +
    tm_borders(&quot;black&quot;, alpha = .5) +
    tm_shape(temp_layer) +
    tm_raster(
      breaks = c(0, .33, .66, .9, 1),
      # 给定空字符串以设置为无
      # title = &quot;适宜度 \n Habitat \n suitability&quot;,
      title = &quot;&quot;,
      # labels = c(&quot;Lost&quot;, &quot;Pres&quot;, &quot;Abs&quot;,&quot;Gain&quot;),
      palette = c(&quot;#FFFFFF&quot;, &quot;#A6D186&quot;, &quot;#F2AB71&quot;, &quot;#B71D20&quot;)
    ) +
    tm_facets(free.scales = FALSE, nrow = 1) +
    tm_shape(sh_county_sf) +
    tm_borders(&quot;black&quot;, alpha = .5) +
    # tm_style(style = &quot;classic&quot;) +
    # 添加图例
    tm_legend(legend.position = c(&quot;left&quot;, &quot;top&quot;), outside = FALSE) +
    # 添加比例尺
    tm_scale_bar(position = c(&quot;left&quot;, &quot;bottom&quot;), text.size = 0.7) +
    # 添加指南针
    tm_compass(
      position = c(&quot;right&quot;, &quot;bottom&quot;), size = 2.5,
      type = &quot;rose&quot;
    ) +
    # 静态图形式
    tmap_mode(mode = &quot;plot&quot;) +
    # 设定图片边界
    tm_layout(
      title = &quot;&quot;,
      title.fontfamily = &quot;RMN&quot;,
      legend.title.fontfamily = &quot;RMN&quot;,
      legend.text.fontfamily = &quot;RMN&quot;,
      bg.color = &quot;white&quot;,
      title.size = 1,
      legend.title.size = 1.5,
      legend.text.size = 1.2,
      legend.width = 0.3,
      title.fontface = &quot;bold&quot;,
      # legend.title.fontface = &quot;italic&quot;,
      title.position = c(&quot;center&quot;, &quot;top&quot;),
      inner.margins = c(.02, .15, .06, .15),
      panel.labels = names(temp_layer),
      panel.label.size = 1.5,
      panel.label.fontfamily = &quot;RMN&quot;
    )

  temp_layer &lt;- subset(data, 1)

  t1 &lt;- tm_shape(sh_county_sf) +
    tm_borders(&quot;black&quot;, alpha = .5) +
    tm_shape(temp_layer) +
    tm_raster(
      breaks = c(0, 0.5, 1),
      # 给定空字符串以设置为无
      # title = &quot;适宜度 \n Habitat \n suitability&quot;,
      title = &quot;&quot;,
      labels = c(&quot;absence&quot;, &quot;presence&quot;),
      palette = c(&quot;#FFFFFF&quot;, &quot;#B71D20&quot;)
    ) +
    tm_facets(free.scales = FALSE, nrow = 1) +
    tm_shape(sh_county_sf) +
    tm_borders(&quot;black&quot;, alpha = .5) +
    # tm_style(style = &quot;classic&quot;) +
    # 添加图例
    tm_legend(legend.position = c(&quot;left&quot;, &quot;top&quot;), outside = FALSE) +
    # 添加比例尺
    tm_scale_bar(position = c(&quot;left&quot;, &quot;bottom&quot;), text.size = 0.7) +
    # 添加指南针
    tm_compass(
      position = c(&quot;right&quot;, &quot;bottom&quot;), size = 2.5,
      type = &quot;rose&quot;
    ) +
    # 静态图形式
    tmap_mode(mode = &quot;plot&quot;) +
    # 设定图片边界
    tm_layout(
      title = &quot;&quot;,
      title.fontfamily = &quot;RMN&quot;,
      legend.title.fontfamily = &quot;RMN&quot;,
      legend.text.fontfamily = &quot;RMN&quot;,
      bg.color = &quot;white&quot;,
      title.size = 1,
      legend.title.size = 1.5,
      legend.text.size = 1.2,
      legend.width = 0.3,
      title.fontface = &quot;bold&quot;,
      # legend.title.fontface = &quot;italic&quot;,
      title.position = c(&quot;center&quot;, &quot;top&quot;),
      inner.margins = c(.02, .15, .06, .15),
      panel.labels = names(temp_layer),
      panel.label.size = 1.5,
      panel.label.fontfamily = &quot;RMN&quot;
    )

  # 组合图形
  res &lt;- tmap::tmap_arrange(t1, t2)
  return(res)
}

sh_tmap(sh_pred_layer)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-33-1.png" width="672" style="display: block; margin: auto;" />
<ul>
<li>展示3D图尝试1</li>
</ul>
<p>花了一下午时间，真心累啊，<s>来不及发邮件了</s>，只想问问<code>plotly</code>开发团队，为什么<em>z</em>必须是个矩阵，太不人性！</p>
<pre><code class="language-r"># axi_lv &lt;- function(data,breaks){
#   # 判断数据类型
#   if (nlayers(data) == 1) {
#     print(&quot;数据格式符合要求&quot;)
#   }else{
#     stop(&quot;你需要提供栅格数据以进行下一步操作！&quot;)
#   }
#
#   # 转换为矩阵数据
#   temp_mat &lt;- data %&gt;%
#     as.data.frame(xy = T) %&gt;%
#     setNames(c(&quot;x&quot;,&quot;y&quot;,&quot;z&quot;)) %&gt;%
#     mutate(z = z*100) %&gt;%
#     pivot_wider(names_from = y,values_from = z) %&gt;%
#     as.matrix.data.frame()
#
#   # 切分坐标轴并且赋予标签
#
#   # 纬度范围
#   lat_range &lt;- raster::bbox(data)[2,]
#   # 感性理解----多少条纬线
#   x.value &lt;- seq(1,ncol(temp_mat),length.out = breaks)
#   # 标签个数
#   x.label &lt;- rev(seq(min(lat_range),max(lat_range),length.out = breaks)) %&gt;%
#     round(2) %&gt;%
#     paste0(.,&quot;\u00B0E&quot;)
#
#   # 经度范围
#   long_range &lt;- raster::bbox(data)[1,]
#   # 感性理解----多少条经线
#   y.value &lt;- seq(1,nrow(temp_mat),length.out = breaks)
#   # 标签个数
#   y.label &lt;- rev(seq(min(long_range),max(long_range),length.out = breaks)) %&gt;%
#     round(2) %&gt;%
#     paste0(.,&quot;\u00B0N&quot;)
#
#   return(list(mat.data = temp_mat,
#               x.value = x.value,
#               x.label = x.label,
#               y.value = y.value,
#               y.label = y.label))
# }
#
# plotly.detail &lt;- axi_lv(sh_pred_layer$svm_prob,5)
#
# plot_ly(z = ~plotly.detail$mat.data) %&gt;%
#   add_surface(contours = list(
#     z = list(
#       show=TRUE,
#       usecolormap=TRUE,
#       highlightcolor=&quot;#ff0000&quot;,
#       project=list(z=TRUE)
#       )
#     )) %&gt;%
#   layout(
#     title = &quot;3D map of snail infection risk in Shanghai&quot;,
#     scene = list(
#       xaxis = list(title = &quot;latitude&quot;,
#                    tickvals = plotly.detail$x.value,
#                    ticktext = plotly.detail$x.label),
#       yaxis = list(title = &quot;longitude&quot;,
#                    tickvals = plotly.detail$y.value,
#                    ticktext = plotly.detail$y.label),
#       zaxis = list(title = &quot;probability&quot;),
#       camera=list(
#         # eye = list(x=1.87, y=0.88, z=-0.64)
#         )
#     ))
</code></pre>
<p>经纬度看着还行，其实一点用没有，交互式展现的全是栅格数据转成矩阵时候，矩阵的行列数<s>属实有点尴尬</s></p>
<ul>
<li>展示3D图尝试2</li>
</ul>
<pre><code class="language-r"># cartomisc::gplot_data(sh_pred_layer$svm_prob) %&gt;%
#   dplyr::select(x,y,z = value) %&gt;%
#   mutate(probability = z) %&gt;%
#   plot_ly(
#     x = ~x,
#     y = ~y,
#     z = ~z,
#     size = ~z,
#     color = ~probability
#   ) %&gt;%
#   layout(
#     title = &quot;3D map of snail infection risk in Shanghai&quot;,
#     scene = list(
#       xaxis = list(title = &quot;longitude&quot;),
#       yaxis = list(title = &quot;latitude&quot;),
#       zaxis = list(title = &quot;probability&quot;),
#       # camera = list(eye = list(x = 0, y = -1, z = 0.5)),
#       aspectratio = list(x = 0.9, y = 0.8, z = 1)
#     ))
</code></pre>
<p>这图看起来虽然不是很平滑，但是起码还能结合经纬度理解理解，半斤八俩吧，这个是真<em>八俩</em><s>十六进制</s>十进制的八俩！</p>
<ul>
<li>展示3D图尝试3</li>
</ul>
<p>抓住<code>plotly</code>绘制<code>3D</code>图的核心思想是建立矩阵数据</p>
<pre><code class="language-r"># # 从小到大
# y &lt;- sh_pred_layer$svm_prob %&gt;%
#   as.data.frame(xy = T) %&gt;%
#   pull(x) %&gt;%
#   unique()
# # 从大到小
# x &lt;- sh_pred_layer$svm_prob %&gt;%
#   as.data.frame(xy = T) %&gt;%
#   pull(y) %&gt;%
#   unique()
# # 按照行顺序从左到右取值
# z &lt;- sh_pred_layer$svm_prob %&gt;%
#   getValues()
# dim(z) &lt;- c(length(y),length(x))
# probability &lt;- z
#
# # 元素凑齐
# plot_ly(
#   type = 'surface',
#   contours = list(
#     x = list(show = TRUE,
#              # start = 1.5,
#              # end = 2,
#              size = 0.04, color = 'white'),
#     z = list(show = TRUE,
#              # start = 0.5,
#              # end = 0.8,
#              size = 0.05,
#              show=TRUE,
#              usecolormap=TRUE,
#              highlightcolor=&quot;#ff0000&quot;,
#              project=list(z=TRUE))),
#   x = ~x,
#   y = ~y,
#   z = ~z,
#   color = ~probability) %&gt;%
#   layout(
#     title = &quot;3D map of snail infection risk in Shanghai&quot;,
#     scene = list(
#       xaxis = list(title = &quot;latitude&quot;,autorange = &quot;reversed&quot;),
#       yaxis = list(title = &quot;longitude&quot;),
#       zaxis = list(title = &quot;probability&quot;),
#       aspectratio = list(x = .9, y = .8, z = 0.8)
#       # camera=list(
#       #   # eye = list(x=1.87, y=0.88, z=-0.64)
#       #   )
#   ))

# 打包函数
sh_plotly &lt;- function(data, model.name) {
  # 判断数据类型
  if (nlayers(data) == 1) {
    print(&quot;数据格式符合要求&quot;)
  } else {
    stop(&quot;你需要提供栅格概率预测值数据以进行下一步操作！&quot;)
  }

  # 判断数据类型
  if (is.character(model.name)) {
    print(&quot;模型名称符合要求&quot;)
  } else {
    stop(&quot;你需要提供模型名称以搭配显示图表题！&quot;)
  }

  # 从小到大
  y &lt;- data %&gt;%
    as.data.frame(xy = T) %&gt;%
    pull(x) %&gt;%
    unique()
  # 从大到小
  x &lt;- data %&gt;%
    as.data.frame(xy = T) %&gt;%
    pull(y) %&gt;%
    unique()
  # 按照行顺序从左到右取值
  z &lt;- data %&gt;%
    getValues()
  dim(z) &lt;- c(length(y), length(x))
  probability &lt;- z

  # 元素凑齐
  plot_ly(
    type = &quot;surface&quot;,
    contours = list(
      x = list(
        show = TRUE,
        # start = 1.5,
        # end = 2,
        size = 0.04, color = &quot;white&quot;
      ),
      z = list(
        show = TRUE,
        # start = 0.5,
        # end = 0.8,
        size = 0.05,
        show = TRUE,
        usecolormap = TRUE,
        highlightcolor = &quot;#ff0000&quot;,
        project = list(z = TRUE)
      )
    ),
    x = ~x,
    y = ~y,
    z = ~z,
    color = ~probability
  ) %&gt;%
    layout(
      title = paste0(toupper(model.name), &quot;:3D map of snail infection risk in Shanghai&quot;),
      scene = list(
        xaxis = list(title = &quot;latitude&quot;, autorange = &quot;reversed&quot;),
        yaxis = list(title = &quot;longitude&quot;),
        zaxis = list(title = &quot;probability&quot;),
        aspectratio = list(x = .9, y = .8, z = 0.8)
        # camera=list(
        #   # eye = list(x=1.87, y=0.88, z=-0.64)
        #   )
      )
    )
}
# sh_plotly(data = sh_pred_layer$svm_prob,model.name = &quot;svm&quot;)
</code></pre>
<p>尝试十几次，尝试方向主要集中在调整<code>x</code>、<code>y</code>、<code>z</code>三个坐标轴的顺序(利用<code>rev</code>函数实现)，然后在<a href="whttps://stackoverflow.com/questions/40643288/how-to-reverse-axis-values-when-using-plotly">stackoverflow</a>检索到参数<code>autorange = &quot;reversed&quot;</code>，<s>耐心调试几次</s>竟然误打误撞实现了！</p>
<ul>
<li>展示3D图尝试4</li>
</ul>
<pre><code class="language-r">library(rayshader)
sh_rayshader &lt;- function(data) {
  
  ggvolcano &lt;- data %&gt;%
    as.data.frame(xy = T) %&gt;%
    setNames(c(&quot;x&quot;, &quot;y&quot;, &quot;value&quot;)) %&gt;%
    ggplot() +
    geom_tile(aes(x = x, y = y, fill = value)) +
    scale_x_continuous(&quot;longitude&quot;) +
    scale_y_continuous(&quot;latitude&quot;) +
    scale_fill_gradientn(&quot;probability&quot;, colours = terrain.colors(10)) +
    coord_fixed()

  plot_gg(ggvolcano,
    multicore = FALSE, raytrace = TRUE, width = 7, height = 4,
    scale = 300, windowsize = c(1400, 866), zoom = 0.6, phi = 30, theta = 30
  )
  
  Sys.sleep(0.2)

  render_snapshot(clear = TRUE)
}
sh_rayshader(data = sh_pred_layer$svm_prob)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-37-1.png" width="672" style="display: block; margin: auto;" />
<p>对比上述几张图，明显最后一张图效果最好，因此接下来的模型预测都是在此基础上用打包好的函数绘图。</p>
<h3 id="32-rf">3.2 RF</h3>
<ul>
<li>10折交叉验证，3次重复</li>
</ul>
<pre><code class="language-r"># library(doParallel)
# cores &lt;- makeCluster(detectCores() - 1)
# registerDoParallel(cores = cores)
# set.seed(1111)
</code></pre>
<p>Create control function for training with 10 folds and keep 3 folds for training. search method is grid.</p>
<pre><code class="language-r">control &lt;- trainControl(
  method = &quot;repeatedcv&quot;,
  number = 10,
  repeats = 3,
  search = &quot;grid&quot;,
  savePredictions = TRUE,
  classProbs = TRUE
)
</code></pre>
<p>Create tunegrid with 15 values from 1:15 for mtry to tunning model. Our train function will change number of entry variable at each split according to tunegrid.</p>
<pre><code class="language-r">tunegrid &lt;- expand.grid(.mtry = (1:15))

rf_model &lt;- train(class ~ .,
  data = train,
  method = &quot;rf&quot;,
  metric = &quot;Kappa&quot;,
  trControl = control,
  tuneGrid = tunegrid
)
rf_model
</code></pre>
<pre><code>#&gt; Random Forest 
#&gt; 
#&gt; 679 samples
#&gt;  18 predictor
#&gt;   2 classes: 'X0', 'X1' 
#&gt; 
#&gt; No pre-processing
#&gt; Resampling: Cross-Validated (10 fold, repeated 3 times) 
#&gt; Summary of sample sizes: 611, 612, 612, 610, 611, 610, ... 
#&gt; Resampling results across tuning parameters:
#&gt; 
#&gt;   mtry  Accuracy   Kappa    
#&gt;    1    0.9459998  0.5476275
#&gt;    2    0.9617099  0.7184138
#&gt;    3    0.9617243  0.7198776
#&gt;    4    0.9617243  0.7198776
#&gt;    5    0.9612268  0.7177455
#&gt;    6    0.9612341  0.7176376
#&gt;    7    0.9607437  0.7155695
#&gt;    8    0.9607366  0.7155055
#&gt;    9    0.9607437  0.7155695
#&gt;   10    0.9607366  0.7155055
#&gt;   11    0.9602535  0.7133294
#&gt;   12    0.9607366  0.7156187
#&gt;   13    0.9612268  0.7177455
#&gt;   14    0.9602535  0.7134426
#&gt;   15    0.9602464  0.7128200
#&gt; 
#&gt; Kappa was used to select the optimal model using the largest value.
#&gt; The final value used for the model was mtry = 3.
</code></pre>
<ul>
<li>输出<code>Kappa</code>达到最大的模型参数</li>
</ul>
<pre><code class="language-r">rf_model$bestTune %&gt;%
  kable()
</code></pre>
<table>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> mtry </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 3 </td>
  </tr>
</tbody>
</table>
<ul>
<li>输出模型评价指标</li>
</ul>
<blockquote>
<p>[!Info]
输出<code>acc</code>、<code>kappa</code>、<code>ROC</code>、<code>ppv</code>等指标</p>
</blockquote>
<pre><code class="language-r">metric_table(rf_model) %&gt;%
  beautify_metric_table(table = .)
</code></pre>
<table class="table table-striped table-hover lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;"> Resample </th>
   <th style="text-align:left;"> acc </th>
   <th style="text-align:left;"> kappa </th>
   <th style="text-align:left;"> ROC </th>
   <th style="text-align:left;"> ppv </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Fold01.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.55</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold02.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.48</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.84</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold03.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.96</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.65</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.87</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold04.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.8</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold05.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.98</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.98</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.98</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold06.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.56</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold07.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.52</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.96</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold08.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.78</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold09.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.98</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.88</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.99</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.98</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold10.Rep1 </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">1</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.99</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">1</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">1</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold01.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.98</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.89</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.99</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.98</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold02.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.77</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold03.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.74</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold04.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.96</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.65</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold05.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.64</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.88</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold06.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.41</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.83</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold07.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.98</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.86</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.99</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.98</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold08.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.96</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.7</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.98</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold09.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.78</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold10.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.96</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.73</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold01.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.64</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold02.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.78</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.99</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold03.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.64</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold04.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.56</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold05.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.46</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.88</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold06.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.82</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.99</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.98</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold07.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.98</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.89</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.98</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.98</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold08.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.76</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold09.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.76</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.89</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold10.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.62</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.85</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
</tbody>
</table>
<ul>
<li>混淆矩阵</li>
</ul>
<p>10折交叉验证并且重复三次的结果如下(因为是平均所以会有非整数)</p>
<pre><code class="language-r">confusionMatrix.train(rf_model)
</code></pre>
<pre><code>#&gt; Cross-Validated (10 fold, repeated 3 times) Confusion Matrix 
#&gt; 
#&gt; (entries are percentual average cell counts across resamples)
#&gt;  
#&gt;           Reference
#&gt; Prediction   X0   X1
#&gt;         X0 90.4  3.5
#&gt;         X1  0.3  5.8
#&gt;                             
#&gt;  Accuracy (average) : 0.9617
</code></pre>
<ul>
<li>最优参数预测的混淆矩阵.</li>
</ul>
<pre><code class="language-r">confusionMatrix(data = predict(rf_model, train), reference = train$class)
</code></pre>
<pre><code>#&gt; Confusion Matrix and Statistics
#&gt; 
#&gt;           Reference
#&gt; Prediction  X0  X1
#&gt;         X0 616   0
#&gt;         X1   0  63
#&gt;                                      
#&gt;                Accuracy : 1          
#&gt;                  95% CI : (0.9946, 1)
#&gt;     No Information Rate : 0.9072     
#&gt;     P-Value [Acc &gt; NIR] : &lt; 2.2e-16  
#&gt;                                      
#&gt;                   Kappa : 1          
#&gt;                                      
#&gt;  Mcnemar's Test P-Value : NA         
#&gt;                                      
#&gt;             Sensitivity : 1.0000     
#&gt;             Specificity : 1.0000     
#&gt;          Pos Pred Value : 1.0000     
#&gt;          Neg Pred Value : 1.0000     
#&gt;              Prevalence : 0.9072     
#&gt;          Detection Rate : 0.9072     
#&gt;    Detection Prevalence : 0.9072     
#&gt;       Balanced Accuracy : 1.0000     
#&gt;                                      
#&gt;        'Positive' Class : X0         
#&gt; 
</code></pre>
<ul>
<li>变量重要性</li>
</ul>
<p>这里按照降序排列前若干个重要变量</p>
<pre><code class="language-r">kable_var(rf_model, 6)
</code></pre>
<table class="table lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> variables </th>
   <th style="text-align:right;"> importance </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> dst_waterway </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">100</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> aridity </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">93.2916</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> im </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">83.3009</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> aat0 </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">79.9581</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> pa </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">79.8205</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20163 </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">77.8861</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20164 </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">74.636</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> night_time_lights </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">71.6369</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20161 </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">70.0404</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> landcover </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">69.8982</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20162 </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">66.4763</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> aat10 </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">61.5782</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> dem </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">58.5583</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> slope </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">58.0832</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> hfp </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">49.0281</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> hii </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">41.9919</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> tadem </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">11.879</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> landform </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0</span> </td>
  </tr>
</tbody>
</table>
<p>这里按照降序绘制前若干个重要变量</p>
<pre><code class="language-r">ggplot_var(rf_model, 6)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-46-1.png" width="672" style="display: block; margin: auto;" />
<p>排名前六的变量分别是<code>aridity</code>、<code>im</code>、<code>aat0</code>、<code>pa</code>、<code>slope</code>、<code>aat10</code></p>
<ul>
<li>partial dependence plots</li>
</ul>
<blockquote>
<p>[!Info]<br>
二维图形</p>
</blockquote>
<pre><code class="language-r">pdp_2d_one_predictor(model = rf_model, num = 6, ncol = 2)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-47-1.png" width="672" style="display: block; margin: auto;" />
<blockquote>
<p>[!Info]
联合变量二维平面图形</p>
</blockquote>
<pre><code class="language-r"># pdp_2d_two_predictor(model = rf_model,num = 6,ncol = 3)
</code></pre>
<p>颜色越浅，数值越大。</p>
<ul>
<li>预测测试集</li>
</ul>
<pre><code class="language-r">extractProb(list(rf_model), testX = test) %&gt;%
  metrics_set(data = .) %&gt;%
  kable(&quot;html&quot;, align = &quot;cr&quot;, escape = FALSE) %&gt;%
  kable_styling() %&gt;%
  kableExtra::kable_classic()
</code></pre>
<table class="table lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> metric </th>
   <th style="text-align:right;"> value </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> acc </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> kap </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ppv </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> precision </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> recall </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> f_meas </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> sensitivity </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> detection_prevalence </td>
   <td style="text-align:right;"> 0.9072165 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> j_index </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> npv </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> specificity </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> roc </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> mn_log_loss </td>
   <td style="text-align:right;"> 0.0381925 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> pr_auc </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> tss </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
</tbody>
</table>
<ul>
<li>预测上海市</li>
</ul>
<pre><code class="language-r">sh_pred_layer &lt;- pred_df(model = rf_model) %&gt;%
  pred_layer(
    pred_df = .,
    model = rf_model,
    model.name = &quot;rf&quot;
  )
</code></pre>
<pre><code>#&gt; [1] &quot;数据中变量个数符合要求&quot;
#&gt; [1] &quot;数据中分类变量是二值型&quot;
#&gt; [1] &quot;数据中二分类变量种类符合要求&quot;
#&gt; [1] &quot;数据中预测概率值变量范围符合要求&quot;
#&gt; [1] &quot;模型名称符合要求&quot;
#&gt; [1] &quot;Path `./data/pred/caret` already exist!&quot;
</code></pre>
<pre><code class="language-r">sh_pred_layer
</code></pre>
<pre><code>#&gt; class      : RasterStack 
#&gt; dimensions : 1362, 1260, 1716120, 2  (nrow, ncol, ncell, nlayers)
#&gt; resolution : 0.0008333333, 0.0008333333  (x, y)
#&gt; extent     : 120.8529, 121.9029, 30.70042, 31.83542  (xmin, xmax, ymin, ymax)
#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs 
#&gt; names      : rf_bin, rf_prob 
#&gt; min values :      0,       0 
#&gt; max values :      1,       1
</code></pre>
<p>结果是符合我们要求的</p>
<ul>
<li>上海市预测结果平面图</li>
</ul>
<pre><code class="language-r">sh_tmap(sh_pred_layer)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-51-1.png" width="672" style="display: block; margin: auto;" />
<ul>
<li>上海市预测结果立体图</li>
</ul>
<pre><code class="language-r">sh_rayshader(data = sh_pred_layer$rf_prob)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-52-1.png" width="672" style="display: block; margin: auto;" />
<h3 id="33-gbm">3.3 GBM</h3>
<ul>
<li>10折交叉验证，3次重复</li>
</ul>
<p>Create control function for training with 10 folds and keep 3 folds for training. search method is grid.</p>
<pre><code class="language-r">control &lt;- trainControl(
  method = &quot;repeatedcv&quot;,
  number = 10,
  repeats = 3,
  search = &quot;grid&quot;,
  savePredictions = TRUE,
  classProbs = TRUE
)
set.seed(1111)

grid &lt;- expand.grid(
  interaction.depth = c(1, 3, 5),
  n.trees = (0:50) * 50,
  shrinkage = c(0.01, 0.001),
  n.minobsinnode = 10
)

gbm_model &lt;- train(class ~ .,
  data = train,
  # distribution = &quot;binomial&quot;,
  # family = &quot;binomial&quot;,
  method = &quot;gbm&quot;,
  trControl = control,
  verbose = FALSE,
  tuneGrid = grid,
  metric = &quot;Kappa&quot;,
  bag.fraction = 0.75
)
gbm_model %&gt;% summary()
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-53-1.png" width="672" style="display: block; margin: auto;" />
<pre><code>#&gt;                                 var    rel.inf
#&gt; dst_waterway           dst_waterway 10.8259802
#&gt; aridity                     aridity 10.5151262
#&gt; aat0                           aat0  9.7345394
#&gt; night_time_lights night_time_lights  9.7020207
#&gt; ndvi20161                 ndvi20161  8.9196529
#&gt; ndvi20163                 ndvi20163  8.4420554
#&gt; landcover                 landcover  8.3841922
#&gt; ndvi20164                 ndvi20164  6.7412655
#&gt; ndvi20162                 ndvi20162  6.1849592
#&gt; im                               im  4.9251001
#&gt; slope                         slope  4.5079579
#&gt; dem                             dem  3.0033206
#&gt; hfp                             hfp  2.7068323
#&gt; aat10                         aat10  2.6919543
#&gt; hii                             hii  1.8049137
#&gt; pa                               pa  0.8351730
#&gt; tadem                         tadem  0.0749565
#&gt; landform                   landform  0.0000000
</code></pre>
<ul>
<li>输出<code>Kappa</code>达到最大的模型参数</li>
</ul>
<pre><code class="language-r">gbm_model$bestTune %&gt;%
  kable()
</code></pre>
<table>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> n.trees </th>
   <th style="text-align:right;"> interaction.depth </th>
   <th style="text-align:right;"> shrinkage </th>
   <th style="text-align:right;"> n.minobsinnode </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 251 </td>
   <td style="text-align:right;"> 2300 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 0.01 </td>
   <td style="text-align:right;"> 10 </td>
  </tr>
</tbody>
</table>
<ul>
<li>输出模型评价指标</li>
</ul>
<blockquote>
<p>[!Info]
输出<code>acc</code>、<code>kappa</code>、<code>ROC</code>、<code>ppv</code>等指标</p>
</blockquote>
<pre><code class="language-r">metric_table(gbm_model) %&gt;%
  beautify_metric_table(table = .)
</code></pre>
<table class="table table-striped table-hover lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;"> Resample </th>
   <th style="text-align:left;"> acc </th>
   <th style="text-align:left;"> kappa </th>
   <th style="text-align:left;"> ROC </th>
   <th style="text-align:left;"> ppv </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Fold01.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.3</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.84</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold02.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.41</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.78</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold03.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.43</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.83</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold04.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.4</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.87</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold05.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.27</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.82</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold06.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.36</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.87</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold07.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.3</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold08.Rep1 </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.95</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.62</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold09.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.19</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.74</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold10.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.3</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.85</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold01.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.31</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.88</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold02.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.08</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.68</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold03.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.37</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold04.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.48</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold05.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.38</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.84</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold06.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.34</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold07.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.28</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.84</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold08.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.24</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.88</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold09.Rep2 </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.95</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.57</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold10.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.31</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.79</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold01.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.22</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.82</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold02.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.41</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold03.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.26</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.85</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold04.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.33</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.85</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold05.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.38</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.83</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold06.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.47</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold07.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.46</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.96</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold08.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.48</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.82</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold09.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.36</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.83</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold10.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.43</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
</tbody>
</table>
<ul>
<li>混淆矩阵</li>
</ul>
<p>10折交叉验证并且重复三次的结果如下(因为是平均所以会有非整数)</p>
<pre><code class="language-r">confusionMatrix.train(gbm_model)
</code></pre>
<pre><code>#&gt; Cross-Validated (10 fold, repeated 3 times) Confusion Matrix 
#&gt; 
#&gt; (entries are percentual average cell counts across resamples)
#&gt;  
#&gt;           Reference
#&gt; Prediction   X0   X1
#&gt;         X0 89.9  3.5
#&gt;         X1  0.8  5.8
#&gt;                             
#&gt;  Accuracy (average) : 0.9573
</code></pre>
<ul>
<li>最优参数预测的混淆矩阵.</li>
</ul>
<pre><code class="language-r">confusionMatrix(data = predict(gbm_model, train), reference = train$class)
</code></pre>
<pre><code>#&gt; Confusion Matrix and Statistics
#&gt; 
#&gt;           Reference
#&gt; Prediction  X0  X1
#&gt;         X0 616   0
#&gt;         X1   0  63
#&gt;                                      
#&gt;                Accuracy : 1          
#&gt;                  95% CI : (0.9946, 1)
#&gt;     No Information Rate : 0.9072     
#&gt;     P-Value [Acc &gt; NIR] : &lt; 2.2e-16  
#&gt;                                      
#&gt;                   Kappa : 1          
#&gt;                                      
#&gt;  Mcnemar's Test P-Value : NA         
#&gt;                                      
#&gt;             Sensitivity : 1.0000     
#&gt;             Specificity : 1.0000     
#&gt;          Pos Pred Value : 1.0000     
#&gt;          Neg Pred Value : 1.0000     
#&gt;              Prevalence : 0.9072     
#&gt;          Detection Rate : 0.9072     
#&gt;    Detection Prevalence : 0.9072     
#&gt;       Balanced Accuracy : 1.0000     
#&gt;                                      
#&gt;        'Positive' Class : X0         
#&gt; 
</code></pre>
<ul>
<li>变量重要性</li>
</ul>
<p>这里按照降序排列前若干个重要变量</p>
<pre><code class="language-r">kable_var(gbm_model, 6)
</code></pre>
<table class="table lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> variables </th>
   <th style="text-align:right;"> importance </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> dst_waterway </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">100</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> aridity </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">97.1286</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> aat0 </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">89.9183</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> night_time_lights </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">89.6179</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20161 </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">82.3912</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20163 </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">77.9796</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> landcover </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">77.4451</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20164 </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">62.2693</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20162 </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">57.1307</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> im </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">45.4933</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> slope </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">41.6402</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> dem </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">27.7418</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> hfp </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">25.0031</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> aat10 </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">24.8657</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> hii </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">16.6721</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> pa </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">7.7145</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> tadem </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.6924</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> landform </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0</span> </td>
  </tr>
</tbody>
</table>
<p>这里按照降序绘制前若干个重要变量</p>
<pre><code class="language-r">ggplot_var(gbm_model, 6)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-59-1.png" width="672" style="display: block; margin: auto;" />
<p>排名前六的变量分别是<code>aridity</code>、<code>im</code>、<code>aat0</code>、<code>pa</code>、<code>slope</code>、<code>aat10</code></p>
<ul>
<li>partial dependence plots</li>
</ul>
<blockquote>
<p>[!Info]
二维图形</p>
</blockquote>
<pre><code class="language-r">pdp_2d_one_predictor(model = gbm_model, num = 6, ncol = 2)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-60-1.png" width="672" style="display: block; margin: auto;" />
<blockquote>
<p>[!Info]
联合变量二维平面图形</p>
</blockquote>
<pre><code class="language-r"># pdp_2d_two_predictor(model = gbm_model,num = 6,ncol = 3)
</code></pre>
<p>颜色越浅，数值越大。</p>
<ul>
<li>预测测试集</li>
</ul>
<pre><code class="language-r">extractProb(list(gbm_model), testX = test) %&gt;%
  metrics_set(data = .) %&gt;%
  kable(&quot;html&quot;, align = &quot;cr&quot;, escape = FALSE) %&gt;%
  kable_styling() %&gt;%
  kableExtra::kable_classic()
</code></pre>
<table class="table lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> metric </th>
   <th style="text-align:right;"> value </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> acc </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> kap </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ppv </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> precision </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> recall </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> f_meas </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> sensitivity </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> detection_prevalence </td>
   <td style="text-align:right;"> 0.9072165 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> j_index </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> npv </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> specificity </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> roc </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> mn_log_loss </td>
   <td style="text-align:right;"> 0.0209729 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> pr_auc </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> tss </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
</tbody>
</table>
<ul>
<li>预测上海市</li>
</ul>
<pre><code class="language-r">sh_pred_layer &lt;- pred_df(model = gbm_model) %&gt;%
  pred_layer(
    pred_df = .,
    model = gbm_model,
    model.name = &quot;gbm&quot;
  )
</code></pre>
<pre><code>#&gt; [1] &quot;数据中变量个数符合要求&quot;
#&gt; [1] &quot;数据中分类变量是二值型&quot;
#&gt; [1] &quot;数据中二分类变量种类符合要求&quot;
#&gt; [1] &quot;数据中预测概率值变量范围符合要求&quot;
#&gt; [1] &quot;模型名称符合要求&quot;
#&gt; [1] &quot;Path `./data/pred/caret` already exist!&quot;
</code></pre>
<pre><code class="language-r">sh_pred_layer
</code></pre>
<pre><code>#&gt; class      : RasterStack 
#&gt; dimensions : 1362, 1260, 1716120, 2  (nrow, ncol, ncell, nlayers)
#&gt; resolution : 0.0008333333, 0.0008333333  (x, y)
#&gt; extent     : 120.8529, 121.9029, 30.70042, 31.83542  (xmin, xmax, ymin, ymax)
#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs 
#&gt; names      :      gbm_bin,     gbm_prob 
#&gt; min values : 0.0000000000, 0.0001236891 
#&gt; max values :    1.0000000,    0.9941114
</code></pre>
<ul>
<li>上海市预测结果平面图</li>
</ul>
<pre><code class="language-r">sh_tmap(sh_pred_layer)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-64-1.png" width="672" style="display: block; margin: auto;" />
<ul>
<li>上海市预测结果立体图</li>
</ul>
<pre><code class="language-r">sh_rayshader(data = sh_pred_layer$gbm_prob)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-65-1.png" width="672" style="display: block; margin: auto;" />
<h3 id="34-glm">3.4 GLM</h3>
<p>使用<code>binomial</code>分布</p>
<ul>
<li>10折交叉验证，3次重复</li>
</ul>
<pre><code class="language-r">set.seed(1111)

glm_model &lt;- train(class ~ .,
  data = train,
  # family = &quot;binomial&quot;,
  method = &quot;glm&quot;,
  trControl = control,
  # verbose=FALSE,
  metric = &quot;Kappa&quot;
)
glm_model
</code></pre>
<pre><code>#&gt; Generalized Linear Model 
#&gt; 
#&gt; 679 samples
#&gt;  18 predictor
#&gt;   2 classes: 'X0', 'X1' 
#&gt; 
#&gt; No pre-processing
#&gt; Resampling: Cross-Validated (10 fold, repeated 3 times) 
#&gt; Summary of sample sizes: 612, 610, 611, 610, 612, 612, ... 
#&gt; Resampling results:
#&gt; 
#&gt;   Accuracy   Kappa    
#&gt;   0.9042425  0.1320241
</code></pre>
<ul>
<li>输出<code>Kappa</code>达到最大的模型参数</li>
</ul>
<pre><code class="language-r">glm_model$bestTune %&gt;%
  kable()
</code></pre>
<table>
 <thead>
  <tr>
   <th style="text-align:left;"> parameter </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> none </td>
  </tr>
</tbody>
</table>
<ul>
<li>输出模型评价指标</li>
</ul>
<blockquote>
<p>[!Info]
输出<code>acc</code>、<code>kappa</code>、<code>ROC</code>、<code>ppv</code>等指标</p>
</blockquote>
<pre><code class="language-r">metric_table(glm_model) %&gt;%
  beautify_metric_table(table = .)
</code></pre>
<table class="table table-striped table-hover lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;"> Resample </th>
   <th style="text-align:left;"> acc </th>
   <th style="text-align:left;"> kappa </th>
   <th style="text-align:left;"> ROC </th>
   <th style="text-align:left;"> ppv </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Fold01.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">-0.03</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.73</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold02.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.23</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.77</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold03.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.79</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold04.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.23</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.85</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold05.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.21</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.68</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold06.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.17</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.8</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold07.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.27</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.7</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold08.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.87</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.23</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.77</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold09.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">-0.03</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.88</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold10.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.82</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold01.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.74</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold02.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">-0.03</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.57</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold03.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.22</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold04.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.22</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.71</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold05.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.31</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.81</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold06.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.89</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold07.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.21</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.71</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold08.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.36</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.85</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold09.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.96</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold10.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.88</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">-0.05</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.71</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold01.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.19</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.72</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold02.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.27</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.87</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold03.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.17</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.82</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold04.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.7</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold05.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">-0.03</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.88</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold06.Rep3 </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.94</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.48</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.83</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold07.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.18</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold08.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">-0.03</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.68</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold09.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.73</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold10.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.19</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.88</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
  </tr>
</tbody>
</table>
<ul>
<li>混淆矩阵</li>
</ul>
<p>10折交叉验证并且重复三次的结果如下(因为是平均所以会有非整数)</p>
<pre><code class="language-r">confusionMatrix.train(glm_model)
</code></pre>
<pre><code>#&gt; Cross-Validated (10 fold, repeated 3 times) Confusion Matrix 
#&gt; 
#&gt; (entries are percentual average cell counts across resamples)
#&gt;  
#&gt;           Reference
#&gt; Prediction   X0   X1
#&gt;         X0 89.4  8.2
#&gt;         X1  1.3  1.0
#&gt;                             
#&gt;  Accuracy (average) : 0.9043
</code></pre>
<ul>
<li>最优参数预测的混淆矩阵.</li>
</ul>
<pre><code class="language-r">confusionMatrix(data = predict(glm_model, train), reference = train$class)
</code></pre>
<pre><code>#&gt; Confusion Matrix and Statistics
#&gt; 
#&gt;           Reference
#&gt; Prediction  X0  X1
#&gt;         X0 612  52
#&gt;         X1   4  11
#&gt;                                           
#&gt;                Accuracy : 0.9175          
#&gt;                  95% CI : (0.8942, 0.9371)
#&gt;     No Information Rate : 0.9072          
#&gt;     P-Value [Acc &gt; NIR] : 0.1962          
#&gt;                                           
#&gt;                   Kappa : 0.2555          
#&gt;                                           
#&gt;  Mcnemar's Test P-Value : 3.372e-10       
#&gt;                                           
#&gt;             Sensitivity : 0.9935          
#&gt;             Specificity : 0.1746          
#&gt;          Pos Pred Value : 0.9217          
#&gt;          Neg Pred Value : 0.7333          
#&gt;              Prevalence : 0.9072          
#&gt;          Detection Rate : 0.9013          
#&gt;    Detection Prevalence : 0.9779          
#&gt;       Balanced Accuracy : 0.5841          
#&gt;                                           
#&gt;        'Positive' Class : X0              
#&gt; 
</code></pre>
<ul>
<li>变量重要性</li>
</ul>
<p>这里按照降序排列前若干个重要变量</p>
<pre><code class="language-r">kable_var(glm_model, 6)
</code></pre>
<table class="table lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> variables </th>
   <th style="text-align:right;"> importance </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> dst_waterway </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">100</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> landcover </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">96.1853</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> night_time_lights </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">70.9954</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20161 </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">51.577</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> aridity </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">39.2679</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20162 </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">35.281</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20163 </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">28.9923</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> aat0 </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">28.6327</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> hfp </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">25.8778</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> hii </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">25.21</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> aat10 </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">25.0107</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> slope </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">22.79</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> pa </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">22.5894</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> dem </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">19.9966</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> im </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">11.0154</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> tadem </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">2.7875</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20164 </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">1.9526</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> landform </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0</span> </td>
  </tr>
</tbody>
</table>
<p>这里按照降序绘制前若干个重要变量</p>
<pre><code class="language-r">ggplot_var(glm_model, 6)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-72-1.png" width="672" style="display: block; margin: auto;" />
<p>排名前六的变量分别是<code>aridity</code>、<code>im</code>、<code>aat0</code>、<code>pa</code>、<code>slope</code>、<code>aat10</code></p>
<ul>
<li>partial dependence plots</li>
</ul>
<blockquote>
<p>[!Info]
二维图形</p>
</blockquote>
<pre><code class="language-r">pdp_2d_one_predictor(model = glm_model, num = 6, ncol = 2)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-73-1.png" width="672" style="display: block; margin: auto;" />
<blockquote>
<p>[!Info]
联合变量二维平面图形</p>
</blockquote>
<pre><code class="language-r"># pdp_2d_two_predictor(model = glm_model,num = 6,ncol = 3)
</code></pre>
<p>颜色越浅，数值越大。</p>
<ul>
<li>预测测试集</li>
</ul>
<pre><code class="language-r">extractProb(list(glm_model), testX = test) %&gt;%
  metrics_set(data = .) %&gt;%
  kable(&quot;html&quot;, align = &quot;cr&quot;, escape = FALSE) %&gt;%
  kable_styling() %&gt;%
  kableExtra::kable_classic()
</code></pre>
<table class="table lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> metric </th>
   <th style="text-align:right;"> value </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> acc </td>
   <td style="text-align:right;"> 0.9175258 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> kap </td>
   <td style="text-align:right;"> 0.2554825 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ppv </td>
   <td style="text-align:right;"> 0.9216867 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> precision </td>
   <td style="text-align:right;"> 0.9216867 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> recall </td>
   <td style="text-align:right;"> 0.9935065 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> f_meas </td>
   <td style="text-align:right;"> 0.9562500 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> sensitivity </td>
   <td style="text-align:right;"> 0.9935065 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> detection_prevalence </td>
   <td style="text-align:right;"> 0.9779087 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> j_index </td>
   <td style="text-align:right;"> 0.1681097 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> npv </td>
   <td style="text-align:right;"> 0.7333333 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> specificity </td>
   <td style="text-align:right;"> 0.1746032 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> roc </td>
   <td style="text-align:right;"> 0.8375850 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> mn_log_loss </td>
   <td style="text-align:right;"> 0.2366485 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> pr_auc </td>
   <td style="text-align:right;"> 0.9788400 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> tss </td>
   <td style="text-align:right;"> 0.1681097 </td>
  </tr>
</tbody>
</table>
<ul>
<li>预测上海市</li>
</ul>
<pre><code class="language-r">sh_pred_layer &lt;- pred_df(model = glm_model) %&gt;%
  pred_layer(
    pred_df = .,
    model = glm_model,
    model.name = &quot;glm&quot;
  )
</code></pre>
<pre><code>#&gt; [1] &quot;数据中变量个数符合要求&quot;
#&gt; [1] &quot;数据中分类变量是二值型&quot;
#&gt; [1] &quot;数据中二分类变量种类符合要求&quot;
#&gt; [1] &quot;数据中预测概率值变量范围符合要求&quot;
#&gt; [1] &quot;模型名称符合要求&quot;
#&gt; [1] &quot;Path `./data/pred/caret` already exist!&quot;
</code></pre>
<pre><code class="language-r">sh_pred_layer
</code></pre>
<pre><code>#&gt; class      : RasterStack 
#&gt; dimensions : 1362, 1260, 1716120, 2  (nrow, ncol, ncell, nlayers)
#&gt; resolution : 0.0008333333, 0.0008333333  (x, y)
#&gt; extent     : 120.8529, 121.9029, 30.70042, 31.83542  (xmin, xmax, ymin, ymax)
#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs 
#&gt; names      :      glm_bin,     glm_prob 
#&gt; min values : 0.000000e+00, 2.220446e-16 
#&gt; max values :    1.0000000,    0.9999996
</code></pre>
<ul>
<li>上海市预测结果平面图</li>
</ul>
<pre><code class="language-r">sh_tmap(sh_pred_layer)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-77-1.png" width="672" style="display: block; margin: auto;" />
<ul>
<li>上海市预测结果立体图</li>
</ul>
<pre><code class="language-r">sh_rayshader(data = sh_pred_layer$glm_prob)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-78-1.png" width="672" style="display: block; margin: auto;" />
<h3 id="35-nb">3.5 NB</h3>
<ul>
<li>10折交叉验证，3次重复</li>
</ul>
<pre><code class="language-r">set.seed(1111)

nb_model &lt;- train(class ~ .,
  data = train,
  # family = &quot;binomial&quot;,
  method = &quot;naive_bayes&quot;,
  trControl = control,
  # verbose=FALSE,
  metric = &quot;Kappa&quot;
)
nb_model
</code></pre>
<pre><code>#&gt; Naive Bayes 
#&gt; 
#&gt; 679 samples
#&gt;  18 predictor
#&gt;   2 classes: 'X0', 'X1' 
#&gt; 
#&gt; No pre-processing
#&gt; Resampling: Cross-Validated (10 fold, repeated 3 times) 
#&gt; Summary of sample sizes: 612, 610, 611, 610, 612, 612, ... 
#&gt; Resampling results across tuning parameters:
#&gt; 
#&gt;   usekernel  Accuracy   Kappa    
#&gt;   FALSE      0.4976028  0.1204987
#&gt;    TRUE      0.9018271  0.2988006
#&gt; 
#&gt; Tuning parameter 'laplace' was held constant at a value of 0
#&gt; Tuning
#&gt;  parameter 'adjust' was held constant at a value of 1
#&gt; Kappa was used to select the optimal model using the largest value.
#&gt; The final values used for the model were laplace = 0, usekernel = TRUE
#&gt;  and adjust = 1.
</code></pre>
<ul>
<li>输出<code>Kappa</code>达到最大的模型参数</li>
</ul>
<pre><code class="language-r">nb_model$bestTune %&gt;%
  kable()
</code></pre>
<table>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> laplace </th>
   <th style="text-align:left;"> usekernel </th>
   <th style="text-align:right;"> adjust </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> TRUE </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
</tbody>
</table>
<ul>
<li>输出模型评价指标</li>
</ul>
<blockquote>
<p>[!Info]
输出<code>acc</code>、<code>kappa</code>、<code>ROC</code>、<code>ppv</code>等指标</p>
</blockquote>
<pre><code class="language-r">metric_table(nb_model) %&gt;%
  beautify_metric_table(table = .)
</code></pre>
<table class="table table-striped table-hover lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;"> Resample </th>
   <th style="text-align:left;"> acc </th>
   <th style="text-align:left;"> kappa </th>
   <th style="text-align:left;"> ROC </th>
   <th style="text-align:left;"> ppv </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Fold01.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.68</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.12</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.74</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold02.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.67</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.17</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.69</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold03.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.73</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.16</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.74</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold04.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.72</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.14</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.74</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold05.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.69</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.16</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.75</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold06.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.7</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.22</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.81</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.98</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold07.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.7</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.14</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.73</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold08.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.72</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.24</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.77</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.98</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold09.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.68</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.09</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.73</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold10.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.73</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.18</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.79</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold01.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.71</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.13</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.77</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold02.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.69</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.07</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.71</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold03.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.73</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.22</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.81</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold04.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.72</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.09</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.7</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold05.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.67</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.17</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.71</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.96</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold06.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.73</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.21</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.79</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold07.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.7</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.14</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.78</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold08.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.7</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.17</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.75</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold09.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.69</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.16</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.78</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.96</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold10.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.66</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.13</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.74</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold01.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.72</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.19</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.78</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold02.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.71</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.14</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.78</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold03.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.69</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.13</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.77</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold04.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.7</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.11</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.71</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold05.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.72</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.18</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.74</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.96</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold06.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.71</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.2</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.83</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold07.Rep3 </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.74</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.25</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.79</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.96</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold08.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.63</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.11</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.7</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold09.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.63</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.12</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.71</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold10.Rep3 </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.74</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.22</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.83</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
</tbody>
</table>
<ul>
<li>混淆矩阵</li>
</ul>
<p>10折交叉验证并且重复三次的结果如下(因为是平均所以会有非整数)</p>
<pre><code class="language-r">confusionMatrix.train(nb_model)
</code></pre>
<pre><code>#&gt; Cross-Validated (10 fold, repeated 3 times) Confusion Matrix 
#&gt; 
#&gt; (entries are percentual average cell counts across resamples)
#&gt;  
#&gt;           Reference
#&gt; Prediction   X0   X1
#&gt;         X0 87.4  6.5
#&gt;         X1  3.3  2.8
#&gt;                             
#&gt;  Accuracy (average) : 0.9018
</code></pre>
<ul>
<li>最优参数预测的混淆矩阵.</li>
</ul>
<pre><code class="language-r">confusionMatrix(data = predict(nb_model, train), reference = train$class)
</code></pre>
<pre><code>#&gt; Confusion Matrix and Statistics
#&gt; 
#&gt;           Reference
#&gt; Prediction  X0  X1
#&gt;         X0 595  36
#&gt;         X1  21  27
#&gt;                                           
#&gt;                Accuracy : 0.9161          
#&gt;                  95% CI : (0.8926, 0.9358)
#&gt;     No Information Rate : 0.9072          
#&gt;     P-Value [Acc &gt; NIR] : 0.23605         
#&gt;                                           
#&gt;                   Kappa : 0.4417          
#&gt;                                           
#&gt;  Mcnemar's Test P-Value : 0.06369         
#&gt;                                           
#&gt;             Sensitivity : 0.9659          
#&gt;             Specificity : 0.4286          
#&gt;          Pos Pred Value : 0.9429          
#&gt;          Neg Pred Value : 0.5625          
#&gt;              Prevalence : 0.9072          
#&gt;          Detection Rate : 0.8763          
#&gt;    Detection Prevalence : 0.9293          
#&gt;       Balanced Accuracy : 0.6972          
#&gt;                                           
#&gt;        'Positive' Class : X0              
#&gt; 
</code></pre>
<ul>
<li>变量重要性</li>
</ul>
<p>这里按照降序排列前若干个重要变量</p>
<pre><code class="language-r">kable_var(nb_model, 6)
</code></pre>
<table class="table lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> variables </th>
   <th style="text-align:right;"> importance </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> ndvi20162 </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">100</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> night_time_lights </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">91.7989</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20164 </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">91.1196</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20161 </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">88.106</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20163 </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">75.298</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> aridity </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">72.3214</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> im </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">71.9014</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> pa </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">70.7898</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> dst_waterway </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">49.2126</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> hfp </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">35.5277</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> hii </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">27.3451</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> landcover </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">25.2393</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> dem </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">16.5071</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> slope </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">11.5544</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> tadem </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">8.1702</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> aat10 </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">5.7185</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> aat0 </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">1.2722</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> landform </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0</span> </td>
  </tr>
</tbody>
</table>
<p>这里按照降序绘制前若干个重要变量</p>
<pre><code class="language-r">ggplot_var(nb_model, 6)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-85-1.png" width="672" style="display: block; margin: auto;" />
<p>排名前六的变量分别是<code>aridity</code>、<code>im</code>、<code>aat0</code>、<code>pa</code>、<code>slope</code>、<code>aat10</code></p>
<ul>
<li>partial dependence plots</li>
</ul>
<blockquote>
<p>[!Info]
二维图形</p>
</blockquote>
<pre><code class="language-r">pdp_2d_one_predictor(model = nb_model, num = 6, ncol = 2)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-86-1.png" width="672" style="display: block; margin: auto;" />
<blockquote>
<p>[!Info]
联合变量二维平面图形</p>
</blockquote>
<pre><code class="language-r"># pdp_2d_two_predictor(model = nb_model,num = 6,ncol = 3)
</code></pre>
<p>颜色越浅，数值越大。</p>
<ul>
<li>预测测试集</li>
</ul>
<pre><code class="language-r">extractProb(list(nb_model), testX = test) %&gt;%
  metrics_set(data = .) %&gt;%
  kable(&quot;html&quot;, align = &quot;cr&quot;, escape = FALSE) %&gt;%
  kable_styling() %&gt;%
  kableExtra::kable_classic()
</code></pre>
<table class="table lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> metric </th>
   <th style="text-align:right;"> value </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> acc </td>
   <td style="text-align:right;"> 0.9160530 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> kap </td>
   <td style="text-align:right;"> 0.4416843 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ppv </td>
   <td style="text-align:right;"> 0.9429477 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> precision </td>
   <td style="text-align:right;"> 0.9429477 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> recall </td>
   <td style="text-align:right;"> 0.9659091 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> f_meas </td>
   <td style="text-align:right;"> 0.9542903 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> sensitivity </td>
   <td style="text-align:right;"> 0.9659091 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> detection_prevalence </td>
   <td style="text-align:right;"> 0.9293078 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> j_index </td>
   <td style="text-align:right;"> 0.3944805 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> npv </td>
   <td style="text-align:right;"> 0.5625000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> specificity </td>
   <td style="text-align:right;"> 0.4285714 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> roc </td>
   <td style="text-align:right;"> 0.9044269 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> mn_log_loss </td>
   <td style="text-align:right;"> 0.2267974 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> pr_auc </td>
   <td style="text-align:right;"> 0.9891453 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> tss </td>
   <td style="text-align:right;"> 0.3944805 </td>
  </tr>
</tbody>
</table>
<ul>
<li>预测上海市</li>
</ul>
<pre><code class="language-r">sh_pred_layer &lt;- pred_df(model = nb_model) %&gt;%
  pred_layer(
    pred_df = .,
    model = nb_model,
    model.name = &quot;nb&quot;
  )
</code></pre>
<pre><code>#&gt; [1] &quot;数据中变量个数符合要求&quot;
#&gt; [1] &quot;数据中分类变量是二值型&quot;
#&gt; [1] &quot;数据中二分类变量种类符合要求&quot;
#&gt; [1] &quot;数据中预测概率值变量范围符合要求&quot;
#&gt; [1] &quot;模型名称符合要求&quot;
#&gt; [1] &quot;Path `./data/pred/caret` already exist!&quot;
</code></pre>
<pre><code class="language-r">sh_pred_layer
</code></pre>
<pre><code>#&gt; class      : RasterStack 
#&gt; dimensions : 1362, 1260, 1716120, 2  (nrow, ncol, ncell, nlayers)
#&gt; resolution : 0.0008333333, 0.0008333333  (x, y)
#&gt; extent     : 120.8529, 121.9029, 30.70042, 31.83542  (xmin, xmax, ymin, ymax)
#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs 
#&gt; names      :       nb_bin,      nb_prob 
#&gt; min values : 0.000000e+00, 2.865966e-28 
#&gt; max values :            1,            1
</code></pre>
<ul>
<li>上海市预测结果平面图</li>
</ul>
<pre><code class="language-r">sh_tmap(sh_pred_layer)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-90-1.png" width="672" style="display: block; margin: auto;" />
<ul>
<li>上海市预测结果立体图</li>
</ul>
<pre><code class="language-r">sh_rayshader(data = sh_pred_layer$nb_prob)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-91-1.png" width="672" style="display: block; margin: auto;" />
<h3 id="36-knn">3.6 KNN</h3>
<ul>
<li>10折交叉验证，3次重复</li>
</ul>
<pre><code class="language-r">set.seed(1111)

knn_model &lt;- train(class ~ .,
  data = train,
  method = &quot;knn&quot;,
  trControl = control,
  metric = &quot;Kappa&quot;
)
knn_model
</code></pre>
<pre><code>#&gt; k-Nearest Neighbors 
#&gt; 
#&gt; 679 samples
#&gt;  18 predictor
#&gt;   2 classes: 'X0', 'X1' 
#&gt; 
#&gt; No pre-processing
#&gt; Resampling: Cross-Validated (10 fold, repeated 3 times) 
#&gt; Summary of sample sizes: 612, 610, 611, 610, 612, 612, ... 
#&gt; Resampling results across tuning parameters:
#&gt; 
#&gt;   k  Accuracy   Kappa    
#&gt;   5  0.8982511  0.4067235
#&gt;   7  0.8963551  0.3035209
#&gt;   9  0.8988351  0.2244468
#&gt; 
#&gt; Kappa was used to select the optimal model using the largest value.
#&gt; The final value used for the model was k = 5.
</code></pre>
<ul>
<li>输出<code>Kappa</code>达到最大的模型参数</li>
</ul>
<pre><code class="language-r">knn_model$bestTune %&gt;%
  kable()
</code></pre>
<table>
 <thead>
  <tr>
   <th style="text-align:right;"> k </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 5 </td>
  </tr>
</tbody>
</table>
<ul>
<li>输出模型评价指标</li>
</ul>
<blockquote>
<p>[!Info]
输出<code>acc</code>、<code>kappa</code>、<code>ROC</code>、<code>ppv</code>等指标</p>
</blockquote>
<pre><code class="language-r">metric_table(knn_model) %&gt;%
  beautify_metric_table(table = .)
</code></pre>
<table class="table table-striped table-hover lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;"> Resample </th>
   <th style="text-align:left;"> acc </th>
   <th style="text-align:left;"> kappa </th>
   <th style="text-align:left;"> ROC </th>
   <th style="text-align:left;"> ppv </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Fold01.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.39</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.82</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold02.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.43</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.72</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold03.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.55</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.86</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold04.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.44</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold05.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.83</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">-0.04</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.81</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold06.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.87</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.21</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.85</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold07.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.31</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.88</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold08.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.43</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold09.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.37</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.77</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold10.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.38</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.8</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold01.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.31</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold02.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.88</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">-0.05</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.74</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold03.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.86</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.1</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.84</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold04.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.88</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.27</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.87</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold05.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.48</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.88</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.96</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold06.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.89</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.21</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.79</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold07.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.85</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.08</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.77</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold08.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.33</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.87</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold09.Rep2 </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.96</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.77</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.98</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.98</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold10.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.41</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.82</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold01.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.87</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.02</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.72</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold02.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.54</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.85</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.96</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold03.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.24</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.84</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold04.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.88</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.23</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.79</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold05.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.27</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold06.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.45</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.96</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold07.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.5</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold08.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.89</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.35</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.81</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold09.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.39</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.82</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold10.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.31</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
</tbody>
</table>
<ul>
<li>混淆矩阵</li>
</ul>
<p>10折交叉验证并且重复三次的结果如下(因为是平均所以会有非整数)</p>
<pre><code class="language-r">confusionMatrix.train(knn_model)
</code></pre>
<pre><code>#&gt; Cross-Validated (10 fold, repeated 3 times) Confusion Matrix 
#&gt; 
#&gt; (entries are percentual average cell counts across resamples)
#&gt;  
#&gt;           Reference
#&gt; Prediction   X0   X1
#&gt;         X0 85.3  4.8
#&gt;         X1  5.4  4.5
#&gt;                             
#&gt;  Accuracy (average) : 0.8984
</code></pre>
<ul>
<li>最优参数预测的混淆矩阵.</li>
</ul>
<pre><code class="language-r"># confusionMatrix(data = predict(knn_model,train),reference = train$class)
</code></pre>
<ul>
<li>变量重要性</li>
</ul>
<p>这里按照降序排列前若干个重要变量</p>
<pre><code class="language-r">kable_var(knn_model, 6)
</code></pre>
<table class="table lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> variables </th>
   <th style="text-align:right;"> importance </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> ndvi20162 </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">100</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> night_time_lights </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">91.7989</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20164 </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">91.1196</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20161 </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">88.106</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20163 </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">75.298</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> aridity </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">72.3214</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> im </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">71.9014</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> pa </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">70.7898</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> dst_waterway </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">49.2126</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> hfp </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">35.5277</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> hii </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">27.3451</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> landcover </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">25.2393</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> dem </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">16.5071</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> slope </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">11.5544</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> tadem </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">8.1702</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> aat10 </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">5.7185</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> aat0 </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">1.2722</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> landform </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0</span> </td>
  </tr>
</tbody>
</table>
<p>这里按照降序绘制前若干个重要变量</p>
<pre><code class="language-r">ggplot_var(knn_model, 6)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-98-1.png" width="672" style="display: block; margin: auto;" />
<p>排名前六的变量分别是<code>im</code>、<code>pa</code>、<code>aridity</code>、<code>ndvi20162</code>、<code>ndvi20163</code>、<code>ndvi20164</code></p>
<ul>
<li>partial dependence plots</li>
</ul>
<blockquote>
<p>[!Info]
二维图形</p>
</blockquote>
<pre><code class="language-r">pdp_2d_one_predictor(model = knn_model, num = 6, ncol = 2)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-99-1.png" width="672" style="display: block; margin: auto;" />
<blockquote>
<p>[!Info]
联合变量二维平面图形</p>
</blockquote>
<pre><code class="language-r"># pdp_2d_two_predictor(model = knn_model,num = 6,ncol = 3)
</code></pre>
<p>颜色越浅，数值越大。</p>
<ul>
<li>预测测试集</li>
</ul>
<pre><code class="language-r">extractProb(list(knn_model), testX = test) %&gt;%
  metrics_set(data = .) %&gt;%
  kable(&quot;html&quot;, align = &quot;cr&quot;, escape = FALSE) %&gt;%
  kable_styling() %&gt;%
  kableExtra::kable_classic()
</code></pre>
<table class="table lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> metric </th>
   <th style="text-align:right;"> value </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> acc </td>
   <td style="text-align:right;"> 0.9351988 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> kap </td>
   <td style="text-align:right;"> 0.6150794 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ppv </td>
   <td style="text-align:right;"> 0.9642857 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> precision </td>
   <td style="text-align:right;"> 0.9642857 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> recall </td>
   <td style="text-align:right;"> 0.9642857 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> f_meas </td>
   <td style="text-align:right;"> 0.9642857 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> sensitivity </td>
   <td style="text-align:right;"> 0.9642857 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> detection_prevalence </td>
   <td style="text-align:right;"> 0.9072165 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> j_index </td>
   <td style="text-align:right;"> 0.6150794 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> npv </td>
   <td style="text-align:right;"> 0.6507937 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> specificity </td>
   <td style="text-align:right;"> 0.6507937 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> roc </td>
   <td style="text-align:right;"> 0.9631262 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> mn_log_loss </td>
   <td style="text-align:right;"> 0.1285386 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> pr_auc </td>
   <td style="text-align:right;"> 0.9962073 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> tss </td>
   <td style="text-align:right;"> 0.6150794 </td>
  </tr>
</tbody>
</table>
<ul>
<li>预测上海市</li>
</ul>
<pre><code class="language-r">sh_pred_layer &lt;- pred_df(model = knn_model) %&gt;%
  pred_layer(
    pred_df = .,
    model = knn_model,
    model.name = &quot;knn&quot;
  )
</code></pre>
<pre><code>#&gt; [1] &quot;数据中变量个数符合要求&quot;
#&gt; [1] &quot;数据中分类变量是二值型&quot;
#&gt; [1] &quot;数据中二分类变量种类符合要求&quot;
#&gt; [1] &quot;数据中预测概率值变量范围符合要求&quot;
#&gt; [1] &quot;模型名称符合要求&quot;
#&gt; [1] &quot;Path `./data/pred/caret` already exist!&quot;
</code></pre>
<pre><code class="language-r">sh_pred_layer
</code></pre>
<pre><code>#&gt; class      : RasterStack 
#&gt; dimensions : 1362, 1260, 1716120, 2  (nrow, ncol, ncell, nlayers)
#&gt; resolution : 0.0008333333, 0.0008333333  (x, y)
#&gt; extent     : 120.8529, 121.9029, 30.70042, 31.83542  (xmin, xmax, ymin, ymax)
#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs 
#&gt; names      : knn_bin, knn_prob 
#&gt; min values :       0,        0 
#&gt; max values :       1,        1
</code></pre>
<ul>
<li>上海市预测结果平面图</li>
</ul>
<pre><code class="language-r">sh_tmap(sh_pred_layer)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-103-1.png" width="672" style="display: block; margin: auto;" />
<ul>
<li>上海市预测结果立体图</li>
</ul>
<pre><code class="language-r">sh_rayshader(data = sh_pred_layer$knn_prob)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-104-1.png" width="672" style="display: block; margin: auto;" />
<h3 id="37-c50">3.7 C5.0</h3>
<ul>
<li>10折交叉验证，3次重复</li>
</ul>
<pre><code class="language-r">set.seed(1111)

grid &lt;- expand.grid(.winnow = c(TRUE, FALSE), .trials = c(1, 5, 10, 15, 20), .model = &quot;tree&quot;)

C5.0_model &lt;- train(class ~ .,
  data = train,
  tuneGrid = grid,
  method = &quot;C5.0&quot;,
  trControl = control,
  metric = &quot;Kappa&quot;
)
# C5.0_model %&gt;% summary()
</code></pre>
<ul>
<li>输出<code>Kappa</code>达到最大的模型参数</li>
</ul>
<pre><code class="language-r">C5.0_model$bestTune %&gt;%
  kable()
</code></pre>
<table>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> trials </th>
   <th style="text-align:left;"> model </th>
   <th style="text-align:left;"> winnow </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 5 </td>
   <td style="text-align:right;"> 20 </td>
   <td style="text-align:left;"> tree </td>
   <td style="text-align:left;"> FALSE </td>
  </tr>
</tbody>
</table>
<ul>
<li>输出模型评价指标</li>
</ul>
<blockquote>
<p>[!Info]
输出<code>acc</code>、<code>kappa</code>、<code>ROC</code>、<code>ppv</code>等指标</p>
</blockquote>
<pre><code class="language-r">metric_table(C5.0_model) %&gt;%
  beautify_metric_table(table = .)
</code></pre>
<table class="table table-striped table-hover lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;"> Resample </th>
   <th style="text-align:left;"> acc </th>
   <th style="text-align:left;"> kappa </th>
   <th style="text-align:left;"> ROC </th>
   <th style="text-align:left;"> ppv </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Fold01.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.67</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold02.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.67</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.72</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold03.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.67</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.96</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold04.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.64</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.96</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold05.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.55</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.87</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold06.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.5</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold07.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.58</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold08.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.69</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.99</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold09.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.47</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.79</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold10.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.49</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.84</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold01.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.57</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.89</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold02.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.33</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.76</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold03.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.54</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.96</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold04.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.74</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.99</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold05.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.64</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.87</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold06.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.63</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold07.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.42</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold08.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.53</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.73</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold09.Rep2 </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.97</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.84</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.99</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.99</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold10.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.62</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.96</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold01.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.48</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.89</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold02.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.71</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold03.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.62</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold04.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.54</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.87</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold05.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.43</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.85</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold06.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.96</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.69</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.96</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold07.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.96</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.75</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.98</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold08.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.73</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.98</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold09.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.96</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.72</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.87</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold10.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.72</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
  </tr>
</tbody>
</table>
<ul>
<li>混淆矩阵</li>
</ul>
<p>10折交叉验证并且重复三次的结果如下(因为是平均所以会有非整数)</p>
<pre><code class="language-r">confusionMatrix.train(C5.0_model)
</code></pre>
<pre><code>#&gt; Cross-Validated (10 fold, repeated 3 times) Confusion Matrix 
#&gt; 
#&gt; (entries are percentual average cell counts across resamples)
#&gt;  
#&gt;           Reference
#&gt; Prediction   X0   X1
#&gt;         X0 89.8  3.3
#&gt;         X1  0.9  5.9
#&gt;                             
#&gt;  Accuracy (average) : 0.9578
</code></pre>
<ul>
<li>最优参数预测的混淆矩阵.</li>
</ul>
<pre><code class="language-r"># confusionMatrix(data = predict(C5.0_model,train),reference = train$class)
</code></pre>
<ul>
<li>变量重要性</li>
</ul>
<p>这里按照降序排列前若干个重要变量</p>
<pre><code class="language-r">kable_var(C5.0_model, 6)
</code></pre>
<table class="table lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> variables </th>
   <th style="text-align:right;"> importance </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> aridity </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">100</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> hii </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">100</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> im </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">100</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> landcover </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">100</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20162 </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">100</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> night_time_lights </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">100</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> dst_waterway </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">99.85</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20164 </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">90.87</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20163 </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">81.44</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> slope </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">81.15</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20161 </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">80.56</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> aat0 </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">80.41</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> pa </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">80.41</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> dem </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">59.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> aat10 </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">48.01</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> hfp </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">39.91</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> tadem </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">21.06</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> landform </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0</span> </td>
  </tr>
</tbody>
</table>
<p>这里按照降序绘制前若干个重要变量</p>
<pre><code class="language-r">ggplot_var(C5.0_model, 6)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-111-1.png" width="672" style="display: block; margin: auto;" />
<p>排名前六的变量分别是<code>ndvi20163</code>、<code>ndvi20162</code>、<code>im</code>、<code>dst_waterway</code>、<code>aridity</code>、<code>aat10</code></p>
<ul>
<li>partial dependence plots</li>
</ul>
<blockquote>
<p>[!Info]
二维图形</p>
</blockquote>
<pre><code class="language-r">pdp_2d_one_predictor(model = C5.0_model, num = 6, ncol = 2)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-112-1.png" width="672" style="display: block; margin: auto;" />
<blockquote>
<p>[!Info]
联合变量二维平面图形</p>
</blockquote>
<pre><code class="language-r"># pdp_2d_two_predictor(model = C5.0_model,num = 6,ncol = 3)
</code></pre>
<p>颜色越浅，数值越大。</p>
<ul>
<li>预测测试集</li>
</ul>
<pre><code class="language-r">extractProb(list(C5.0_model), testX = test) %&gt;%
  metrics_set(data = .) %&gt;%
  kable(&quot;html&quot;, align = &quot;cr&quot;, escape = FALSE) %&gt;%
  kable_styling() %&gt;%
  kableExtra::kable_classic()
</code></pre>
<table class="table lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> metric </th>
   <th style="text-align:right;"> value </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> acc </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> kap </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ppv </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> precision </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> recall </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> f_meas </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> sensitivity </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> detection_prevalence </td>
   <td style="text-align:right;"> 0.9072165 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> j_index </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> npv </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> specificity </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> roc </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> mn_log_loss </td>
   <td style="text-align:right;"> 0.0662247 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> pr_auc </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> tss </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
</tbody>
</table>
<ul>
<li>预测上海市</li>
</ul>
<pre><code class="language-r">sh_pred_layer &lt;- pred_df(model = C5.0_model) %&gt;%
  pred_layer(
    pred_df = .,
    model = C5.0_model,
    model.name = &quot;C5.0&quot;
  )
</code></pre>
<pre><code>#&gt; [1] &quot;数据中变量个数符合要求&quot;
#&gt; [1] &quot;数据中分类变量是二值型&quot;
#&gt; [1] &quot;数据中二分类变量种类符合要求&quot;
#&gt; [1] &quot;数据中预测概率值变量范围符合要求&quot;
#&gt; [1] &quot;模型名称符合要求&quot;
#&gt; [1] &quot;Path `./data/pred/caret` already exist!&quot;
</code></pre>
<pre><code class="language-r">sh_pred_layer
</code></pre>
<pre><code>#&gt; class      : RasterStack 
#&gt; dimensions : 1362, 1260, 1716120, 2  (nrow, ncol, ncell, nlayers)
#&gt; resolution : 0.0008333333, 0.0008333333  (x, y)
#&gt; extent     : 120.8529, 121.9029, 30.70042, 31.83542  (xmin, xmax, ymin, ymax)
#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs 
#&gt; names      :  C5.0_bin, C5.0_prob 
#&gt; min values :         0,         0 
#&gt; max values : 1.0000000, 0.9461689
</code></pre>
<ul>
<li>上海市预测结果平面图</li>
</ul>
<pre><code class="language-r">sh_tmap(sh_pred_layer)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-116-1.png" width="672" style="display: block; margin: auto;" />
<ul>
<li>上海市预测结果立体图</li>
</ul>
<pre><code class="language-r">sh_rayshader(data = sh_pred_layer$C5.0_prob)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-117-1.png" width="672" style="display: block; margin: auto;" />
<h3 id="38-adaboostm1">3.8 AdaBoost.M1</h3>
<ul>
<li>10折交叉验证，3次重复</li>
</ul>
<pre><code class="language-r">set.seed(1111)
grid &lt;- expand.grid(
  mfinal = (1:3) * 3,
  maxdepth = c(1, 3),
  coeflearn = c(&quot;Breiman&quot;, &quot;Freund&quot;, &quot;Zhu&quot;)
)
AdaBoost.M1_model &lt;- train(class ~ .,
  data = train,
  tuneGrid = grid,
  method = &quot;AdaBoost.M1&quot;,
  trControl = control,
  preProc = c(&quot;center&quot;, &quot;scale&quot;),
  metric = &quot;Kappa&quot;
)
# AdaBoost.M1_model %&gt;% summary()
</code></pre>
<ul>
<li>输出<code>Kappa</code>达到最大的模型参数</li>
</ul>
<pre><code class="language-r">AdaBoost.M1_model$bestTune %&gt;%
  kable()
</code></pre>
<table>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> mfinal </th>
   <th style="text-align:right;"> maxdepth </th>
   <th style="text-align:left;"> coeflearn </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 12 </td>
   <td style="text-align:right;"> 9 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:left;"> Freund </td>
  </tr>
</tbody>
</table>
<ul>
<li>输出模型评价指标</li>
</ul>
<blockquote>
<p>[!Info]
输出<code>acc</code>、<code>kappa</code>、<code>ROC</code>、<code>ppv</code>等指标</p>
</blockquote>
<pre><code class="language-r">metric_table(AdaBoost.M1_model) %&gt;%
  beautify_metric_table(table = .)
</code></pre>
<table class="table table-striped table-hover lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;"> Resample </th>
   <th style="text-align:left;"> acc </th>
   <th style="text-align:left;"> kappa </th>
   <th style="text-align:left;"> ROC </th>
   <th style="text-align:left;"> ppv </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Fold01.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.23</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.8</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold02.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.36</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.72</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold03.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.36</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.79</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold04.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.35</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.81</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold05.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.25</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.79</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold06.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.31</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.84</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold07.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.26</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.84</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold08.Rep1 </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.93</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.49</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.83</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold09.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.18</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.69</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold10.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.21</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.84</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold01.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.25</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.82</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold02.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.12</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.72</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold03.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.25</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.84</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold04.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.37</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.85</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold05.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.36</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.77</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold06.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.29</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.83</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold07.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.17</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.81</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold08.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.29</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.82</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold09.Rep2 </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.46</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.85</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold10.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.29</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.78</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold01.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.27</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.84</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold02.Rep3 </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.42</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.83</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold03.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.22</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.8</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold04.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.25</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.79</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold05.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.35</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.74</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold06.Rep3 </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.38</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.89</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold07.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.42</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.88</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold08.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.31</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.74</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold09.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.35</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.77</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold10.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.35</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.83</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
  </tr>
</tbody>
</table>
<ul>
<li>混淆矩阵</li>
</ul>
<p>10折交叉验证并且重复三次的结果如下(因为是平均所以会有非整数)</p>
<pre><code class="language-r">confusionMatrix.train(AdaBoost.M1_model)
</code></pre>
<pre><code>#&gt; Cross-Validated (10 fold, repeated 3 times) Confusion Matrix 
#&gt; 
#&gt; (entries are percentual average cell counts across resamples)
#&gt;  
#&gt;           Reference
#&gt; Prediction   X0   X1
#&gt;         X0 88.1  4.0
#&gt;         X1  2.6  5.3
#&gt;                             
#&gt;  Accuracy (average) : 0.9342
</code></pre>
<ul>
<li>最优参数预测的混淆矩阵.</li>
</ul>
<pre><code class="language-r">confusionMatrix(data = predict(AdaBoost.M1_model, train), reference = train$class)
</code></pre>
<pre><code>#&gt; Confusion Matrix and Statistics
#&gt; 
#&gt;           Reference
#&gt; Prediction  X0  X1
#&gt;         X0 611  10
#&gt;         X1   5  53
#&gt;                                           
#&gt;                Accuracy : 0.9779          
#&gt;                  95% CI : (0.9638, 0.9876)
#&gt;     No Information Rate : 0.9072          
#&gt;     P-Value [Acc &gt; NIR] : 6.792e-14       
#&gt;                                           
#&gt;                   Kappa : 0.8639          
#&gt;                                           
#&gt;  Mcnemar's Test P-Value : 0.3017          
#&gt;                                           
#&gt;             Sensitivity : 0.9919          
#&gt;             Specificity : 0.8413          
#&gt;          Pos Pred Value : 0.9839          
#&gt;          Neg Pred Value : 0.9138          
#&gt;              Prevalence : 0.9072          
#&gt;          Detection Rate : 0.8999          
#&gt;    Detection Prevalence : 0.9146          
#&gt;       Balanced Accuracy : 0.9166          
#&gt;                                           
#&gt;        'Positive' Class : X0              
#&gt; 
</code></pre>
<ul>
<li>变量重要性</li>
</ul>
<p>这里按照降序排列前若干个重要变量</p>
<pre><code class="language-r">kable_var(AdaBoost.M1_model, 6)
</code></pre>
<table class="table lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> variables </th>
   <th style="text-align:right;"> importance </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> aridity </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">100</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20161 </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">87.9385</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> slope </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">86.9881</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20164 </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">86.0624</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> aat0 </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">54.5625</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20162 </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">48.0913</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> dst_waterway </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">47.7874</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> night_time_lights </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">42.7506</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20163 </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">31.6331</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> landcover </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">27.8059</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> aat10 </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">27.0324</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> pa </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">19.6743</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> dem </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">19.2811</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> im </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">3.5043</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> hfp </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> hii </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> landform </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> tadem </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0</span> </td>
  </tr>
</tbody>
</table>
<p>这里按照降序绘制前若干个重要变量</p>
<pre><code class="language-r">ggplot_var(AdaBoost.M1_model, 6)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-124-1.png" width="672" style="display: block; margin: auto;" />
<p>排名前六的变量分别是<code>aridity</code>、<code>im</code>、<code>aat0</code>、<code>pa</code>、<code>slope</code>、<code>aat10</code></p>
<ul>
<li>partial dependence plots</li>
</ul>
<blockquote>
<p>[!Info]
二维图形</p>
</blockquote>
<pre><code class="language-r">pdp_2d_one_predictor(model = AdaBoost.M1_model, num = 6, ncol = 2)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-125-1.png" width="672" style="display: block; margin: auto;" />
<blockquote>
<p>[!Info]
联合变量二维平面图形</p>
</blockquote>
<pre><code class="language-r"># pdp_2d_two_predictor(model = AdaBoost.M1_model,num = 6,ncol = 3)
</code></pre>
<p>颜色越浅，数值越大。</p>
<ul>
<li>预测测试集</li>
</ul>
<pre><code class="language-r">extractProb(list(AdaBoost.M1_model), testX = test) %&gt;%
  metrics_set(data = .) %&gt;%
  kable(&quot;html&quot;, align = &quot;cr&quot;, escape = FALSE) %&gt;%
  kable_styling() %&gt;%
  kableExtra::kable_classic()
</code></pre>
<table class="table lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> metric </th>
   <th style="text-align:right;"> value </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> acc </td>
   <td style="text-align:right;"> 0.9779087 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> kap </td>
   <td style="text-align:right;"> 0.8639297 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ppv </td>
   <td style="text-align:right;"> 0.9838969 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> precision </td>
   <td style="text-align:right;"> 0.9838969 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> recall </td>
   <td style="text-align:right;"> 0.9918831 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> f_meas </td>
   <td style="text-align:right;"> 0.9878739 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> sensitivity </td>
   <td style="text-align:right;"> 0.9918831 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> detection_prevalence </td>
   <td style="text-align:right;"> 0.9145803 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> j_index </td>
   <td style="text-align:right;"> 0.8331530 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> npv </td>
   <td style="text-align:right;"> 0.9137931 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> specificity </td>
   <td style="text-align:right;"> 0.8412698 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> roc </td>
   <td style="text-align:right;"> 0.9960446 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> mn_log_loss </td>
   <td style="text-align:right;"> 0.2193812 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> pr_auc </td>
   <td style="text-align:right;"> 0.9996008 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> tss </td>
   <td style="text-align:right;"> 0.8331530 </td>
  </tr>
</tbody>
</table>
<ul>
<li>预测上海市</li>
</ul>
<pre><code class="language-r">sh_pred_layer &lt;- pred_df(model = AdaBoost.M1_model) %&gt;%
  pred_layer(
    pred_df = .,
    model = AdaBoost.M1_model,
    model.name = &quot;AdaBoost.M1&quot;
  )
</code></pre>
<pre><code>#&gt; [1] &quot;数据中变量个数符合要求&quot;
#&gt; [1] &quot;数据中分类变量是二值型&quot;
#&gt; [1] &quot;数据中二分类变量种类符合要求&quot;
#&gt; [1] &quot;数据中预测概率值变量范围符合要求&quot;
#&gt; [1] &quot;模型名称符合要求&quot;
#&gt; [1] &quot;Path `./data/pred/caret` already exist!&quot;
</code></pre>
<pre><code class="language-r">sh_pred_layer
</code></pre>
<pre><code>#&gt; class      : RasterStack 
#&gt; dimensions : 1362, 1260, 1716120, 2  (nrow, ncol, ncell, nlayers)
#&gt; resolution : 0.0008333333, 0.0008333333  (x, y)
#&gt; extent     : 120.8529, 121.9029, 30.70042, 31.83542  (xmin, xmax, ymin, ymax)
#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs 
#&gt; names      : AdaBoost.M1_bin, AdaBoost.M1_prob 
#&gt; min values :               0,                0 
#&gt; max values :       1.0000000,        0.8896021
</code></pre>
<ul>
<li>上海市预测结果平面图</li>
</ul>
<pre><code class="language-r">sh_tmap(sh_pred_layer)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-129-1.png" width="672" style="display: block; margin: auto;" />
<ul>
<li>上海市预测结果立体图</li>
</ul>
<pre><code class="language-r">sh_rayshader(data = sh_pred_layer$AdaBoost.M1_prob)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-130-1.png" width="672" style="display: block; margin: auto;" />
<h3 id="39-xgb">3.9 XGB</h3>
<ul>
<li>10折交叉验证，3次重复</li>
</ul>
<pre><code class="language-r">library(doParallel)
cores &lt;- makeCluster(detectCores() - 1)
registerDoParallel(cores = cores)

set.seed(123)

grid_default &lt;- expand.grid(
  nrounds = 100,
  max_depth = 6,
  eta = 0.3,
  gamma = 0,
  colsample_bytree = 1,
  min_child_weight = 1,
  subsample = 1
)

# Create control function for training with 10 folds and keep 3 folds for training. search method is grid.
control &lt;- trainControl(
  method = &quot;repeatedcv&quot;,
  number = 10,
  repeats = 3,
  savePredictions = TRUE,
  classProbs = TRUE,
  allowParallel = TRUE
)

xgb_model &lt;- train(class ~ .,
  data = train,
  method = &quot;xgbTree&quot;,
  trControl = control,
  tuneGrid = grid_default
)
xgb_model
</code></pre>
<pre><code>#&gt; eXtreme Gradient Boosting 
#&gt; 
#&gt; 679 samples
#&gt;  18 predictor
#&gt;   2 classes: 'X0', 'X1' 
#&gt; 
#&gt; No pre-processing
#&gt; Resampling: Cross-Validated (10 fold, repeated 3 times) 
#&gt; Summary of sample sizes: 610, 611, 611, 612, 611, 612, ... 
#&gt; Resampling results:
#&gt; 
#&gt;   Accuracy   Kappa    
#&gt;   0.9528724  0.6743974
#&gt; 
#&gt; Tuning parameter 'nrounds' was held constant at a value of 100
#&gt; Tuning
#&gt;  held constant at a value of 1
#&gt; Tuning parameter 'subsample' was held
#&gt;  constant at a value of 1
</code></pre>
<ul>
<li>输出<code>Kappa</code>达到最大的模型参数</li>
</ul>
<pre><code class="language-r">xgb_model$bestTune %&gt;%
  kable()
</code></pre>
<table>
 <thead>
  <tr>
   <th style="text-align:right;"> nrounds </th>
   <th style="text-align:right;"> max_depth </th>
   <th style="text-align:right;"> eta </th>
   <th style="text-align:right;"> gamma </th>
   <th style="text-align:right;"> colsample_bytree </th>
   <th style="text-align:right;"> min_child_weight </th>
   <th style="text-align:right;"> subsample </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 100 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 0.3 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
</tbody>
</table>
<ul>
<li>输出模型评价指标</li>
</ul>
<blockquote>
<p>[!Info]
输出<code>acc</code>、<code>kappa</code>、<code>ROC</code>、<code>ppv</code>等指标</p>
</blockquote>
<pre><code class="language-r">metric_table(xgb_model) %&gt;%
  beautify_metric_table(table = .)
</code></pre>
<table class="table table-striped table-hover lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;"> Resample </th>
   <th style="text-align:left;"> acc </th>
   <th style="text-align:left;"> kappa </th>
   <th style="text-align:left;"> ROC </th>
   <th style="text-align:left;"> ppv </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Fold01.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.96</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.78</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.99</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.98</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold02.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.27</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold03.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.51</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.87</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold04.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.51</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.77</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold05.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.63</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.87</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold06.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.96</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.7</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold07.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.78</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold08.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.64</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold09.Rep1 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.82</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.98</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold10.Rep1 </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.99</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.92</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">1</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">1</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold01.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.82</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.98</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold02.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.96</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.7</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold03.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.82</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold04.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.27</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.92</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold05.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.82</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold06.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.51</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.85</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold07.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.82</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.98</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold08.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.82</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.99</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.98</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold09.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.96</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.75</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold10.Rep2 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.96</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.65</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold01.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.78</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold02.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.82</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.98</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.98</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold03.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.58</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold04.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.57</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold05.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.96</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.65</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold06.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.82</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.9</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.97</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold07.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.96</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.65</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold08.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.93</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.51</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.94</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold09.Rep3 </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.91</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.45</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
   <td style="text-align:left;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.95</span> </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Fold10.Rep3 </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.99</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">0.92</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">1</span> </td>
   <td style="text-align:left;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">1</span> </td>
  </tr>
</tbody>
</table>
<ul>
<li>混淆矩阵</li>
</ul>
<p>10折交叉验证并且重复三次的结果如下(因为是平均所以会有非整数)</p>
<pre><code class="language-r">confusionMatrix.train(xgb_model)
</code></pre>
<pre><code>#&gt; Cross-Validated (10 fold, repeated 3 times) Confusion Matrix 
#&gt; 
#&gt; (entries are percentual average cell counts across resamples)
#&gt;  
#&gt;           Reference
#&gt; Prediction   X0   X1
#&gt;         X0 89.4  3.4
#&gt;         X1  1.3  5.9
#&gt;                             
#&gt;  Accuracy (average) : 0.9529
</code></pre>
<ul>
<li>最优参数预测的混淆矩阵.</li>
</ul>
<pre><code class="language-r">confusionMatrix(data = predict(xgb_model, train), reference = train$class)
</code></pre>
<pre><code>#&gt; Confusion Matrix and Statistics
#&gt; 
#&gt;           Reference
#&gt; Prediction  X0  X1
#&gt;         X0 616   0
#&gt;         X1   0  63
#&gt;                                      
#&gt;                Accuracy : 1          
#&gt;                  95% CI : (0.9946, 1)
#&gt;     No Information Rate : 0.9072     
#&gt;     P-Value [Acc &gt; NIR] : &lt; 2.2e-16  
#&gt;                                      
#&gt;                   Kappa : 1          
#&gt;                                      
#&gt;  Mcnemar's Test P-Value : NA         
#&gt;                                      
#&gt;             Sensitivity : 1.0000     
#&gt;             Specificity : 1.0000     
#&gt;          Pos Pred Value : 1.0000     
#&gt;          Neg Pred Value : 1.0000     
#&gt;              Prevalence : 0.9072     
#&gt;          Detection Rate : 0.9072     
#&gt;    Detection Prevalence : 0.9072     
#&gt;       Balanced Accuracy : 1.0000     
#&gt;                                      
#&gt;        'Positive' Class : X0         
#&gt; 
</code></pre>
<ul>
<li>变量重要性</li>
</ul>
<p>这里按照降序排列前若干个重要变量</p>
<pre><code class="language-r">kable_var(xgb_model, 6)
</code></pre>
<table class="table lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> variables </th>
   <th style="text-align:right;"> importance </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> aridity </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">100</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> aat0 </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">82.2365</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20161 </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">77.1596</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> landcover </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">72.007</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> dst_waterway </td>
   <td style="text-align:right;"> <span style=" font-weight: bold; font-style: italic;   color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: grey !important;font-size: 20px;">69.5677</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> night_time_lights </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">41.7552</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20164 </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">36.8106</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20163 </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">34.2087</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ndvi20162 </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">32.175</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> slope </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">21.949</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> dem </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">21.639</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> im </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">18.4633</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> hfp </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">16.3653</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> hii </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">15.7124</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> aat10 </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">15.5922</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> pa </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">2.8883</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> tadem </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0.0569</span> </td>
  </tr>
  <tr>
   <td style="text-align:center;"> landform </td>
   <td style="text-align:right;"> <span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;font-size: 15px;">0</span> </td>
  </tr>
</tbody>
</table>
<pre><code class="language-r">ggplot_var(xgb_model, 6)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-137-1.png" width="672" style="display: block; margin: auto;" />
<p>排名前六的变量分别是<code>aridity</code>、<code>im</code>、<code>aat0</code>、<code>pa</code>、<code>slope</code>、<code>aat10</code></p>
<ul>
<li>partial dependence plots</li>
</ul>
<blockquote>
<p>[!Info]
二维图形</p>
</blockquote>
<pre><code class="language-r">pdp_2d_one_predictor(model = xgb_model, num = 6, ncol = 2)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-138-1.png" width="672" style="display: block; margin: auto;" />
<blockquote>
<p>[!Info]
联合变量二维平面图形</p>
</blockquote>
<pre><code class="language-r">pdp_2d_two_predictor(model = xgb_model, num = 6, ncol = 3)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-139-1.png" width="672" style="display: block; margin: auto;" />
<p>颜色越浅，数值越大。</p>
<ul>
<li>预测测试集</li>
</ul>
<pre><code class="language-r">extractProb(list(xgb_model), testX = test) %&gt;%
  metrics_set(data = .) %&gt;%
  kable(&quot;html&quot;, align = &quot;cr&quot;, escape = FALSE) %&gt;%
  kable_styling() %&gt;%
  kableExtra::kable_classic()
</code></pre>
<table class="table lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> metric </th>
   <th style="text-align:right;"> value </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> acc </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> kap </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ppv </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> precision </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> recall </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> f_meas </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> sensitivity </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> detection_prevalence </td>
   <td style="text-align:right;"> 0.9072165 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> j_index </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> npv </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> specificity </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> roc </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> mn_log_loss </td>
   <td style="text-align:right;"> 0.0070913 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> pr_auc </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> tss </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
</tbody>
</table>
<ul>
<li>预测上海市</li>
</ul>
<pre><code class="language-r">sh_pred_layer &lt;- pred_df(model = xgb_model) %&gt;%
  pred_layer(
    pred_df = .,
    model = xgb_model,
    model.name = &quot;xgb&quot;
  )
</code></pre>
<pre><code>#&gt; [1] &quot;数据中变量个数符合要求&quot;
#&gt; [1] &quot;数据中分类变量是二值型&quot;
#&gt; [1] &quot;数据中二分类变量种类符合要求&quot;
#&gt; [1] &quot;数据中预测概率值变量范围符合要求&quot;
#&gt; [1] &quot;模型名称符合要求&quot;
#&gt; [1] &quot;Path `./data/pred/caret` already exist!&quot;
</code></pre>
<pre><code class="language-r">sh_pred_layer
</code></pre>
<pre><code>#&gt; class      : RasterStack 
#&gt; dimensions : 1362, 1260, 1716120, 2  (nrow, ncol, ncell, nlayers)
#&gt; resolution : 0.0008333333, 0.0008333333  (x, y)
#&gt; extent     : 120.8529, 121.9029, 30.70042, 31.83542  (xmin, xmax, ymin, ymax)
#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs 
#&gt; names      :      xgb_bin,     xgb_prob 
#&gt; min values : 0.000000e+00, 1.347065e-05 
#&gt; max values :    1.0000000,    0.9989281
</code></pre>
<ul>
<li>上海市预测结果平面图</li>
</ul>
<pre><code class="language-r">sh_tmap(sh_pred_layer)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-142-1.png" width="672" style="display: block; margin: auto;" />
<ul>
<li>上海市预测结果立体图</li>
</ul>
<pre><code class="language-r">sh_rayshader(data = sh_pred_layer$xgb_prob)
</code></pre>
<img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-143-1.png" width="672" style="display: block; margin: auto;" />
<h2 id="4-结果汇总">4. 结果汇总</h2>
<pre><code class="language-r">metrics_summary_test &lt;- ls() %&gt;%
  as_tibble() %&gt;%
  setNames(&quot;model.name&quot;) %&gt;%
  dplyr::filter(str_detect(model.name, &quot;_model&quot;)) %&gt;%
  # dplyr::filter(! model.name %in% c(&quot;J48_model&quot;,&quot;nb_model&quot;)) %&gt;%
  group_by(model.name) %&gt;%
  mutate(model = list(get(model.name))) %&gt;%
  mutate(metric = map(model, ~ extractProb(list(.x), testX = test) %&gt;%
    metrics_set(data = .))) %&gt;%
  dplyr::select(-model) %&gt;%
  unnest(metric) %&gt;%
  ungroup()
</code></pre>
<p>由于表格限制，只展示广义线性模型指标结果</p>
<pre><code class="language-r">metrics_summary_test %&gt;%
  dplyr::filter(model.name == &quot;glm_model&quot;) %&gt;%
  kable(&quot;html&quot;, align = &quot;cr&quot;, escape = FALSE) %&gt;%
  kable_styling() %&gt;%
  kableExtra::kable_classic()
</code></pre>
<table class="table lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> model.name </th>
   <th style="text-align:right;"> metric </th>
   <th style="text-align:center;"> value </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> glm_model </td>
   <td style="text-align:right;"> acc </td>
   <td style="text-align:center;"> 0.9175258 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> glm_model </td>
   <td style="text-align:right;"> kap </td>
   <td style="text-align:center;"> 0.2554825 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> glm_model </td>
   <td style="text-align:right;"> ppv </td>
   <td style="text-align:center;"> 0.9216867 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> glm_model </td>
   <td style="text-align:right;"> precision </td>
   <td style="text-align:center;"> 0.9216867 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> glm_model </td>
   <td style="text-align:right;"> recall </td>
   <td style="text-align:center;"> 0.9935065 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> glm_model </td>
   <td style="text-align:right;"> f_meas </td>
   <td style="text-align:center;"> 0.9562500 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> glm_model </td>
   <td style="text-align:right;"> sensitivity </td>
   <td style="text-align:center;"> 0.9935065 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> glm_model </td>
   <td style="text-align:right;"> detection_prevalence </td>
   <td style="text-align:center;"> 0.9779087 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> glm_model </td>
   <td style="text-align:right;"> j_index </td>
   <td style="text-align:center;"> 0.1681097 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> glm_model </td>
   <td style="text-align:right;"> npv </td>
   <td style="text-align:center;"> 0.7333333 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> glm_model </td>
   <td style="text-align:right;"> specificity </td>
   <td style="text-align:center;"> 0.1746032 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> glm_model </td>
   <td style="text-align:right;"> roc </td>
   <td style="text-align:center;"> 0.8375850 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> glm_model </td>
   <td style="text-align:right;"> mn_log_loss </td>
   <td style="text-align:center;"> 0.2366485 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> glm_model </td>
   <td style="text-align:right;"> pr_auc </td>
   <td style="text-align:center;"> 0.9788400 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> glm_model </td>
   <td style="text-align:right;"> tss </td>
   <td style="text-align:center;"> 0.1681097 </td>
  </tr>
</tbody>
</table>
<pre><code class="language-r">metrics_summary_test %&gt;%
  dplyr::filter(metric %in% c(&quot;kap&quot;, &quot;roc&quot;, &quot;tss&quot;)) %&gt;%
  group_by(metric) %&gt;%
  slice_max(value) %&gt;%
  ungroup()
</code></pre>
<pre><code>#&gt; # A tibble: 12 × 3
#&gt;    model.name metric value
#&gt;    &lt;chr&gt;      &lt;chr&gt;  &lt;dbl&gt;
#&gt;  1 C5.0_model kap        1
#&gt;  2 gbm_model  kap        1
#&gt;  3 rf_model   kap        1
#&gt;  4 xgb_model  kap        1
#&gt;  5 C5.0_model roc        1
#&gt;  6 gbm_model  roc        1
#&gt;  7 rf_model   roc        1
#&gt;  8 xgb_model  roc        1
#&gt;  9 C5.0_model tss        1
#&gt; 10 gbm_model  tss        1
#&gt; 11 rf_model   tss        1
#&gt; 12 xgb_model  tss        1
</code></pre>
<ul>
<li>同时汇总模型在训练集上的指标</li>
</ul>
<pre><code class="language-r">metrics_summary_train &lt;- ls() %&gt;%
  as_tibble() %&gt;%
  setNames(&quot;model.name&quot;) %&gt;%
  dplyr::filter(str_detect(model.name, &quot;_model&quot;)) %&gt;%
  group_by(model.name) %&gt;%
  mutate(model = list(get(model.name))) %&gt;%
  mutate(metric = map(model, ~ extractProb(list(.x), testX = train) %&gt;%
    metrics_set(data = .))) %&gt;%
  dplyr::select(-model) %&gt;%
  unnest(metric) %&gt;%
  ungroup()
metrics_summary_train %&gt;%
  dplyr::filter(metric %in% c(&quot;kap&quot;, &quot;roc&quot;, &quot;tss&quot;)) %&gt;%
  group_by(metric) %&gt;%
  slice_max(value)
</code></pre>
<pre><code>#&gt; # A tibble: 12 × 3
#&gt; # Groups:   metric [3]
#&gt;    model.name metric value
#&gt;    &lt;chr&gt;      &lt;chr&gt;  &lt;dbl&gt;
#&gt;  1 C5.0_model kap        1
#&gt;  2 gbm_model  kap        1
#&gt;  3 rf_model   kap        1
#&gt;  4 xgb_model  kap        1
#&gt;  5 C5.0_model roc        1
#&gt;  6 gbm_model  roc        1
#&gt;  7 rf_model   roc        1
#&gt;  8 xgb_model  roc        1
#&gt;  9 C5.0_model tss        1
#&gt; 10 gbm_model  tss        1
#&gt; 11 rf_model   tss        1
#&gt; 12 xgb_model  tss        1
</code></pre>
<p>一时间竟然无法取舍</p>
<h3 id="41--最优模型变量重要性">4.1  最优模型变量重要性</h3>
<pre><code class="language-r">metrics_summary_test %&gt;%
  dplyr::filter(metric %in% c(&quot;kap&quot;, &quot;roc&quot;, &quot;tss&quot;)) %&gt;%
  group_by(metric) %&gt;%
  slice_max(value) %&gt;%
  ungroup() %&gt;%
  dplyr::distinct(.keep_all = T, model.name) %&gt;%
  dplyr::select(model.name) %&gt;%
  group_by(model.name) %&gt;%
  mutate(vip = map(model.name, ~ caret::varImp(get(model.name)) %&gt;%
    .$importance %&gt;%
    dplyr::select(last_col()) %&gt;%
    rownames_to_column(&quot;variables&quot;) %&gt;%
    setNames(c(&quot;variables&quot;, &quot;importance&quot;)) %&gt;%
    arrange(desc(importance)))) %&gt;%
  unnest(vip) %&gt;%
  ungroup() %&gt;%
  kable(&quot;html&quot;, escape = FALSE) %&gt;%
  kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;)) %&gt;%
  kableExtra::kable_classic()
</code></pre>
<table class="table table-striped table-hover lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;"> model.name </th>
   <th style="text-align:left;"> variables </th>
   <th style="text-align:right;"> importance </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> C5.0_model </td>
   <td style="text-align:left;"> aridity </td>
   <td style="text-align:right;"> 100.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> C5.0_model </td>
   <td style="text-align:left;"> hii </td>
   <td style="text-align:right;"> 100.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> C5.0_model </td>
   <td style="text-align:left;"> im </td>
   <td style="text-align:right;"> 100.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> C5.0_model </td>
   <td style="text-align:left;"> landcover </td>
   <td style="text-align:right;"> 100.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> C5.0_model </td>
   <td style="text-align:left;"> ndvi20162 </td>
   <td style="text-align:right;"> 100.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> C5.0_model </td>
   <td style="text-align:left;"> night_time_lights </td>
   <td style="text-align:right;"> 100.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> C5.0_model </td>
   <td style="text-align:left;"> dst_waterway </td>
   <td style="text-align:right;"> 99.8500000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> C5.0_model </td>
   <td style="text-align:left;"> ndvi20164 </td>
   <td style="text-align:right;"> 90.8700000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> C5.0_model </td>
   <td style="text-align:left;"> ndvi20163 </td>
   <td style="text-align:right;"> 81.4400000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> C5.0_model </td>
   <td style="text-align:left;"> slope </td>
   <td style="text-align:right;"> 81.1500000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> C5.0_model </td>
   <td style="text-align:left;"> ndvi20161 </td>
   <td style="text-align:right;"> 80.5600000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> C5.0_model </td>
   <td style="text-align:left;"> aat0 </td>
   <td style="text-align:right;"> 80.4100000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> C5.0_model </td>
   <td style="text-align:left;"> pa </td>
   <td style="text-align:right;"> 80.4100000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> C5.0_model </td>
   <td style="text-align:left;"> dem </td>
   <td style="text-align:right;"> 59.9400000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> C5.0_model </td>
   <td style="text-align:left;"> aat10 </td>
   <td style="text-align:right;"> 48.0100000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> C5.0_model </td>
   <td style="text-align:left;"> hfp </td>
   <td style="text-align:right;"> 39.9100000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> C5.0_model </td>
   <td style="text-align:left;"> tadem </td>
   <td style="text-align:right;"> 21.0600000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> C5.0_model </td>
   <td style="text-align:left;"> landform </td>
   <td style="text-align:right;"> 0.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> gbm_model </td>
   <td style="text-align:left;"> dst_waterway </td>
   <td style="text-align:right;"> 100.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> gbm_model </td>
   <td style="text-align:left;"> aridity </td>
   <td style="text-align:right;"> 97.1286298 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> gbm_model </td>
   <td style="text-align:left;"> aat0 </td>
   <td style="text-align:right;"> 89.9183186 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> gbm_model </td>
   <td style="text-align:left;"> night_time_lights </td>
   <td style="text-align:right;"> 89.6179419 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> gbm_model </td>
   <td style="text-align:left;"> ndvi20161 </td>
   <td style="text-align:right;"> 82.3911808 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> gbm_model </td>
   <td style="text-align:left;"> ndvi20163 </td>
   <td style="text-align:right;"> 77.9795941 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> gbm_model </td>
   <td style="text-align:left;"> landcover </td>
   <td style="text-align:right;"> 77.4451094 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> gbm_model </td>
   <td style="text-align:left;"> ndvi20164 </td>
   <td style="text-align:right;"> 62.2693311 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> gbm_model </td>
   <td style="text-align:left;"> ndvi20162 </td>
   <td style="text-align:right;"> 57.1307083 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> gbm_model </td>
   <td style="text-align:left;"> im </td>
   <td style="text-align:right;"> 45.4933406 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> gbm_model </td>
   <td style="text-align:left;"> slope </td>
   <td style="text-align:right;"> 41.6401825 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> gbm_model </td>
   <td style="text-align:left;"> dem </td>
   <td style="text-align:right;"> 27.7417888 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> gbm_model </td>
   <td style="text-align:left;"> hfp </td>
   <td style="text-align:right;"> 25.0031156 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> gbm_model </td>
   <td style="text-align:left;"> aat10 </td>
   <td style="text-align:right;"> 24.8656861 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> gbm_model </td>
   <td style="text-align:left;"> hii </td>
   <td style="text-align:right;"> 16.6720575 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> gbm_model </td>
   <td style="text-align:left;"> pa </td>
   <td style="text-align:right;"> 7.7145250 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> gbm_model </td>
   <td style="text-align:left;"> tadem </td>
   <td style="text-align:right;"> 0.6923761 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> gbm_model </td>
   <td style="text-align:left;"> landform </td>
   <td style="text-align:right;"> 0.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> rf_model </td>
   <td style="text-align:left;"> dst_waterway </td>
   <td style="text-align:right;"> 100.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> rf_model </td>
   <td style="text-align:left;"> aridity </td>
   <td style="text-align:right;"> 93.2916084 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> rf_model </td>
   <td style="text-align:left;"> im </td>
   <td style="text-align:right;"> 83.3008503 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> rf_model </td>
   <td style="text-align:left;"> aat0 </td>
   <td style="text-align:right;"> 79.9581067 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> rf_model </td>
   <td style="text-align:left;"> pa </td>
   <td style="text-align:right;"> 79.8204807 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> rf_model </td>
   <td style="text-align:left;"> ndvi20163 </td>
   <td style="text-align:right;"> 77.8861421 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> rf_model </td>
   <td style="text-align:left;"> ndvi20164 </td>
   <td style="text-align:right;"> 74.6360137 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> rf_model </td>
   <td style="text-align:left;"> night_time_lights </td>
   <td style="text-align:right;"> 71.6369126 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> rf_model </td>
   <td style="text-align:left;"> ndvi20161 </td>
   <td style="text-align:right;"> 70.0404321 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> rf_model </td>
   <td style="text-align:left;"> landcover </td>
   <td style="text-align:right;"> 69.8982271 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> rf_model </td>
   <td style="text-align:left;"> ndvi20162 </td>
   <td style="text-align:right;"> 66.4762763 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> rf_model </td>
   <td style="text-align:left;"> aat10 </td>
   <td style="text-align:right;"> 61.5782002 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> rf_model </td>
   <td style="text-align:left;"> dem </td>
   <td style="text-align:right;"> 58.5583452 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> rf_model </td>
   <td style="text-align:left;"> slope </td>
   <td style="text-align:right;"> 58.0832497 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> rf_model </td>
   <td style="text-align:left;"> hfp </td>
   <td style="text-align:right;"> 49.0281335 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> rf_model </td>
   <td style="text-align:left;"> hii </td>
   <td style="text-align:right;"> 41.9919145 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> rf_model </td>
   <td style="text-align:left;"> tadem </td>
   <td style="text-align:right;"> 11.8790473 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> rf_model </td>
   <td style="text-align:left;"> landform </td>
   <td style="text-align:right;"> 0.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> xgb_model </td>
   <td style="text-align:left;"> aridity </td>
   <td style="text-align:right;"> 100.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> xgb_model </td>
   <td style="text-align:left;"> aat0 </td>
   <td style="text-align:right;"> 82.2365023 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> xgb_model </td>
   <td style="text-align:left;"> ndvi20161 </td>
   <td style="text-align:right;"> 77.1595878 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> xgb_model </td>
   <td style="text-align:left;"> landcover </td>
   <td style="text-align:right;"> 72.0070366 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> xgb_model </td>
   <td style="text-align:left;"> dst_waterway </td>
   <td style="text-align:right;"> 69.5676812 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> xgb_model </td>
   <td style="text-align:left;"> night_time_lights </td>
   <td style="text-align:right;"> 41.7552317 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> xgb_model </td>
   <td style="text-align:left;"> ndvi20164 </td>
   <td style="text-align:right;"> 36.8105997 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> xgb_model </td>
   <td style="text-align:left;"> ndvi20163 </td>
   <td style="text-align:right;"> 34.2086822 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> xgb_model </td>
   <td style="text-align:left;"> ndvi20162 </td>
   <td style="text-align:right;"> 32.1750177 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> xgb_model </td>
   <td style="text-align:left;"> slope </td>
   <td style="text-align:right;"> 21.9489686 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> xgb_model </td>
   <td style="text-align:left;"> dem </td>
   <td style="text-align:right;"> 21.6390124 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> xgb_model </td>
   <td style="text-align:left;"> im </td>
   <td style="text-align:right;"> 18.4632541 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> xgb_model </td>
   <td style="text-align:left;"> hfp </td>
   <td style="text-align:right;"> 16.3653121 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> xgb_model </td>
   <td style="text-align:left;"> hii </td>
   <td style="text-align:right;"> 15.7124143 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> xgb_model </td>
   <td style="text-align:left;"> aat10 </td>
   <td style="text-align:right;"> 15.5922493 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> xgb_model </td>
   <td style="text-align:left;"> pa </td>
   <td style="text-align:right;"> 2.8882992 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> xgb_model </td>
   <td style="text-align:left;"> tadem </td>
   <td style="text-align:right;"> 0.0568535 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> xgb_model </td>
   <td style="text-align:left;"> landform </td>
   <td style="text-align:right;"> 0.0000000 </td>
  </tr>
</tbody>
</table>
<ul>
<li>用一个横向表格对比各种结果中不同变量重要性</li>
</ul>
<pre><code class="language-r">metrics_summary_test %&gt;%
  dplyr::filter(metric %in% c(&quot;kap&quot;, &quot;roc&quot;, &quot;tss&quot;)) %&gt;%
  group_by(metric) %&gt;%
  slice_max(value) %&gt;%
  ungroup() %&gt;%
  dplyr::distinct(.keep_all = T, model.name) %&gt;%
  dplyr::select(model.name) %&gt;%
  group_by(model.name) %&gt;%
  mutate(vip = map(model.name, ~ caret::varImp(get(model.name)) %&gt;%
    .$importance %&gt;%
    dplyr::select(last_col()) %&gt;%
    rownames_to_column(&quot;variables&quot;) %&gt;%
    setNames(c(&quot;variables&quot;, &quot;importance&quot;)) %&gt;%
    arrange(desc(importance)))) %&gt;%
  unnest(vip) %&gt;%
  mutate(rank = 1:n()) %&gt;%
  ungroup() %&gt;%
  dplyr::select(model.name, variables, rank) %&gt;%
  pivot_wider(names_from = model.name, values_from = rank)
</code></pre>
<pre><code>#&gt; # A tibble: 18 × 5
#&gt;    variables         C5.0_model gbm_model rf_model xgb_model
#&gt;    &lt;chr&gt;                  &lt;int&gt;     &lt;int&gt;    &lt;int&gt;     &lt;int&gt;
#&gt;  1 aridity                    1         2        2         1
#&gt;  2 hii                        2        15       16        14
#&gt;  3 im                         3        10        3        12
#&gt;  4 landcover                  4         7       10         4
#&gt;  5 ndvi20162                  5         9       11         9
#&gt;  6 night_time_lights          6         4        8         6
#&gt;  7 dst_waterway               7         1        1         5
#&gt;  8 ndvi20164                  8         8        7         7
#&gt;  9 ndvi20163                  9         6        6         8
#&gt; 10 slope                     10        11       14        10
#&gt; 11 ndvi20161                 11         5        9         3
#&gt; 12 aat0                      12         3        4         2
#&gt; 13 pa                        13        16        5        16
#&gt; 14 dem                       14        12       13        11
#&gt; 15 aat10                     15        14       12        15
#&gt; 16 hfp                       16        13       15        13
#&gt; 17 tadem                     17        17       17        17
#&gt; 18 landform                  18        18       18        18
</code></pre>
<h3 id="42-提升曲线">4.2 提升曲线</h3>
<pre><code class="language-r">lift.df &lt;- ls() %&gt;%
  as_tibble() %&gt;%
  setNames(&quot;model.name&quot;) %&gt;%
  dplyr::filter(str_detect(model.name, &quot;_model&quot;)) %&gt;%
  group_by(model.name) %&gt;%
  mutate(model = list(get(model.name))) %&gt;%
  mutate(pred = map(model, ~ extractProb(list(.x), testX = train) %&gt;%
    dplyr::select(X0))) %&gt;%
  dplyr::select(-model) %&gt;%
  unnest(pred) %&gt;%
  ungroup() %&gt;%
  setNames(c(&quot;model&quot;, &quot;prob&quot;)) %&gt;%
  # 辅助列帮助转成tibble而非list
  # mutate(id = rep(1:nrow(train),10)) %&gt;%
  mutate(across(.cols = model, .fns = function(x) str_remove(x, &quot;_model&quot;))) %&gt;%
  pivot_wider(names_from = model, values_from = prob) %&gt;%
  mutate(Class = train$class) %&gt;%
  dplyr::select(-id)
</code></pre>
<ul>
<li>根据上文生成的表格计算<code>lift curve</code></li>
</ul>
<pre><code class="language-r">lift_obj &lt;- lift(x = Class ~ AdaBoost.M1 + C5.0 + gbm + glm + J48 + knn + nb + rf + svm + xgb, data = lift.df)

ggplot(data = lift_obj, plot = &quot;gain&quot;) +
  theme_bw()
</code></pre>
<p>看起来差别不大，因此不考虑使用提升曲线</p>
<pre><code class="language-r">lift.plot &lt;- ls() %&gt;%
  as_tibble() %&gt;%
  setNames(&quot;model.name&quot;) %&gt;%
  dplyr::filter(str_detect(model.name, &quot;_model&quot;)) %&gt;%
  dplyr::filter(!model.name %in% c(&quot;J48_model&quot;)) %&gt;%
  group_by(model.name) %&gt;%
  mutate(model = list(get(model.name))) %&gt;%
  mutate(train.pred = map(.x = model, .f = function(x) {
    train %&gt;%
      mutate(pred = predict(object = x, newdata = train, type = &quot;prob&quot;)[, &quot;X1&quot;]) %&gt;%
      mutate(class = ifelse(class == &quot;X0&quot;, 0, 1))
  })) %&gt;%
  mutate(test.pred = map(.x = model, .f = function(x) {
    test %&gt;%
      mutate(pred = predict(object = x, newdata = test, type = &quot;prob&quot;)[, &quot;X1&quot;]) %&gt;%
      mutate(class = ifelse(class == &quot;X0&quot;, 0, 1))
  })) %&gt;%
  mutate(plot = pmap(.l = list(train.pred, test.pred, model.name), .f = function(x, y, z) {
    lift_plot(train_pred = x, test_pred = y, target = &quot;class&quot;, score = &quot;pred&quot;) +
      ggtitle(label = paste(z %&gt;%
        str_remove(&quot;_model&quot;) %&gt;%
        toupper(), &quot;Lift Chart&quot;, sep = &quot; &quot;)) +
      theme(
        plot.title = element_text(size = 10, hjust = 0.5, face = &quot;bold&quot;),
        text = element_text(size = 10, hjust = 0.5, family = &quot;CAL&quot;),
        axis.title.y = element_text(face = &quot;bold&quot;, hjust = 0.5),
        axis.title.x = element_text(face = &quot;bold&quot;, hjust = 0.5),
        axis.text.x = element_text(size = 8, face = &quot;bold&quot;, family = &quot;CAL&quot;, hjust = 0.5, vjust = 0.5),
        axis.text.y = element_text(size = 8, face = &quot;bold&quot;, family = &quot;CAL&quot;, hjust = 0.5, vjust = 0.5)
      )
  }))

# do.call(grid.arrange,c(lift.plot$plot,ncol = 5))
marrangeGrob(lift.plot$plot, nrow = 1, ncol = 1, npages = length(lift.plot$plot))
</code></pre>
<h3 id="43-ks曲线">4.3 ks曲线</h3>
<pre><code class="language-r">ks.plot &lt;- ls() %&gt;%
  as_tibble() %&gt;%
  setNames(&quot;model.name&quot;) %&gt;%
  dplyr::filter(str_detect(model.name, &quot;_model&quot;)) %&gt;%
  dplyr::filter(!model.name %in% c(&quot;J48_model&quot;)) %&gt;%
  group_by(model.name) %&gt;%
  mutate(model = list(get(model.name))) %&gt;%
  mutate(train.pred = map(.x = model, .f = function(x) {
    train %&gt;%
      mutate(pred = predict(object = x, newdata = train, type = &quot;prob&quot;)[, &quot;X1&quot;]) %&gt;%
      mutate(class = ifelse(class == &quot;X0&quot;, 0, 1))
  })) %&gt;%
  mutate(test.pred = map(.x = model, .f = function(x) {
    test %&gt;%
      mutate(pred = predict(object = x, newdata = test, type = &quot;prob&quot;)[, &quot;X1&quot;]) %&gt;%
      mutate(class = ifelse(class == &quot;X0&quot;, 0, 1))
  })) %&gt;%
  mutate(plot = pmap(.l = list(train.pred, test.pred, model.name), .f = function(x, y, z) {
    ks_plot(train_pred = x, test_pred = y, target = &quot;class&quot;, score = &quot;pred&quot;) +
      ggtitle(label = paste(z %&gt;%
        str_remove(&quot;_model&quot;) %&gt;%
        toupper(), &quot;K-S Curve&quot;, sep = &quot; &quot;)) +
      theme(
        plot.title = element_text(size = 10, hjust = 0.5, face = &quot;bold&quot;),
        text = element_text(size = 10, hjust = 0.5, family = &quot;CAL&quot;),
        axis.title.y = element_text(face = &quot;bold&quot;, hjust = 0.5),
        axis.title.x = element_text(face = &quot;bold&quot;, hjust = 0.5),
        axis.text.x = element_text(size = 8, face = &quot;bold&quot;, family = &quot;CAL&quot;, hjust = 0.5, vjust = 0.5),
        axis.text.y = element_text(size = 8, face = &quot;bold&quot;, family = &quot;CAL&quot;, hjust = 0.5, vjust = 0.5)
      )
  }))

# do.call(grid.arrange,c(ks.plot$plot,ncol = 5))
marrangeGrob(ks.plot$plot, nrow = 1, ncol = 1, npages = length(ks.plot$plot))
</code></pre>
<p><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-153-1.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-153-2.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-153-3.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-153-4.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-153-5.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-153-6.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-153-7.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-153-8.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-153-9.png" width="672" style="display: block; margin: auto;" /></p>
<h3 id="44-roc曲线">4.4 roc曲线</h3>
<pre><code class="language-r">roc.plot &lt;- ls() %&gt;%
  as_tibble() %&gt;%
  setNames(&quot;model.name&quot;) %&gt;%
  dplyr::filter(str_detect(model.name, &quot;_model&quot;)) %&gt;%
  dplyr::filter(!model.name %in% c(&quot;J48_model&quot;)) %&gt;%
  group_by(model.name) %&gt;%
  mutate(model = list(get(model.name))) %&gt;%
  mutate(train.pred = map(.x = model, .f = function(x) {
    train %&gt;%
      mutate(pred = predict(object = x, newdata = train, type = &quot;prob&quot;)[, &quot;X1&quot;]) %&gt;%
      mutate(class = ifelse(class == &quot;X0&quot;, 0, 1))
  })) %&gt;%
  mutate(test.pred = map(.x = model, .f = function(x) {
    test %&gt;%
      mutate(pred = predict(object = x, newdata = test, type = &quot;prob&quot;)[, &quot;X1&quot;]) %&gt;%
      mutate(class = ifelse(class == &quot;X0&quot;, 0, 1))
  })) %&gt;%
  mutate(plot = pmap(.l = list(train.pred, test.pred, model.name), .f = function(x, y, z) {
    roc_plot(train_pred = x, test_pred = y, target = &quot;class&quot;, score = &quot;pred&quot;) +
      ggtitle(label = paste(z %&gt;%
        str_remove(&quot;_model&quot;) %&gt;%
        toupper(), &quot;ROC Curve&quot;, sep = &quot; &quot;)) +
      theme(
        plot.title = element_text(size = 10, hjust = 0.5, face = &quot;bold&quot;),
        text = element_text(size = 10, hjust = 0.5, family = &quot;CAL&quot;),
        axis.title.y = element_text(face = &quot;bold&quot;, hjust = 0.5),
        axis.title.x = element_text(face = &quot;bold&quot;, hjust = 0.5),
        axis.text.x = element_text(size = 8, face = &quot;bold&quot;, family = &quot;CAL&quot;, hjust = 0.5, vjust = 0.5),
        axis.text.y = element_text(size = 8, face = &quot;bold&quot;, family = &quot;CAL&quot;, hjust = 0.5, vjust = 0.5)
      )
  }))

# do.call(grid.arrange,c(roc.plot$plot,ncol = 5))
marrangeGrob(roc.plot$plot, nrow = 1, ncol = 1, npages = length(roc.plot$plot))
</code></pre>
<p><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-154-1.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-154-2.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-154-3.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-154-4.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-154-5.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-154-6.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-154-7.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-154-8.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-154-9.png" width="672" style="display: block; margin: auto;" /></p>
<h3 id="45-precision-recall-curve">4.5 Precision recall curve</h3>
<pre><code class="language-r">pr.plot &lt;- ls() %&gt;%
  as_tibble() %&gt;%
  setNames(&quot;model.name&quot;) %&gt;%
  dplyr::filter(str_detect(model.name, &quot;_model&quot;)) %&gt;%
  dplyr::filter(!model.name %in% c(&quot;J48_model&quot;)) %&gt;%
  group_by(model.name) %&gt;%
  mutate(model = list(get(model.name))) %&gt;%
  mutate(train.pred = map(.x = model, .f = function(x) {
    train %&gt;%
      bind_cols(predict(object = x, newdata = train, type = &quot;prob&quot;) %&gt;%
        as_tibble())
  })) %&gt;%
  mutate(test.pred = map(.x = model, .f = function(x) {
    test %&gt;%
      bind_cols(predict(object = x, newdata = test, type = &quot;prob&quot;) %&gt;%
        as_tibble())
  })) %&gt;%
  mutate(plot = pmap(.l = list(train.pred, test.pred, model.name), .f = function(x, y, z) {
    pr_curve(x, class, X0) %&gt;%
      ggplot(aes(x = recall, y = precision)) +
      geom_path() +
      coord_equal() +
      ggtitle(label = paste(z %&gt;%
        str_remove(&quot;_model&quot;) %&gt;%
        toupper(), &quot;Precision recall curve&quot;, sep = &quot; &quot;)) +
      theme(
        plot.title = element_text(size = 10, hjust = 0.5, face = &quot;bold&quot;),
        text = element_text(size = 10, hjust = 0.5, family = &quot;CAL&quot;),
        axis.title.y = element_text(face = &quot;bold&quot;, hjust = 0.5),
        axis.title.x = element_text(face = &quot;bold&quot;, hjust = 0.5),
        axis.text.x = element_text(size = 8, face = &quot;bold&quot;, family = &quot;CAL&quot;, hjust = 0.5, vjust = 0.5),
        axis.text.y = element_text(size = 8, face = &quot;bold&quot;, family = &quot;CAL&quot;, hjust = 0.5, vjust = 0.5)
      )
  }))

# do.call(grid.arrange,c(pr.plot$plot,ncol = 5))
marrangeGrob(pr.plot$plot, nrow = 1, ncol = 1, npages = length(pr.plot$plot))
</code></pre>
<p><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-155-1.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-155-2.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-155-3.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-155-4.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-155-5.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-155-6.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-155-7.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-155-8.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-155-9.png" width="672" style="display: block; margin: auto;" /></p>
<h3 id="46-gain-curve">4.6 Gain curve</h3>
<pre><code class="language-r">gain.plot &lt;- ls() %&gt;%
  as_tibble() %&gt;%
  setNames(&quot;model.name&quot;) %&gt;%
  dplyr::filter(str_detect(model.name, &quot;_model&quot;)) %&gt;%
  dplyr::filter(!model.name %in% c(&quot;J48_model&quot;)) %&gt;%
  group_by(model.name) %&gt;%
  mutate(model = list(get(model.name))) %&gt;%
  mutate(train.pred = map(.x = model, .f = function(x) {
    train %&gt;%
      bind_cols(predict(object = x, newdata = train, type = &quot;prob&quot;) %&gt;%
        as_tibble())
  })) %&gt;%
  mutate(test.pred = map(.x = model, .f = function(x) {
    test %&gt;%
      bind_cols(predict(object = x, newdata = test, type = &quot;prob&quot;) %&gt;%
        as_tibble())
  })) %&gt;%
  mutate(plot = pmap(.l = list(train.pred, test.pred, model.name), .f = function(x, y, z) {
    gain_curve(x, class, X0) %&gt;%
      autoplot() +
      ggtitle(label = paste(z %&gt;%
        str_remove(&quot;_model&quot;) %&gt;%
        toupper(), &quot;Gain curve&quot;, sep = &quot; &quot;)) +
      theme(
        plot.title = element_text(size = 10, hjust = 0.5, face = &quot;bold&quot;),
        text = element_text(size = 10, hjust = 0.5, family = &quot;CAL&quot;),
        axis.title.y = element_text(face = &quot;bold&quot;, hjust = 0.5),
        axis.title.x = element_text(face = &quot;bold&quot;, hjust = 0.5),
        axis.text.x = element_text(size = 8, face = &quot;bold&quot;, family = &quot;CAL&quot;, hjust = 0.5, vjust = 0.5),
        axis.text.y = element_text(size = 8, face = &quot;bold&quot;, family = &quot;CAL&quot;, hjust = 0.5, vjust = 0.5)
      )
  }))

# do.call(grid.arrange,c(gain.plot$plot,ncol = 5))
marrangeGrob(gain.plot$plot, nrow = 1, ncol = 1, npages = length(gain.plot$plot))
</code></pre>
<p><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-156-1.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-156-2.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-156-3.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-156-4.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-156-5.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-156-6.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-156-7.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-156-8.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-156-9.png" width="672" style="display: block; margin: auto;" /></p>
<h3 id="47-概率分布图">4.7 概率分布图</h3>
<pre><code class="language-r">score.distribution.plot &lt;- ls() %&gt;%
  as_tibble() %&gt;%
  setNames(&quot;model.name&quot;) %&gt;%
  dplyr::filter(str_detect(model.name, &quot;_model&quot;)) %&gt;%
  dplyr::filter(!model.name %in% c(&quot;J48_model&quot;)) %&gt;%
  group_by(model.name) %&gt;%
  mutate(model = list(get(model.name))) %&gt;%
  mutate(train.pred = map(.x = model, .f = function(x) {
    train %&gt;%
      mutate(pred = predict(object = x, newdata = train, type = &quot;prob&quot;)[, &quot;X1&quot;]) %&gt;%
      mutate(class = ifelse(class == &quot;X0&quot;, 0, 1))
  })) %&gt;%
  mutate(test.pred = map(.x = model, .f = function(x) {
    test %&gt;%
      mutate(pred = predict(object = x, newdata = test, type = &quot;prob&quot;)[, &quot;X1&quot;]) %&gt;%
      mutate(class = ifelse(class == &quot;X0&quot;, 0, 1))
  })) %&gt;%
  mutate(plot = pmap(.l = list(train.pred, test.pred, model.name), .f = function(x, y, z) {
    score_distribution_plot(train_pred = x, test_pred = y, target = &quot;class&quot;, score = &quot;pred&quot;) +
      ggtitle(label = paste(z %&gt;%
        str_remove(&quot;_model&quot;) %&gt;%
        toupper(), &quot;Population Distribution&quot;, sep = &quot; &quot;)) +
      theme(
        plot.title = element_text(size = 10, hjust = 0.5, face = &quot;bold&quot;),
        text = element_text(size = 10, hjust = 0.5, family = &quot;CAL&quot;),
        axis.title.y = element_text(face = &quot;bold&quot;, hjust = 0.5),
        axis.title.x = element_text(face = &quot;bold&quot;, hjust = 0.5),
        axis.text.x = element_text(size = 8, face = &quot;bold&quot;, family = &quot;CAL&quot;, hjust = 0.5, vjust = 0.5),
        axis.text.y = element_text(size = 8, face = &quot;bold&quot;, family = &quot;CAL&quot;, hjust = 0.5, vjust = 0.5)
      )
  }))

# do.call(grid.arrange,c(score.distribution.plot$plot,ncol = 5))
marrangeGrob(score.distribution.plot$plot, nrow = 1, ncol = 1, npages = length(score.distribution.plot$plot))
</code></pre>
<p><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-157-1.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-157-2.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-157-3.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-157-4.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-157-5.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-157-6.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-157-7.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-157-8.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-157-9.png" width="672" style="display: block; margin: auto;" /></p>
<ul>
<li>表格形式展示信息</li>
</ul>
<pre><code class="language-r">ls() %&gt;%
  as_tibble() %&gt;%
  setNames(&quot;model.name&quot;) %&gt;%
  dplyr::filter(str_detect(model.name, &quot;_model&quot;)) %&gt;%
  dplyr::filter(!model.name %in% c(&quot;J48_model&quot;)) %&gt;%
  group_by(model.name) %&gt;%
  mutate(model = list(get(model.name))) %&gt;%
  mutate(train.pred = map(.x = model, .f = function(x) {
    train %&gt;%
      mutate(pred = predict(object = x, newdata = train, type = &quot;prob&quot;)[, &quot;X1&quot;]) %&gt;%
      mutate(class = ifelse(class == &quot;X0&quot;, 0, 1))
  })) %&gt;%
  mutate(test.pred = map(.x = model, .f = function(x) {
    test %&gt;%
      mutate(pred = predict(object = x, newdata = test, type = &quot;prob&quot;)[, &quot;X1&quot;]) %&gt;%
      mutate(class = ifelse(class == &quot;X0&quot;, 0, 1))
  })) %&gt;%
  mutate(perf.tab = pmap(.l = list(train.pred, test.pred, model.name), .f = function(x, y, z) {
    perf_table(train_pred = x, test_pred = y, target = &quot;class&quot;, score = &quot;pred&quot;) %&gt;%
      mutate(bins = str_sub(bins, 4, nchar(bins))) %&gt;%
      mutate(group = 1:n()) %&gt;%
      mutate(model = z) %&gt;%
      dplyr::select(model, group, everything())
  })) %&gt;%
  dplyr::select(perf.tab) %&gt;%
  unnest(perf.tab)
</code></pre>
<pre><code>#&gt; # A tibble: 79 × 20
#&gt; # Groups:   model.name [9]
#&gt;    model.name       model group bins  `#total` `#train` `#test` `%train` `%test`
#&gt;    &lt;chr&gt;            &lt;chr&gt; &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
#&gt;  1 AdaBoost.M1_mod… AdaB…     1 (-In…      232      160      72     0.24    0.25
#&gt;  2 AdaBoost.M1_mod… AdaB…     2 (0,0…       47       34      13     0.05    0.04
#&gt;  3 AdaBoost.M1_mod… AdaB…     3 (0.0…      122       91      31     0.13    0.11
#&gt;  4 AdaBoost.M1_mod… AdaB…     4 (0.0…       81       54      27     0.08    0.09
#&gt;  5 AdaBoost.M1_mod… AdaB…     5 (0.1…      110       71      39     0.1     0.13
#&gt;  6 AdaBoost.M1_mod… AdaB…     6 (0.1…       87       65      22     0.1     0.08
#&gt;  7 AdaBoost.M1_mod… AdaB…     7 (0.2…       93       68      25     0.1     0.09
#&gt;  8 AdaBoost.M1_mod… AdaB…     8 (0.3…       89       65      24     0.1     0.08
#&gt;  9 AdaBoost.M1_mod… AdaB…     9 (0.4…      108       71      37     0.1     0.13
#&gt; 10 C5.0_model       C5.0…     1 (-In…      355      251     104     0.37    0.36
#&gt; # ℹ 69 more rows
#&gt; # ℹ 11 more variables: `%train_B` &lt;dbl&gt;, `%test_B` &lt;dbl&gt;, `%train_cumG` &lt;dbl&gt;,
#&gt; #   `%train_cumB` &lt;dbl&gt;, `%test_cumG` &lt;dbl&gt;, `%test_cumB` &lt;dbl&gt;,
#&gt; #   `train_K-S` &lt;dbl&gt;, `test_K-S` &lt;dbl&gt;, train_Lift &lt;dbl&gt;, test_Lift &lt;dbl&gt;,
#&gt; #   PSI &lt;dbl&gt;
</code></pre>
<ul>
<li>响应概率曲线</li>
</ul>
<p>下面这个概率相应曲线看起来是没问题的，但是经过后期和<code>biomod2</code>包所跑结果比对，这个结果是不靠谱的。排查原因的话，是和数据没关系的<s>我利用<code>caret</code>和<code>randomForest</code>两个包所跑的随机森林模型对统一数据进行预测，发现预测概率结果是不同的</s>。万般无奈之下，我选择在先挑选出最优模型之后使用其他包<code>biomod2</code>以及<code>sdm</code>来跑这些模型</p>
<pre><code class="language-r">rf_model %&gt;%
  .$coefnames %&gt;%
  as_tibble()
</code></pre>
<pre><code>#&gt; # A tibble: 18 × 1
#&gt;    value            
#&gt;    &lt;chr&gt;            
#&gt;  1 aat0             
#&gt;  2 aat10            
#&gt;  3 aridity          
#&gt;  4 dem              
#&gt;  5 dst_waterway     
#&gt;  6 hfp              
#&gt;  7 hii              
#&gt;  8 im               
#&gt;  9 landcover        
#&gt; 10 landform         
#&gt; 11 ndvi20161        
#&gt; 12 ndvi20162        
#&gt; 13 ndvi20163        
#&gt; 14 ndvi20164        
#&gt; 15 night_time_lights
#&gt; 16 pa               
#&gt; 17 slope            
#&gt; 18 tadem
</code></pre>
<pre><code class="language-r">ls() %&gt;%
  as_tibble() %&gt;%
  setNames(&quot;model.name&quot;) %&gt;%
  dplyr::filter(str_detect(model.name, &quot;_model&quot;)) %&gt;%
  # dplyr::filter(! model.name %in% c(&quot;J48_model&quot;,&quot;nb_model&quot;)) %&gt;%
  group_by(model.name) %&gt;%
  mutate(model = list(get(model.name))) %&gt;%
  mutate(expl.name = map(model, ~ .x$coefnames %&gt;% as_tibble()))
</code></pre>
<pre><code>#&gt; # A tibble: 9 × 3
#&gt; # Groups:   model.name [9]
#&gt;   model.name        model   expl.name        
#&gt;   &lt;chr&gt;             &lt;list&gt;  &lt;list&gt;           
#&gt; 1 AdaBoost.M1_model &lt;train&gt; &lt;tibble [18 × 1]&gt;
#&gt; 2 C5.0_model        &lt;train&gt; &lt;tibble [18 × 1]&gt;
#&gt; 3 gbm_model         &lt;train&gt; &lt;tibble [18 × 1]&gt;
#&gt; 4 glm_model         &lt;train&gt; &lt;tibble [18 × 1]&gt;
#&gt; 5 knn_model         &lt;train&gt; &lt;tibble [18 × 1]&gt;
#&gt; 6 nb_model          &lt;train&gt; &lt;tibble [18 × 1]&gt;
#&gt; 7 rf_model          &lt;train&gt; &lt;tibble [18 × 1]&gt;
#&gt; 8 svm_model         &lt;train&gt; &lt;tibble [18 × 1]&gt;
#&gt; 9 xgb_model         &lt;train&gt; &lt;tibble [18 × 1]&gt;
</code></pre>
<pre><code class="language-r">varImp(rf_model) %&gt;%
  .$importance %&gt;%
  rownames_to_column(&quot;expl.name&quot;) %&gt;%
  as_tibble() %&gt;%
  setNames(c(&quot;expl.name&quot;, &quot;importance&quot;)) %&gt;%
  arrange(desc(importance)) %&gt;%
  dplyr::select(expl.name)
</code></pre>
<pre><code>#&gt; # A tibble: 18 × 1
#&gt;    expl.name        
#&gt;    &lt;chr&gt;            
#&gt;  1 dst_waterway     
#&gt;  2 aridity          
#&gt;  3 im               
#&gt;  4 aat0             
#&gt;  5 pa               
#&gt;  6 ndvi20163        
#&gt;  7 ndvi20164        
#&gt;  8 night_time_lights
#&gt;  9 ndvi20161        
#&gt; 10 landcover        
#&gt; 11 ndvi20162        
#&gt; 12 aat10            
#&gt; 13 dem              
#&gt; 14 slope            
#&gt; 15 hfp              
#&gt; 16 hii              
#&gt; 17 tadem            
#&gt; 18 landform
</code></pre>
<pre><code class="language-r">a &lt;- varImp(rf_model) %&gt;%
  .$importance %&gt;%
  rownames_to_column(&quot;expl.name&quot;) %&gt;%
  as_tibble() %&gt;%
  setNames(c(&quot;expl.name&quot;, &quot;importance&quot;)) %&gt;%
  arrange(desc(importance)) %&gt;%
  dplyr::select(expl.name) %&gt;%
  mutate(model = list(rf_model)) %&gt;%
  # 生成模型列
  mutate(train.data = list(train)) %&gt;%
  # 对指定变量之外变量进行处理
  mutate(train.processed = map2(expl.name, train.data, .f = function(x, y) {
    y %&gt;%
      dplyr::select(-class) %&gt;%
      # 对17个自变量做取均值/中位数等处理
      mutate(across(.cols = -x, .fns = mean)) %&gt;%
      # 对目标自变量等间距拉伸
      mutate(across(.cols = x, .fns = function(x) {
        tmp &lt;- seq(from = min(x), max(x), length.out = length(x))
        return(tmp)
      }))
  })) %&gt;%
  # 使用模型预测
  mutate(prob = pmap(.l = list(model, train.processed, expl.name), .f = function(x, y, z) {
    predict(object = x, newdata = y, type = &quot;prob&quot;) %&gt;%
      dplyr::select(X1) %&gt;%
      setNames(&quot;prob&quot;) %&gt;%
      bind_cols(y %&gt;%
        dplyr::select(z) %&gt;%
        setNames(&quot;value&quot;))
  }))
myrp &lt;- a %&gt;%
  dplyr::select(-model, -train.data, -train.processed) %&gt;%
  mutate(plot = map2(.x = prob, .y = expl.name, .f = function(x, y) {
    ggplot(data = x, aes(value, prob)) +
      geom_line() +
      geom_point(size = 1, alpha = 1 / 5) +
      geom_smooth() +
      ggtitle(paste(y)) +
      theme_light() +
      scale_x_continuous(n.breaks = 7) +
      scale_y_continuous(labels = function(x) paste0(x * 100, &quot;%&quot;)) +
      # labs(x = &quot;Environmental factor&quot;,
      # y = &quot;Probability of existance&quot;) +
      theme(
        plot.title = element_text(size = 14, hjust = 0.5),
        # text = element_text(size = 12,hjust = 0.5,family = &quot;CAL&quot;),
        axis.title.y = element_text(size = 14, hjust = 0.5, family = &quot;CAL&quot;),
        axis.title.x = element_text(size = 14, hjust = 0.5, family = &quot;CAL&quot;),
        axis.text.x = element_text(size = 13, family = &quot;RMN&quot;, hjust = 0.5, vjust = 0.5),
        axis.text.y = element_text(size = 13, family = &quot;RMN&quot;, hjust = 0.5, vjust = 0.5),
        strip.text = element_text(size = 14, family = &quot;CAL&quot;)
      )
  }))
# do.call(grid.arrange,c(myrp$plot,ncol = 6))
marrangeGrob(myrp$plot, nrow = 1, ncol = 1, npages = length(myrp$plot))
</code></pre>
<p><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-159-1.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-159-2.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-159-3.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-159-4.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-159-5.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-159-6.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-159-7.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-159-8.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-159-9.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-159-10.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-159-11.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-159-12.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-159-13.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-159-14.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-159-15.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-159-16.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-159-17.png" width="672" style="display: block; margin: auto;" /><img src="/post/2023/04/01/%E5%9F%BA%E4%BA%8Er%E8%AF%AD%E8%A8%80caret%E5%8C%85%E7%9A%84%E4%B8%8A%E6%B5%B7%E5%B8%82%E9%92%89%E8%9E%BA%E5%88%86%E5%B8%83%E9%A2%84%E6%B5%8B/index_files/figure-html/unnamed-chunk-159-18.png" width="672" style="display: block; margin: auto;" /></p>

</main>


















<nav class="post-nav">
  <span class="nav-prev"><a href="/post/2023/07/30/%E9%A9%AC%E5%85%8B%E6%80%9D%E4%B8%BB%E4%B9%89%E5%AE%97%E6%95%99%E8%A7%82%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%86%85%E5%AE%B9/">&larr; 马克思主义宗教观的基本内容</a></span>
  <span class="nav-next"><a href="/post/2023/01/05/%E6%A0%85%E6%A0%BC%E6%95%B0%E6%8D%AE%E5%81%8F%E7%9B%B8%E5%85%B3%E5%88%86%E6%9E%90/">栅格数据偏相关分析 &rarr;</a></span>
</nav>



</article>
</div>

<script async src="//yihui.org/js/center-img.js"></script>

<footer>

<div class="footer">
  <ul class="menu">
    
    <li><a href="/"><span data-hover="Home">Home</span></a></li>
    
    <li><a href="/about/"><span data-hover="About">About</span></a></li>
    
    <li><a href="/categories/"><span data-hover="Categories">Categories</span></a></li>
    
    <li><a href="/tags/"><span data-hover="Tags">Tags</span></a></li>
    
    <li><a href="/index.xml"><span data-hover="Subscribe">Subscribe</span></a></li>
    
  </ul>
  
  <div class="copyright">© <a href="https://yihui.org">Yihui Xie</a> 2017 - 2020 | <a href="https://github.com/yihui">Github</a> | <a href="https://twitter.com/xieyihui">Twitter</a></div>
  
</div>
</footer>


<script src="//yihui.org/js/math-code.js"></script>
<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
<script>
hljs.configure({languages: []});
hljs.initHighlightingOnLoad();
</script>




</body>
</html>

